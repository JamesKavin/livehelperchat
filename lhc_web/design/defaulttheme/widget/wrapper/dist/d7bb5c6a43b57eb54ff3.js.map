{"version":3,"file":"d7bb5c6a43b57eb54ff3.js","mappings":"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","sources":["webpack://LiveHelperChat/./src/lib/widgets/needhelpWidget.js"],"sourcesContent":["import {settings} from '../settings.js';\nimport {UIConstructorIframe} from '../UIConstructorIframe';\nimport {helperFunctions} from '../helperFunctions';\n\nexport class needhelpWidget{\n    constructor(prefix) {\n\n        this.attributes = {};\n        this.hidden = false;\n        this.widgetOpen = false;\n        this.invitationOpen = false;\n        this.nhOpen = false;\n        this.delayProcessed = false;\n\n        this.cont = new UIConstructorIframe((prefix || 'lhc')+'_needhelp_widget_v2', helperFunctions.getAbstractStyle({\n            zindex: \"2147483639\",\n            width: \"320px\",\n            height: \"135px\",\n            position: \"fixed\",\n            display: \"none\",\n            transition: \"transform\"\n        }),  {\"role\":\"presentation\",\"translate\":\"no\"}, \"iframe\");\n\n        this.loadStatus = {main : false, theme: false, status: false};\n    }\n    \n    checkLoadStatus() {\n        if (this.loadStatus['theme'] == true && this.loadStatus['main'] == true && this.loadStatus['status'] == true) {\n            this.cont.elmDomDoc.body.style.display = \"\";\n        }\n    }\n    \n    init(attributes, settings) {\n\n        this.attributes = attributes;\n\n        var placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom) +\"px\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n\n        var leftPosition = false;\n\n        if (attributes.position_placement == 'bottom_left' || attributes.position_placement == 'full_height_left') {\n            placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom) +\"px\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (attributes.position_placement == 'middle_left') {\n            placement = {bottom: \"calc(50% + 35px)\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (attributes.position_placement == 'middle_right') {\n            placement = {bottom: \"calc(50% + 35px)\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n        }\n\n        this.cont.massRestyle(placement);\n\n        this.attributes = attributes;\n\n        this.cont.tmpl = settings['html'].replace('{dev_type}',(this.attributes.isMobile === true ? 'lhc-mobile' : 'lhc-desktop'));\n        this.cont.bodyId = 'need-help';\n        \n        if (this.cont.constructUIIframe('', this.attributes.staticJS['dir']) === null){\n            return null;\n        }\n        \n        // Content invisible untill media loads\n        this.cont.elmDomDoc.body.style.display = \"none\";\n        \n        this.cont.elmDom.className += this.attributes.isMobile === true ? ' notranslate lhc-mobile' : ' notranslate lhc-desktop';\n\n        this.cont.attachUserEventListener(\"click\", function (e) {\n            attributes.eventEmitter.emitEvent('nhClicked', [{'event': e, 'sender' : 'closeButton'}]);\n            attributes.eventEmitter.emitEvent('showWidget', [{'event': e}]);\n        }, \"start-chat-btn\",'nhstrt');\n\n        var _that = this;\n\n        this.cont.attachUserEventListener(\"click\", function (a) {\n            attributes.eventEmitter.emitEvent('nhClosed', [{'sender' : 'closeButton'}]);\n            a.stopPropagation();\n            _that.hide(true);\n        }, \"close-need-help-btn\",'nhcls');\n\n        if (settings.dimensions) {\n            if (leftPosition == true && settings.dimensions['right']) {\n                settings.dimensions['left'] = settings.dimensions['right'];\n                delete settings.dimensions['right'];\n            }\n            this.cont.massRestyle(settings.dimensions);\n        }\n\n        this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['main'] = true; this.checkLoadStatus()},crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_css']}, true);\n\n        if (this.attributes.isMobile == true) {\n            this.cont.insertCssRemoteFile({crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_mobile_css']});\n        }\n\n        if (this.attributes.theme) {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-needhelp\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/themeneedhelp/' + this.attributes.theme + '?v=' + this.attributes.theme_v}, true);\n        } else {\n            this.loadStatus['theme'] = true;\n            this.checkLoadStatus();\n        }\n\n        // Show need help only if status widget is loaded\n        attributes.sload.subscribe((data) => {if(data){this.loadStatus['status'] = true; this.checkLoadStatus()}});\n\n        if (!settings['ap']) {\n\n            if (attributes.animate_nh) {\n                this.cont.massRestyle({\"transition-duration\" : \"800ms\"});\n            }\n\n            attributes.eventEmitter.addListener('showInvitation', () => {\n                this.invitationOpen = true;\n                this.hide();\n            });\n\n            attributes.eventEmitter.addListener('chatStarted', () => {\n                this.hide(true);\n            });\n\n            attributes.eventEmitter.addListener('hideInvitation', () => {\n                this.invitationOpen = false;\n                this.show();\n            });\n\n            attributes.eventEmitter.addListener('cancelInvitation', () => {\n                this.invitationOpen = false;\n                this.show();\n            });\n\n            attributes.msgsnippet_status.subscribe((data) => {\n                data == true && this.hide(true);\n            });\n\n            attributes.shidden.subscribe((data) => {\n                data ? this.hide(false) : this.show();\n            });\n\n            attributes.status_position.subscribe((data) => {\n\n                if (!data) {\n                    return;\n                }\n\n                let placementRestored = {};\n                placementRestored[\"bottom\"] = data[\"bottom\"];\n                placementRestored[\"top\"] = data[\"top\"];\n                placementRestored[\"left\"] = data[\"left\"];\n                placementRestored[\"right\"] = data[\"right\"];\n                placementRestored[\"transform\"] = \"translate3d(\"+ (data[\"left\"] == \"auto\" ? -55 : 55) +\"px,\" + (data[\"bottom\"] == \"auto\" ? data[\"y\"] + 70 : data[\"y\"] - 60) + \"px, 0px)!important\";\n                this.cont.massRestyle(placementRestored);\n            });\n        }\n\n        setTimeout(() => {\n\n            this.delayProcessed = true;\n\n            attributes.widgetStatus.subscribe((data) => {\n                data == true ? (this.widgetOpen = true,this.hide()) : (this.widgetOpen = false,this.show());\n            });\n\n            attributes.onlineStatus.subscribe((data) => {\n                if (data == false) {\n                    let needHide = this.hidden;\n                    this.hide();\n                    // Show next time only if it was not hidden already\n                    if (needHide === false) {\n                        this.hidden = false;\n                    }\n                } else {\n                    this.show();\n                }\n            });\n\n        }, settings.delay + this.attributes['status_delay']);\n\n        attributes.eventEmitter.addListener('reloadWidget',() => {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-needhelp\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/themeneedhelp/' + this.attributes.theme + '?v=' + Date.now()}, true);\n        });\n\n    }\n\n    hide (persistent) {\n\n        if (typeof persistent !== 'undefined' && persistent === true) {\n            this.attributes.userSession.hnh = Math.round(Date.now() / 1000);\n            this.attributes.storageHandler.storeSessionInformation(this.attributes.userSession.getSessionAttributes());\n            this.hidden = true;\n        }\n\n        this.cont.hide();\n\n        if (this.nhOpen == true) {\n            this.attributes.eventEmitter.emitEvent('nhHide', []);\n        }\n\n        this.nhOpen = false;\n    }\n\n    show () {\n\n        if (this.delayProcessed == false || this.hidden == true || this.widgetOpen == true || this.invitationOpen == true || this.attributes.onlineStatus.value == false) {\n            return;\n        }\n\n        if (this.attributes.hideOffline === false) {\n            this.cont.show();\n            if (this.nhOpen == false) {\n                this.attributes.eventEmitter.emitEvent('nhShow', []);\n            }\n            this.nhOpen = true;\n        } else {\n            this.cont.hide();\n            if (this.nhOpen == true) {\n                this.attributes.eventEmitter.emitEvent('nhHide', []);\n            }\n            this.nhOpen = false;\n        }\n    }\n}"],"names":["needhelpWidget","prefix","this","attributes","hidden","widgetOpen","invitationOpen","nhOpen","delayProcessed","cont","UIConstructorIframe","helperFunctions","zindex","width","height","position","display","transition","loadStatus","main","theme","status","elmDomDoc","body","style","settings","placement","bottom","widgetDimesions","value","wbottom","right","wright","leftPosition","position_placement","left","massRestyle","tmpl","replace","isMobile","bodyId","constructUIIframe","staticJS","elmDom","className","attachUserEventListener","e","eventEmitter","emitEvent","_that","a","stopPropagation","hide","dimensions","insertCssRemoteFile","onload","checkLoadStatus","crossOrigin","href","id","LHC_API","args","lhc_base_url","theme_v","sload","subscribe","data","animate_nh","addListener","show","msgsnippet_status","shidden","status_position","placementRestored","setTimeout","widgetStatus","onlineStatus","needHide","delay","Date","now","persistent","userSession","hnh","Math","round","storageHandler","storeSessionInformation","getSessionAttributes","hideOffline"],"sourceRoot":""}