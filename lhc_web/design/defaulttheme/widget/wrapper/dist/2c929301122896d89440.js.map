{"version":3,"sources":["webpack://LiveHelperChat/./src/lib/widgets/msgSnippetWidget.js"],"names":["msgSnippetWidget","prefix","this","attributes","hidden","widgetOpen","invitationOpen","nhOpen","msop","msg","cont","UIConstructorIframe","helperFunctions","getAbstractStyle","zindex","width","height","position","display","loadStatus","main","theme","status","elmDomDoc","body","style","fitContent","tmpl","replace","isMobile","settings","bodyId","constructUIIframe","staticJS","elmDom","className","attachUserEventListener","e","eventEmitter","emitEvent","_that","a","stopPropagation","hide","insertCssRemoteFile","onload","checkLoadStatus","crossOrigin","href","id","LHC_API","args","lhc_base_url","theme_v","sload","subscribe","data","addListener","dataUnread","msg_body","showSnippet","makeRequest","params","getSessionAttributes","widgetStatus","show","Date","now","operator_profile","renderBody","persistent","msgsnippet_status","next","getElementById","innerHTML","documentHeight","offsetHeight","placement","bottom","widgetDimesions","value","wbottom","right","wright","position_placement","left","massRestyle","onlineStatus","hideOffline"],"mappings":"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","file":"2c929301122896d89440.js","sourcesContent":["import {settings} from '../settings.js';\nimport {UIConstructorIframe} from '../UIConstructorIframe';\nimport {helperFunctions} from '../helperFunctions';\n\nexport class msgSnippetWidget{\n    constructor(prefix) {\n\n        this.attributes = {};\n        this.hidden = false;\n        this.widgetOpen = false;\n        this.invitationOpen = false;\n        this.nhOpen = false;\n\n        this.msop = null;   // Last operator ID who wrote a message\n        this.msg = null;    // Container of the message\n\n        this.cont = new UIConstructorIframe((prefix || 'lhc')+'_msgsnippet_widget_v2', helperFunctions.getAbstractStyle({\n            zindex: \"2147483639\",\n            width: \"300px\",\n            height: \"200px\",\n            position: \"fixed\",\n            display: \"none\",\n        }), null, \"iframe\");\n\n        this.loadStatus = {main : false, theme: false, status: false};\n    }\n\n    checkLoadStatus() {\n        if (this.loadStatus['theme'] == true && this.loadStatus['main'] == true && this.loadStatus['status'] == true) {\n            this.cont.elmDomDoc.body.style.display = \"\";\n            this.fitContent();\n        }\n    }\n\n    renderBody() {\n\n        this.cont.tmpl = this.msg.replace('{dev_type}',(this.attributes.isMobile === true ? 'lhc-mobile' : 'lhc-desktop')).replace('{msg_body}',this.settings['msg_body']).replace('{operator_profile}',this.settings['operator_profile']);\n\n        this.cont.bodyId = 'msgsnippet';\n\n        if (this.cont.constructUIIframe('', this.attributes.staticJS['dir']) === null){\n            return null;\n        }\n\n        // Content invisible untill media loads\n        this.cont.elmDomDoc.body.style.display = \"none\";\n\n        this.cont.elmDom.className += this.attributes.isMobile === true ? ' lhc-mobile' : ' lhc-desktop';\n\n        this.cont.attachUserEventListener(\"click\",  (e) => {\n            this.attributes.eventEmitter.emitEvent('msgSnippetClicked', [{'event': e, 'sender' : 'closeButton'}]);\n            this.attributes.eventEmitter.emitEvent('showWidget', [{'event': e}]);\n        }, \"start-chat-btn\",'msgsnippetstart');\n\n        var _that = this;\n\n        this.cont.attachUserEventListener(\"click\",  (a) => {\n            this.attributes.eventEmitter.emitEvent('msgsnippetClosed', [{'sender' : 'closeButton'}]);\n            a.stopPropagation();\n            _that.hide(true);\n        }, \"close-need-help-btn\",'msgsnippetclose');\n\n        this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['main'] = true; this.checkLoadStatus()},crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_css']}, true);\n\n        if (this.attributes.isMobile == true) {\n            this.cont.insertCssRemoteFile({crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_mobile_css']});\n        }\n\n        if (this.attributes.theme > 0) {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + this.attributes.theme_v}, true);\n        } else {\n            this.loadStatus['theme'] = true;\n            this.checkLoadStatus();\n        }\n\n        // Show need help only if status widget is loaded\n        this.attributes.sload.subscribe((data) => {if(data){this.loadStatus['status'] = true; this.checkLoadStatus()}});\n\n        this.attributes.eventEmitter.emitEvent('showMsgSnippet', [{'sender' : 'closeButton'}]);\n\n        this.attributes.eventEmitter.addListener('unread_message', (dataUnread) => {\n            if (dataUnread.msop) {\n                if (dataUnread.msop == this.msop && dataUnread.msg_body) {\n                    this.showSnippet(dataUnread, true);\n                } else {\n                    this.msop = dataUnread.msop;\n                    helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                        this.msop = data.msop;\n                        this.msg = data.msg;\n                        this.showSnippet(data, true);\n                    })\n                }\n            }\n        });\n\n        this.attributes.eventEmitter.addListener('hide_msg_snippet', () => {\n            this.hide(true);\n        });\n\n        this.attributes.widgetStatus.subscribe((data) => {\n            data == true ? (this.widgetOpen = true, this.hide(true)) : (this.widgetOpen = false, this.show());\n        });\n\n        this.attributes.eventEmitter.addListener('reloadWidget',() => {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + Date.now()}, true);\n        });\n    }\n\n    init(attributes, settings) {\n        this.attributes = attributes;\n        this.settings = settings;\n\n        if (this.settings['msg']) {\n            this.msg = this.settings['msg'];\n        }\n\n        if (this.settings['msop']) {\n            this.msop = this.settings['msop'];\n        }\n\n        if (!this.msg || (this.settings['msop'] && this.msop !== this.settings['msop'])) {\n            helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                this.msop = data.msop;\n                this.msg = data.msg;\n                this.settings['operator_profile'] = data.operator_profile;\n                this.renderBody();\n            })\n        } else {\n            this.renderBody();\n        }\n\n    }\n\n    hide (persistent) {\n\n        if (typeof persistent !== 'undefined' && persistent === true) {\n            this.hidden = true;\n        }\n\n        this.cont.hide();\n\n        if (this.nhOpen == true) {\n            this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n        }\n\n        this.attributes.msgsnippet_status.next(false);\n        this.nhOpen = false;\n    }\n\n    showSnippet(data, showSnippet) {\n        if (showSnippet == true) {\n            this.hidden = false;\n            this.show();\n        }\n        this.cont.elmDomDoc.getElementById('messages-scroll').innerHTML = data.msg_body;\n\n        if (data.operator_profile) {\n            this.cont.elmDomDoc.getElementById('operator-profile-snippet').innerHTML = data.operator_profile;\n        }\n\n        this.fitContent();\n    }\n\n    fitContent() {\n\n        var documentHeight = this.cont.elmDomDoc.getElementById('messages-scroll').offsetHeight;\n\n        var placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n\n        var leftPosition = false;\n\n        if (this.attributes.position_placement == 'bottom_left' || this.attributes.position_placement == 'full_height_left') {\n            placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_left') {\n            placement = {bottom: \"calc(50% + 35px)\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_right') {\n            placement = {bottom: \"calc(50% + 35px)\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n        }\n\n        this.cont.massRestyle(placement);\n    }\n\n    show () {\n        if (this.hidden == true || this.widgetOpen == true || this.invitationOpen == true || this.attributes.onlineStatus.value == false) {\n            return;\n        }\n\n        if (this.attributes.hideOffline === false) {\n            this.cont.show();\n            if (this.nhOpen == false) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetShow', []);\n                this.attributes.msgsnippet_status.next(true);\n            }\n            this.nhOpen = true;\n        } else {\n            this.cont.hide();\n            if (this.nhOpen == true) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n                this.attributes.msgsnippet_status.next(false);\n            }\n            this.nhOpen = false;\n        }\n    }\n}"],"sourceRoot":""}