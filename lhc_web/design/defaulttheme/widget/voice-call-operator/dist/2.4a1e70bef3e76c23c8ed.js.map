{"version":3,"sources":["webpack://LHCVoiceCallAPP/./src/lib/useInterval.js","webpack://LHCVoiceCallAPP/./src/components/parts/VideoStream.js","webpack://LHCVoiceCallAPP/./src/components/parts/MediaStream.js","webpack://LHCVoiceCallAPP/./src/components/VoiceCall.js"],"names":["useInterval","callback","delay","savedCallback","useRef","useEffect","current","id","setInterval","clearInterval","VideoStream","props","user","videoTrack","play","uid","className","title","MediaStream","media","shift","audioTrack","video","client","AgoraRTC","createClient","mode","codec","reducer","state","action","type","foundIndex","chats","findIndex","x","value","attr","remoteUsers","obj","audio","push","unshift","active","mn","support_chat","splice","msg","el","document","getElementById","classList","contains","group_offline","Error","VoiceCall","useReducer","call","localTracks","inCall","dispatch","chatsRef","axios","get","WWW_DIR_JAVASCRIPT","initParams","then","result","data","useTranslation","t","cancelJoin","i18n","a","url","isVisitor","hash","Object","keys","forEach","trackName","track","stop","close","undefined","leave","status","vi_status","op_status","subscribe","mediaType","handleUserPublished","handleUserUnpublished","join","on","uui","Promise","all","appid","token","createMicrophoneAudioTrack","createCameraVideoTrack","publish","values","requestJoin","post","console","log","Fragment","map","val","k","key","role","aria-label","onClick"],"mappings":"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","file":"2.4a1e70bef3e76c23c8ed.js","sourcesContent":["import { useEffect, useRef } from \"react\";\n\nfunction useInterval(callback, delay) {\n    const savedCallback = useRef();\n\n    // Remember the latest callback.\n    useEffect(() => {\n        savedCallback.current = callback;\n    }, [callback]);\n\n    // Set up the interval.\n    useEffect(() => {\n        function tick() {\n            savedCallback.current();\n        }\n        if (delay !== null) {\n            let id = setInterval(tick, delay);\n            return () => clearInterval(id);\n        }\n    }, [delay]);\n}\n\nexport default useInterval;","import React, { useEffect } from \"react\";\n\nconst VideoStream = props => {\n    useEffect(() => {\n        props.user.videoTrack.play('player-'+props.user.uid);\n        // Cleanup\n        return function cleanup() {\n        };\n\n    },[]);\n    return <div className=\"col bg-light mx-1 align-middle text-center d-flex pl-0 pr-0\" id={\"player-\"+props.user.uid} title={\"UID \"+props.user.uid}></div>\n}\n\nexport default VideoStream;","import React, { useEffect } from \"react\";\nimport VideoStream from \"./VideoStream\";\n\nconst MediaStream = props => {\n\n    useEffect(() => {\n\n        var mediaAdded = props.media.shift();\n\n        if (mediaAdded == 'audio') {\n            props.user.audioTrack.play();\n        }\n\n        // Cleanup\n        return function cleanup() {\n        };\n        \n    },[]);\n\n    if (props.video == true) {\n        return <VideoStream user={props.user} />\n    } else {\n        return <div className=\"col bg-light mx-1 align-middle text-center d-flex pl-0 pr-0\" id={\"player-\"+props.user.uid} title={\"UID \"+props.user.uid}>Audio Call Only</div>\n    }\n\n\n}\n\nexport default MediaStream;","import React, { useEffect, useState, useReducer, useRef, useBoolean } from \"react\";\nimport axios from \"axios\";\nimport {useTranslation} from 'react-i18next';\nimport useInterval from \"../lib/useInterval\";\nimport AgoraRTC from \"agora-rtc-sdk-ng\"\nimport MediaStream from \"./parts/MediaStream\";\n\nconst client = AgoraRTC.createClient({ mode: \"rtc\", codec: \"vp8\" });\n\nfunction reducer(state, action) {\n    switch (action.type) {\n\n        case 'attr':\n            var foundIndex = state.chats.findIndex(x => x.id == action.id);\n            if (foundIndex === -1) return state;\n            state.chats[foundIndex] = { ...state.chats[foundIndex], ...action.value};\n            state = { ... state};\n            return state;\n\n        case 'attr_remove':\n            var foundIndex = state.chats.findIndex(x => x[action.attr] == action.id);\n            if (foundIndex === -1) return state;\n            state.chats[foundIndex] = { ...state.chats[foundIndex], ...action.value};\n            state = { ... state};\n            return state;\n\n        case 'update': {\n            return { ...state, ...action.value }\n        }\n\n        case 'user_published': {\n\n            if (typeof state.remoteUsers[action.user.uid] == 'undefined') {\n                var obj =  {'user' : action.user, video: (action.media == 'video'), audio: (action.media == 'audio'), media : [action.media]};\n                state.remoteUsers[action.user.uid] = obj;\n            } else {\n                if (action.media == 'audio') {\n                    state.remoteUsers[action.user.uid].audio = true;\n                } else if (action.media == 'video') {\n                    state.remoteUsers[action.user.uid].video = true;\n                }\n\n                state.remoteUsers[action.user.uid].media.push(action.media);\n            }\n\n            return { ...state}\n        }\n\n        case 'user_unpublished': {\n            delete state.remoteUsers[action.user.uid];\n            return { ...state}\n        }\n\n        case 'add': {\n            var foundIndex = state.chats.findIndex(x => x.id == action.value.id);\n            if (foundIndex === -1) {\n                state.chats.unshift(action.value);\n            } else {\n                state.chats[foundIndex].active = true;\n                state.chats[foundIndex].mn = 0;\n                state.chats[foundIndex].support_chat = false;\n            }\n\n            return { ...state}\n        }\n\n        case 'remove': {\n            var foundIndex = state.chats.findIndex(x => x.id == action.id);\n            if (foundIndex === -1) return state;\n            state.chats.splice(foundIndex,1);\n            return { ...state}\n        }\n\n        case 'update_chat': {\n            var foundIndex = state.chats.findIndex(x => x.id == action.id);\n            if (foundIndex === -1) return state;\n            state.chats[foundIndex] = {...state.chats[foundIndex], ...action.value}\n            return { ...state}\n        }\n\n        case 'msg_received': {\n            var foundIndex = state.chats.findIndex(x => x.id == action.id);\n            if (foundIndex === -1) return state;\n\n            state.chats[foundIndex].msg = action.value.msg;\n\n            var el = document.getElementById('chat-tab-link-'+action.id);\n\n            if (el === null || !el.classList.contains('active')) {\n                state.chats[foundIndex].active = false;\n            } else {\n                state.chats[foundIndex].active = true;\n            }\n\n            state.chats[foundIndex].mn = state.chats[foundIndex].active == false ? (state.chats[foundIndex].mn ? (state.chats[foundIndex].mn + action.value.mn) : action.value.mn) : 0;\n\n            // Set last appended messages as first array element\n            state.chats.splice(0, 0, state.chats.splice(foundIndex, 1)[0]);\n\n            return { ...state}\n        }\n\n        case 'refocus': {\n            var foundIndex = state.chats.findIndex(x => x.active == true);\n            if (foundIndex !== -1) {\n                if (action.id == state.chats[foundIndex].id) {\n                    return state;\n                }\n                state.chats[foundIndex].active = false;\n            }\n\n            var foundIndex = state.chats.findIndex(x => x.id == action.id);\n            if (foundIndex !== -1) {\n                state.chats[foundIndex].active = true;\n                state.chats[foundIndex].mn = 0;\n                state.chats[foundIndex].support_chat = false;\n            }\n\n            return { ...state}\n        }\n\n        case 'group_offline':\n            state.group_offline = action.value;\n            return {...state};\n\n        default:\n            throw new Error('Unknown action!');\n    }\n}\n\nconst VoiceCall = props => {\n\n    const [state, dispatch] = useReducer(reducer, {\n        chats: [],\n        call : {},\n        localTracks : {\n            videoTrack : null,\n            audioTrack: null\n        },\n        remoteUsers : {},\n        uid : null,\n        inCall: false\n    });\n\n    const STATUS_OP_PENDING = 0;\n    const STATUS_OP_JOINED = 1;\n\n    const STATUS_VI_PENDING = 0;\n    const STATUS_VI_REQUESTED = 1;\n    const STATUS_VI_JOINED = 2;\n\n    const STATUS_PENDING = 0;\n    const STATUS_CONFIRM = 1;\n    const STATUS_CONFIRMED = 2;\n\n    const chatsRef = useRef(state);\n\n    useEffect(\n        () => { chatsRef.current = state },\n        [state]\n    )\n\n    const loadCallStatus = (chatIds) => {\n        axios.get(WWW_DIR_JAVASCRIPT  + \"voicevideo/joinop/\" + props.initParams.id).then(result => {\n            dispatch({\n                type: 'update',\n                value: {\n                    \"call\" : result.data\n                }\n            });\n        });\n    }\n\n    useEffect(() => {\n\n        loadCallStatus();\n\n        // Cleanup\n        return function cleanup() {\n        };\n\n    },[]);\n\n    const { t, i18n } = useTranslation('voice_call');\n\n    const cancelJoin = async (type) => {\n\n        var url = null;\n\n        if (props.isVisitor === true) {\n            url = WWW_DIR_JAVASCRIPT  + \"voicevideo/join/\" + props.initParams.id + '/' + props.initParams.hash + '/(action)/' + type;\n        } else {\n            url = WWW_DIR_JAVASCRIPT  + \"voicevideo/joinop/\" + props.initParams.id + '/' + '/(action)/' + type;\n        }\n\n        axios.get(url).then(result => {\n            dispatch({\n                type: 'update',\n                value: {\n                    \"call\" : result.data\n                }\n            });\n        });\n\n        if (type == 'leave' || type == 'end' || type == 'cancel')\n        {\n\n            Object.keys(state.localTracks).forEach(trackName => {\n                var track = state.localTracks[trackName];\n                if (track) {\n                    track.stop();\n                    track.close();\n                    state.localTracks[trackName] = undefined;\n                }\n            })\n\n            dispatch({\n                type: 'update',\n                value: {\n                    \"remoteUsers\" : {},\n                    \"uid\": null,\n                    \"localTracks\" : {\n                        videoTrack : null,\n                        audioTrack: null\n                    }\n                }\n            });\n\n            // leave the channel\n           await client.leave();\n        }\n\n    }\n\n    useInterval(\n        () => {\n\n            var url = null;\n\n            if (props.isVisitor === true) {\n                url = WWW_DIR_JAVASCRIPT + \"voicevideo/join/\" + props.initParams.id + '/' + props.initParams.hash;\n            } else {\n                url = WWW_DIR_JAVASCRIPT  + \"voicevideo/joinop/\" + props.initParams.id;\n            }\n\n            axios.get(url).then(result => {\n                dispatch({\n                    type: 'update',\n                    value: {\n                        \"call\" : result.data\n                    }\n                });\n            });\n\n        },\n        (state.call.status != STATUS_CONFIRMED || state.call.vi_status != STATUS_VI_JOINED || state.call.op_status != STATUS_OP_JOINED) ? 2000 : null\n    );\n\n    const subscribe = async (user, mediaType) => {\n        \n        const uid = user.uid;\n        \n        // subscribe to a remote user\n        await client.subscribe(user, mediaType);\n\n        dispatch({\n            type: 'user_published',\n            media: mediaType,\n            user: user\n        });\n\n        /*if (mediaType === 'audio') {\n            user.audioTrack.play();\n        }*/\n\n        /*if (mediaType === 'video') {\n            const player = $(`\n              <div id=\"player-wrapper-${uid}\">\n                <p class=\"player-name\">remoteUser(${uid})</p>\n                <div id=\"player-${uid}\" class=\"player\"></div>\n              </div>\n            `);\n            $(\"#remote-playerlist\").append(player);\n            user.videoTrack.play(`player-${uid}`);\n        }\n        if (mediaType === 'audio') {\n            user.audioTrack.play();\n        }*/\n    }\n    \n    const handleUserPublished = (user, mediaType) =>  {\n\n        subscribe(user, mediaType);\n    }\n\n    const handleUserUnpublished = (user) => {\n        //const id = user.uid;\n        //delete remoteUsers[id];\n\n        dispatch({\n            type: 'user_unpublished',\n            user: user\n        });\n\n        //$(`#player-wrapper-${id}`).remove();\n    }\n\n    useEffect(() => {\n\n        if (state.call.vi_status === STATUS_VI_JOINED && props.isVisitor == true) {\n            join(state.call);\n        }\n\n        // Cleanup\n        return function cleanup() {\n\n        };\n\n    },[state.call.vi_status]);\n\n\n    const join = async (data) => {\n        // add event listener to play remote tracks when remote user publishs.\n        client.on(\"user-published\", handleUserPublished);\n        client.on(\"user-unpublished\", handleUserUnpublished);\n\n        var uui = null;\n        var localTracks = {\n            audioTrack : null,\n            videoTrack : null\n        };\n\n        // join a channel and create local tracks, we can use Promise.all to run them concurrently\n        [ uui, localTracks.audioTrack, localTracks.videoTrack] = await Promise.all([\n            // join the channel\n            client.join(props.initParams.appid, props.initParams.id + '_' + props.initParams.hash, data.token || null),\n            // create local tracks, using microphone and camera\n            AgoraRTC.createMicrophoneAudioTrack(),\n            AgoraRTC.createCameraVideoTrack()\n        ]);\n\n        // play local video track\n        localTracks.videoTrack.play(\"local-player\");\n\n        dispatch({\n            type: 'update',\n            value: {\n                \"uid\" : uui,\n                \"inCall\": true,\n                \"localTracks\" : localTracks,\n            }\n        });\n\n        await client.publish(Object.values(localTracks));\n    }\n\n    const requestJoin = (type) => {\n\n        var url = null;\n\n        if (props.isVisitor === true) {\n            url = WWW_DIR_JAVASCRIPT  + \"voicevideo/join/\" + props.initParams.id + '/' + props.initParams.hash + '/(action)/request';\n        } else {\n            url = WWW_DIR_JAVASCRIPT  + \"voicevideo/joinop/\" + props.initParams.id + '/(action)/join';\n        }\n\n        axios.post(url).then(result => {\n            if (type == 'audiovideo') {\n                join(result.data);\n            }\n            dispatch({\n                type: 'update',\n                value: {\n                    \"call\" : result.data\n                }\n            });\n        });\n    }\n\n    console.log(state.remoteUsers);\n\n    return (\n        <React.Fragment>\n            <div className=\"d-flex flex-row flex-grow-1 pt-2\">\n                <div className=\"col bg-light mx-1 align-middle text-center d-flex pl-0 pr-0\" title={\"UID \"+state.uid} id=\"local-player\">\n                    {props.isVisitor == true && state.call.vi_status == STATUS_VI_REQUESTED && <div className=\"align-self-center mx-auto text-muted font-weight-bold\">Please wait untill operator let's you join a room</div>}\n                </div>\n                {state.inCall == true && Object.keys(state.remoteUsers).map((val, k) => {\n                    if (state.remoteUsers[val].video == true) {\n                        return (<MediaStream user={state.remoteUsers[val].user} key={\"media_\" + (state.remoteUsers[val].user.uid)} audio={state.remoteUsers[val].audio} video={state.remoteUsers[val].video} media={state.remoteUsers[val].media} />)\n                    }\n                })}\n            </div>\n            <div className=\"row header-chat desktop-header\">\n\n                <div className=\"btn-toolbar p-2 text-center mx-auto btn-toolbar\" role=\"toolbar\" aria-label=\"Toolbar with button groups\">\n\n                    <div className=\"p-2 text-center mx-auto btn-group\" role=\"group\">\n                        {props.isVisitor == true && state.call.vi_status == STATUS_VI_PENDING && <span className=\"text-muted py-2\">Please wait untill operator let's you in</span>}\n                        {props.isVisitor == false && state.call.vi_status == STATUS_VI_JOINED && <span className=\"text-muted py-2\">Visitor has joined a call!</span>}\n                        {props.isVisitor == false && state.call.vi_status == STATUS_VI_PENDING && <span className=\"text-muted py-2\">Pending visitor to join a call!</span>}\n                        {props.isVisitor == false && state.call.vi_status == STATUS_VI_REQUESTED && <span className=\"text-muted py-2\">Visitor is waiting for someone to let him in!</span>}\n                    </div>\n\n                    <div className=\"p-2 text-center mx-auto btn-group\" role=\"group\">\n                        {props.isVisitor == false && state.call.vi_status == STATUS_VI_REQUESTED && <button className=\"btn btn-sm btn-outline-secondary\" onClick={() => cancelJoin('letvisitorin')} ><span className=\"material-icons\">face</span>Let visitor in</button>}\n                        {props.isVisitor == false && state.call.op_status == STATUS_OP_JOINED && <button title=\"Leave a call. Visitor still remain on the call\" className=\"btn btn-sm btn-outline-secondary\" onClick={() => cancelJoin('leave')}><span className=\"material-icons\">call_end</span>Leave a call</button>}\n                        {props.isVisitor == false && state.call.op_status == STATUS_OP_JOINED && <button title=\"Call for the visitor also will end.\" className=\"btn btn-sm btn-outline-secondary\" onClick={() => cancelJoin('end')}><span className=\"material-icons\">call_end</span>End a call</button>}\n\n                        {( (props.isVisitor == false && state.call.op_status == STATUS_OP_PENDING) || (props.isVisitor == true && state.call.vi_status == STATUS_VI_PENDING) )&& <React.Fragment>\n                            <button className=\"btn btn-sm btn-outline-secondary\" onClick={() => requestJoin('audio')}><span className=\"material-icons\">call</span>Join with audio</button>\n                            <button className=\"btn btn-sm btn-outline-secondary\" onClick={() => requestJoin('audiovideo')}><span className=\"material-icons\">video_call</span>Join with audio & video</button>\n                        </React.Fragment>}\n\n                        {props.isVisitor == true && state.call.vi_status == STATUS_VI_JOINED && <button className=\"btn btn-primary w-100\" onClick={() => cancelJoin('cancel')} >{t('voice_call.leave_room')}</button>}\n                        {props.isVisitor == true && state.call.vi_status == STATUS_VI_REQUESTED && <button className=\"btn btn-primary w-100\" onClick={() => cancelJoin('cancel')} >{t('voice_call.cancel_join')}</button>}\n\n                    </div>\n\n                </div>\n\n            </div>\n        </React.Fragment>\n    );\n}\n\nexport default VoiceCall"],"sourceRoot":""}