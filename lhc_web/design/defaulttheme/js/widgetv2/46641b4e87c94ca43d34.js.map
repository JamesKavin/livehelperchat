{"version":3,"sources":["webpack://LiveHelperChat/./src/lib/widgets/msgSnippetWidget.js"],"names":["msgSnippetWidget","prefix","this","attributes","hidden","widgetOpen","invitationOpen","nhOpen","cont","UIConstructorIframe","helperFunctions","getAbstractStyle","zindex","width","height","position","display","loadStatus","main","theme","status","elmDomDoc","body","style","fitContent","settings","tmpl","replace","isMobile","bodyId","constructUIIframe","staticJS","elmDom","className","attachUserEventListener","e","eventEmitter","emitEvent","_that","a","stopPropagation","hide","insertCssRemoteFile","onload","checkLoadStatus","crossOrigin","href","id","LHC_API","args","lhc_base_url","theme_v","sload","subscribe","data","addListener","makeRequest","params","getSessionAttributes","showSnippet","widgetStatus","show","Date","now","persistent","msgsnippet_status","next","getElementById","innerHTML","msg_body","documentHeight","offsetHeight","placement","bottom","widgetDimesions","value","wbottom","right","wright","position_placement","left","massRestyle","onlineStatus","hideOffline"],"mappings":"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","file":"46641b4e87c94ca43d34.js","sourcesContent":["import {settings} from '../settings.js';\nimport {UIConstructorIframe} from '../UIConstructorIframe';\nimport {helperFunctions} from '../helperFunctions';\n\nexport class msgSnippetWidget{\n    constructor(prefix) {\n\n        this.attributes = {};\n        this.hidden = false;\n        this.widgetOpen = false;\n        this.invitationOpen = false;\n        this.nhOpen = false;\n\n        this.cont = new UIConstructorIframe((prefix || 'lhc')+'_msgsnippet_widget_v2', helperFunctions.getAbstractStyle({\n            zindex: \"2147483639\",\n            width: \"300px\",\n            height: \"200px\",\n            position: \"fixed\",\n            display: \"none\",\n        }), null, \"iframe\");\n\n        this.loadStatus = {main : false, theme: false, status: false};\n    }\n\n    checkLoadStatus() {\n        if (this.loadStatus['theme'] == true && this.loadStatus['main'] == true && this.loadStatus['status'] == true) {\n            this.cont.elmDomDoc.body.style.display = \"\";\n            this.fitContent();\n        }\n    }\n\n    init(attributes, settings) {\n\n        this.attributes = attributes;\n\n        this.attributes = attributes;\n\n        this.cont.tmpl = settings['msg'].replace('{dev_type}',(this.attributes.isMobile === true ? 'lhc-mobile' : 'lhc-desktop')).replace('{msg_body}',settings['msg_body']);\n        this.cont.bodyId = 'msgsnippet';\n\n        if (this.cont.constructUIIframe('', this.attributes.staticJS['dir']) === null){\n            return null;\n        }\n\n        // Content invisible untill media loads\n        this.cont.elmDomDoc.body.style.display = \"none\";\n\n        this.cont.elmDom.className += this.attributes.isMobile === true ? ' lhc-mobile' : ' lhc-desktop';\n\n        this.cont.attachUserEventListener(\"click\", function (e) {\n            attributes.eventEmitter.emitEvent('msgSnippetClicked', [{'event': e, 'sender' : 'closeButton'}]);\n            attributes.eventEmitter.emitEvent('showWidget', [{'event': e}]);\n        }, \"start-chat-btn\",'msgsnippetstart');\n\n        var _that = this;\n\n        this.cont.attachUserEventListener(\"click\", function (a) {\n            attributes.eventEmitter.emitEvent('msgsnippetClosed', [{'sender' : 'closeButton'}]);\n            a.stopPropagation();\n            _that.hide(true);\n        }, \"close-need-help-btn\",'msgsnippetclose');\n\n        this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['main'] = true; this.checkLoadStatus()},crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_css']}, true);\n\n        if (this.attributes.isMobile == true) {\n            this.cont.insertCssRemoteFile({crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_mobile_css']});\n        }\n\n        if (this.attributes.theme > 0) {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + this.attributes.theme_v}, true);\n        } else {\n            this.loadStatus['theme'] = true;\n            this.checkLoadStatus();\n        }\n\n        // Show need help only if status widget is loaded\n        attributes.sload.subscribe((data) => {if(data){this.loadStatus['status'] = true; this.checkLoadStatus()}});\n\n        attributes.eventEmitter.emitEvent('showMsgSnippet', [{'sender' : 'closeButton'}]);\n\n        attributes.eventEmitter.addListener('unread_message', () => {\n            if (this.hidden == false) {\n                helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                    this.showSnippet(data, false);\n                })\n            }\n        });\n\n        attributes.eventEmitter.addListener('hide_msg_snippet', () => {\n            this.hide(true);\n        });\n\n        attributes.widgetStatus.subscribe((data) => {\n            data == true ? (this.widgetOpen = true, this.hide(true)) : (this.widgetOpen = false, this.show());\n        });\n\n        attributes.eventEmitter.addListener('reloadWidget',() => {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + Date.now()}, true);\n        });\n    }\n\n    hide (persistent) {\n\n        if (typeof persistent !== 'undefined' && persistent === true) {\n            this.hidden = true;\n        }\n\n        this.cont.hide();\n\n        if (this.nhOpen == true) {\n            this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n        }\n\n        this.attributes.msgsnippet_status.next(false);\n        this.nhOpen = false;\n    }\n\n    showSnippet(data, showSnippet) {\n        if (showSnippet == true) {\n            this.hidden = false;\n            this.show();\n        }\n        this.cont.elmDomDoc.getElementById('messages-scroll').innerHTML = data.msg_body;\n        this.fitContent();\n    }\n\n    fitContent() {\n\n        var documentHeight = this.cont.elmDomDoc.getElementById('messages-scroll').offsetHeight;\n\n        var placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n\n        var leftPosition = false;\n\n        if (this.attributes.position_placement == 'bottom_left' || this.attributes.position_placement == 'full_height_left') {\n            placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_left') {\n            placement = {bottom: \"calc(50% + 35px)\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_right') {\n            placement = {bottom: \"calc(50% + 35px)\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n        }\n\n        this.cont.massRestyle(placement);\n    }\n\n    show () {\n        if (this.hidden == true || this.widgetOpen == true || this.invitationOpen == true || this.attributes.onlineStatus.value == false) {\n            return;\n        }\n\n        if (this.attributes.hideOffline === false) {\n            this.cont.show();\n            if (this.nhOpen == false) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetShow', []);\n                this.attributes.msgsnippet_status.next(true);\n            }\n            this.nhOpen = true;\n        } else {\n            this.cont.hide();\n            if (this.nhOpen == true) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n                this.attributes.msgsnippet_status.next(false);\n            }\n            this.nhOpen = false;\n        }\n    }\n}"],"sourceRoot":""}