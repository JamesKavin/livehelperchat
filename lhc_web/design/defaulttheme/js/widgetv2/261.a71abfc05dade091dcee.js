"use strict";(self.webpackChunkLHCReactAPP=self.webpackChunkLHCReactAPP||[]).push([[261],{261:(t,e,a)=>{a.r(e),a.d(e,{nodeJSChat:()=>_});var n=a(8926),i=a.n(n),s=a(4575),r=a.n(s),c=a(3913),h=a.n(c),o=a(7003),d=a.n(o),u=a(7757),p=a.n(u),g=a(2137),l=a(6512),_=new(function(){function t(){var e=this;r()(this,t),this.socket=null,g.a.eventEmitter.addListener("endedChat",(function(){null!==e.socket&&e.socket.destroy()}))}var e;return h()(t,[{key:"bootstrap",value:(e=i()(p().mark((function t(e,n,s){var r,c,h,o,u,_,m,v,w,f,b,x,k,y,D,I,E,P,C;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y=function(){return(y=i()(p().mark((function t(){var a,i,r,h,o,u,v,x,k,y,D;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=null==m,m=e.instance_id>0?_.subscribe("chat_"+e.instance_id+"_"+c):_.subscribe("chat_"+c),t.next=4,m.listener("subscribe").once();case 4:if(_.transmitPublish(e.instance_id>0?"chat_"+e.instance_id+"_"+c:"chat_"+c,{op:"vi_online",status:!0}),g.a.eventEmitter.addListener("visitorTyping",w),g.a.eventEmitter.addListener("messageSend",f),g.a.eventEmitter.addListener("messageSendError",b),n({type:"CHAT_UI_UPDATE",data:{sync_interval:1e4}}),n({type:"CHAT_ADD_OVERRIDE",data:"typing"}),1!=a){t.next=39;break}i=!1,r=!1,t.prev=13,o=d()(m);case 15:return t.next=17,o.next();case 17:if(!(i=!(u=t.sent).done)){t.next=23;break}"ot"==(v=u.value).op?1==v.data.status?n({type:"chat_status_changed",data:{text:v.data.ttx}}):n({type:"chat_status_changed",data:{text:""}}):"cmsg"==v.op||"schange"==v.op?(x=s()).chatwidget.hasIn(["chatData","id"])&&n((0,l.W4)({chat_id:x.chatwidget.getIn(["chatData","id"]),hash:x.chatwidget.getIn(["chatData","hash"]),lmgsid:x.chatwidget.getIn(["chatLiveData","lmsgid"]),theme:x.chatwidget.get("theme")})):"umsg"==v.op?(k=s()).chatwidget.hasIn(["chatData","id"])&&(0,l.o6)({msg_id:v.msid,id:k.chatwidget.getIn(["chatData","id"]),hash:k.chatwidget.getIn(["chatData","hash"])})(n,s):"schange"==v.op||"cclose"==v.op?(y=s()).chatwidget.hasIn(["chatData","id"])&&n((0,l.kW)({chat_id:y.chatwidget.getIn(["chatData","id"]),hash:y.chatwidget.getIn(["chatData","hash"]),mode:y.chatwidget.get("mode"),theme:y.chatwidget.get("theme")})):"vo"==v.op&&(D=s()).chatwidget.hasIn(["chatData","id"])&&_.transmitPublish(e.instance_id>0?"chat_"+e.instance_id+"_"+D.chatwidget.getIn(["chatData","id"]):"chat_"+D.chatwidget.getIn(["chatData","id"]),{op:"vi_online",status:!0});case 20:i=!1,t.next=15;break;case 23:t.next=29;break;case 25:t.prev=25,t.t0=t.catch(13),r=!0,h=t.t0;case 29:if(t.prev=29,t.prev=30,!i||null==o.return){t.next=34;break}return t.next=34,o.return();case 34:if(t.prev=34,!r){t.next=37;break}throw h;case 37:return t.finish(34);case 38:return t.finish(29);case 39:case"end":return t.stop()}}),t,null,[[13,25,29,39],[30,,34,38]])})))).apply(this,arguments)},k=function(){return y.apply(this,arguments)},x=function(){if(console.log("disconnect"),null!==m)try{m.destroy()}catch(t){}g.a.eventEmitter.removeListener("visitorTyping",w),g.a.eventEmitter.removeListener("messageSend",f),g.a.eventEmitter.removeListener("messageSendError",b),n({type:"CHAT_UI_UPDATE",data:{sync_interval:h}}),n({type:"CHAT_REMOVE_OVERRIDE",data:"typing"})},b=function(t){e.instance_id>0?_.transmitPublish("chat_"+e.instance_id+"_"+c,{op:"vt",msg:"📕️ error happened while sending visitor message, please inform your administrator!"}):_.transmitPublish("chat_"+c,{op:"vt",msg:"📕️ error happened while sending visitor message, please inform your administrator!"})},f=function(t){e.instance_id>0?_.transmitPublish("chat_"+e.instance_id+"_"+c,{op:"vt",msg:"✉️ "+t.msg}):_.transmitPublish("chat_"+c,{op:"vt",msg:"✉️ "+t.msg})},w=function(t){console.log("typing listener"),1==t.status?e.instance_id>0?_.transmitPublish("chat_"+e.instance_id+"_"+c,{op:"vt",msg:t.msg}):_.transmitPublish("chat_"+c,{op:"vt",msg:t.msg}):e.instance_id>0?_.transmitPublish("chat_"+e.instance_id+"_"+c,{op:"vts"}):_.transmitPublish("chat_"+c,{op:"vts"})},v=function(){var t=s(),a=t.chatwidget.getIn(["chatData","id"]);window.lhcAxios.post(window.lhcChat.base_url+"nodejshelper/tokenvisitor/"+a+"/"+t.chatwidget.getIn(["chatData","hash"]),null,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){var t=i()(p().mark((function t(n){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([_.invoke("login",{hash:n.data,chanelName:e.instance_id>0?"chat_"+e.instance_id+"_"+a:"chat_"+a}),_.listener("authenticate").once()]);case 2:k();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},r=s(),c=r.chatwidget.getIn(["chatData","id"]),r.chatwidget.getIn(["chatData","hash"]),h=r.chatwidget.getIn(["chat_ui","sync_interval"]),o={hostname:e.hostname,path:e.path,autoReconnectOptions:{initialDelay:5e3,randomness:5e3}},""!=e.port&&(o.port=parseInt(e.port)),1==e.secure&&(o.secure=!0),e.instance_id>0&&e.instance_id,u=a(2984),_=this.socket=u.create(o),m=null,t.next=20,_.listener("connect").once();case 20:t.sent.isAuthenticated?k():v(),i()(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_.listener("disconnect").once();case 2:x();case 3:case"end":return t.stop()}}),t)})))(),D=!1,I=!1,t.prev=25,P=d()(_.listener("deauthenticate"));case 27:return t.next=29,P.next();case 29:if(!(D=!(C=t.sent).done)){t.next=35;break}C.value,v();case 32:D=!1,t.next=27;break;case 35:t.next=41;break;case 37:t.prev=37,t.t0=t.catch(25),I=!0,E=t.t0;case 41:if(t.prev=41,t.prev=42,!D||null==P.return){t.next=46;break}return t.next=46,P.return();case 46:if(t.prev=46,!I){t.next=49;break}throw E;case 49:return t.finish(46);case 50:return t.finish(41);case 51:case"end":return t.stop()}}),t,this,[[25,37,41,51],[42,,46,50]])}))),function(t,a,n){return e.apply(this,arguments)})}]),t}())}}]);
//# sourceMappingURL=261.a71abfc05dade091dcee.js.map