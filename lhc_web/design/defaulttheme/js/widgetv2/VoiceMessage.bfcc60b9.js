parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"vTl5":[function(require,module,exports) {
"use strict";function e(e){return(e|=0)<10?`0${e}`:`${Math.min(e,99)}`}function t(){function e(e,t){return new Promise((s,i)=>{const r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.onload=(()=>{s(WebAssembly.instantiate(r.response,t))}),r.onerror=i,r.send()})}let t=null,s=5242880;function i(e){const t=s;return s+=e,t}function r(e){postMessage({type:"internal-error",data:e})}let n=null,a=null,o=null;onmessage=(s=>{const c=s.data;switch(c.type){case"init":const{wasmURL:s,shimURL:l}=c.data;Promise.resolve().then(()=>(self.WebAssembly&&!function(){const e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)}()&&delete self.WebAssembly,self.WebAssembly||importScripts(l),{memory:t=new WebAssembly.Memory({initial:256,maximum:256}),pow:Math.pow,exit:r,powf:Math.pow,exp:Math.exp,sqrtf:Math.sqrt,cos:Math.cos,log:Math.log,sin:Math.sin,sbrk:i})).then(t=>(function(t,s){if(!WebAssembly.instantiateStreaming)return e(t,s);const i=fetch(t,{credentials:"same-origin"});return WebAssembly.instantiateStreaming(i,s).catch(i=>{if(i.message&&i.message.indexOf("Argument 0 must be provided and must be a Response")>0)return e(t,s);throw i})})(s,{env:t})).then(e=>{n=e.instance.exports,postMessage({type:"init",data:null})}).catch(e=>{postMessage({type:"init-error",data:e.toString()})});break;case"start":if(!function(e){if(!(a=n.vmsg_init(e)))return!1;const s=new Uint32Array(t.buffer,a,1)[0];return o=new Float32Array(t.buffer,s),!0}(c.data))return postMessage({type:"error",data:"vmsg_init"});break;case"data":if(!function(e){return o.set(e),n.vmsg_encode(a,e.length)>=0}(c.data))return postMessage({type:"error",data:"vmsg_encode"});break;case"stop":const d=function(){if(n.vmsg_flush(a)<0)return null;const e=new Uint32Array(t.buffer,a+4,1)[0],s=new Uint32Array(t.buffer,a+8,1)[0],i=new Uint8Array(t.buffer,e,s),r=new Blob([i],{type:"audio/mpeg"});return n.vmsg_free(a),a=null,o=null,r}();if(!d)return postMessage({type:"error",data:"vmsg_flush"});postMessage({type:"stop",data:d})}})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.record=n,exports.default=exports.Form=exports.Recorder=void 0;class s{constructor(e={},t=null){this.wasmURL=new URL(e.wasmURL||"/static/js/vmsg.wasm",location).href,this.shimURL=new URL(e.shimURL||"/static/js/wasm-polyfill.js",location).href,this.onStop=t,this.pitch=e.pitch||0,this.stream=null,this.audioCtx=null,this.gainNode=null,this.pitchFX=null,this.encNode=null,this.worker=null,this.workerURL=null,this.blob=null,this.blobURL=null,this.resolve=null,this.reject=null,Object.seal(this)}close(){this.encNode&&this.encNode.disconnect(),this.encNode&&(this.encNode.onaudioprocess=null),this.stream&&this.stopTracks(),this.audioCtx&&this.audioCtx.close(),this.worker&&this.worker.terminate(),this.workerURL&&URL.revokeObjectURL(this.workerURL),this.blobURL&&URL.revokeObjectURL(this.blobURL)}initAudio(){return(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?function(e){return navigator.mediaDevices.getUserMedia(e)}:function(e){const t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(s,i){t.call(navigator,e,s,i)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})({audio:!0}).then(e=>{this.stream=e;const t=this.audioCtx=new(window.AudioContext||window.webkitAudioContext),s=t.createMediaStreamSource(e),i=this.gainNode=(t.createGain||t.createGainNode).call(t);i.gain.value=1,s.connect(i);const r=this.pitchFX=new u(t);r.setPitchOffset(this.pitch);const n=this.encNode=(t.createScriptProcessor||t.createJavaScriptNode).call(t,0,1,1);r.output.connect(n),i.connect(0===this.pitch?n:r.input)})}initWorker(){if(!this.stream)throw new Error("missing audio initialization");const e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),s=this.workerURL=URL.createObjectURL(e),i=this.worker=new Worker(s),{wasmURL:r,shimURL:n}=this;return i.postMessage({type:"init",data:{wasmURL:r,shimURL:n}}),new Promise((e,t)=>{i.onmessage=(s=>{const i=s.data;switch(i.type){case"init":e();break;case"init-error":t(new Error(i.data));break;case"error":case"internal-error":console.error("Worker error:",i.data),this.reject&&this.reject(i.data);break;case"stop":this.blob=i.data,this.blobURL=URL.createObjectURL(i.data),this.onStop&&this.onStop(),this.resolve&&this.resolve(this.blob)}})})}init(){return this.initAudio().then(this.initWorker.bind(this))}startRecording(){if(!this.stream)throw new Error("missing audio initialization");if(!this.worker)throw new Error("missing worker initialization");this.blob=null,this.blobURL&&URL.revokeObjectURL(this.blobURL),this.blobURL=null,this.resolve=null,this.reject=null,this.worker.postMessage({type:"start",data:this.audioCtx.sampleRate}),this.encNode.onaudioprocess=(e=>{const t=e.inputBuffer.getChannelData(0);this.worker.postMessage({type:"data",data:t})}),this.encNode.connect(this.audioCtx.destination)}stopRecording(){if(!this.stream)throw new Error("missing audio initialization");if(!this.worker)throw new Error("missing worker initialization");return this.encNode.disconnect(),this.encNode.onaudioprocess=null,this.stopTracks(),this.worker.postMessage({type:"stop",data:null}),new Promise((e,t)=>{this.resolve=e,this.reject=t})}stopTracks(){this.stream.getTracks&&this.stream.getTracks().forEach(e=>e.stop())}}exports.Recorder=s;class i{constructor(e={},t,i){this.recorder=new s(e,this.onStop.bind(this)),this.resolve=t,this.reject=i,this.backdrop=null,this.popup=null,this.recordBtn=null,this.stopBtn=null,this.timer=null,this.audio=null,this.saveBtn=null,this.tid=0,this.start=0,Object.seal(this),this.recorder.initAudio().then(()=>this.drawInit()).then(()=>this.recorder.initWorker()).then(()=>this.drawAll()).catch(e=>this.drawError(e))}drawInit(){if(this.backdrop)return;const e=this.backdrop=document.createElement("div");e.className="vmsg-backdrop",e.addEventListener("click",()=>this.close(null));const t=this.popup=document.createElement("div");t.className="vmsg-popup",t.addEventListener("click",e=>e.stopPropagation());const s=document.createElement("div");s.className="vmsg-progress";for(let i=0;i<3;i++){const e=document.createElement("div");e.className="vmsg-progress-dot",s.appendChild(e)}t.appendChild(s),e.appendChild(t),document.body.appendChild(e)}drawTime(t){const s=Math.round(t/1e3);this.timer.textContent=e(s/60)+":"+e(s%60)}drawAll(){this.drawInit(),this.clearAll();const e=document.createElement("div");e.className="vmsg-record-row",this.popup.appendChild(e);const t=this.recordBtn=document.createElement("button");t.className="vmsg-button vmsg-record-button",t.textContent="●",t.addEventListener("click",()=>this.startRecording()),e.appendChild(t);const s=this.stopBtn=document.createElement("button");s.className="vmsg-button vmsg-stop-button",s.style.display="none",s.textContent="■",s.addEventListener("click",()=>this.stopRecording()),e.appendChild(s);const i=this.audio=new Audio;i.autoplay=!0;const r=this.timer=document.createElement("span");r.className="vmsg-timer",r.addEventListener("click",()=>{i.paused?this.recorder.blobURL&&(i.src=this.recorder.blobURL):i.pause()}),this.drawTime(0),e.appendChild(r);const n=this.saveBtn=document.createElement("button");n.className="vmsg-button vmsg-save-button",n.textContent="✓",n.disabled=!0,n.addEventListener("click",()=>this.close(this.recorder.blob)),e.appendChild(n);const a=document.createElement("div");a.className="vmsg-slider-wrapper vmsg-gain-slider-wrapper";const o=document.createElement("input");o.className="vmsg-slider vmsg-gain-slider",o.setAttribute("type","range"),o.min=0,o.max=2,o.step=.2,o.value=1,o.onchange=(()=>{const e=+o.value;this.recorder.gainNode.gain.value=e}),a.appendChild(o),this.popup.appendChild(a);const c=document.createElement("div");c.className="vmsg-slider-wrapper vmsg-pitch-slider-wrapper";const l=document.createElement("input");l.className="vmsg-slider vmsg-pitch-slider",l.setAttribute("type","range"),l.min=-1,l.max=1,l.step=.2,l.value=this.recorder.pitch,l.onchange=(()=>{const e=+l.value;this.recorder.pitchFX.setPitchOffset(e),this.recorder.gainNode.disconnect(),this.recorder.gainNode.connect(0===e?this.recorder.encNode:this.recorder.pitchFX.input)}),c.appendChild(l),this.popup.appendChild(c)}drawError(e){console.error(e),this.drawInit(),this.clearAll();const t=document.createElement("div");t.className="vmsg-error",t.textContent=e.toString(),this.popup.appendChild(t)}clearAll(){this.popup&&(this.popup.innerHTML="")}close(e){this.audio&&this.audio.pause(),this.tid&&clearTimeout(this.tid),this.recorder.close(),this.backdrop.remove(),e?this.resolve(e):this.reject(new Error("No record made"))}onStop(){this.recordBtn.style.display="",this.stopBtn.style.display="none",this.stopBtn.disabled=!1,this.saveBtn.disabled=!1}startRecording(){this.audio.pause(),this.start=Date.now(),this.updateTime(),this.recordBtn.style.display="none",this.stopBtn.style.display="",this.saveBtn.disabled=!0,this.recorder.startRecording()}stopRecording(){clearTimeout(this.tid),this.tid=0,this.stopBtn.disabled=!0,this.recorder.stopRecording()}updateTime(){this.drawTime(Date.now()-this.start),this.tid=setTimeout(()=>this.updateTime(),300)}}exports.Form=i;let r=!1;function n(e){return new Promise((t,s)=>{if(r)throw new Error("Record form is already opened");r=!0,new i(e,t,s)}).then(e=>(r=!1,e),e=>{throw r=!1,e})}var a={Recorder:s,Form:i,record:n};exports.default=a;const o=.1,c=.05,l=.1;function d(e,t,s){for(var i=t*e.sampleRate,r=i+(t-2*s)*e.sampleRate,n=e.createBuffer(1,r,e.sampleRate),a=n.getChannelData(0),o=s*e.sampleRate,c=o,l=i-o,d=0;d<i;++d){var h;h=d<c?Math.sqrt(d/o):d>=l?Math.sqrt(1-(d-l)/o):1,a[d]=h}for(d=i;d<r;++d)a[d]=0;return n}function h(e,t,s,i){for(var r=t*e.sampleRate,n=r+(t-2*s)*e.sampleRate,a=e.createBuffer(1,n,e.sampleRate),o=a.getChannelData(0),c=0;c<r;++c)o[c]=i?(r-c)/n:c/r;for(c=r;c<n;++c)o[c]=0;return a}function u(e){this.context=e;var t=(e.createGain||e.createGainNode).call(e),s=(e.createGain||e.createGainNode).call(e);this.input=t,this.output=s;var i=e.createBufferSource(),r=e.createBufferSource(),n=e.createBufferSource(),a=e.createBufferSource();this.shiftDownBuffer=h(e,l,c,!1),this.shiftUpBuffer=h(e,l,c,!0),i.buffer=this.shiftDownBuffer,r.buffer=this.shiftDownBuffer,n.buffer=this.shiftUpBuffer,a.buffer=this.shiftUpBuffer,i.loop=!0,r.loop=!0,n.loop=!0,a.loop=!0;var u=(e.createGain||e.createGainNode).call(e),p=(e.createGain||e.createGainNode).call(e),m=(e.createGain||e.createGainNode).call(e);m.gain.value=0;var f=(e.createGain||e.createGainNode).call(e);f.gain.value=0,i.connect(u),r.connect(p),n.connect(m),a.connect(f);var g=(e.createGain||e.createGainNode).call(e),b=(e.createGain||e.createGainNode).call(e),v=(e.createDelay||e.createDelayNode).call(e),w=(e.createDelay||e.createDelayNode).call(e);u.connect(g),p.connect(b),m.connect(g),f.connect(b),g.connect(v.delayTime),b.connect(w.delayTime);var y=e.createBufferSource(),R=e.createBufferSource(),k=d(e,l,c);y.buffer=k,R.buffer=k,y.loop=!0,R.loop=!0;var U=(e.createGain||e.createGainNode).call(e),N=(e.createGain||e.createGainNode).call(e);U.gain.value=0,N.gain.value=0,y.connect(U.gain),R.connect(N.gain),t.connect(v),t.connect(w),v.connect(U),w.connect(N),U.connect(s),N.connect(s);var L=e.currentTime+.05,G=L+l-c;i.start(L),r.start(G),n.start(L),a.start(G),y.start(L),R.start(G),this.mod1=i,this.mod2=r,this.mod1Gain=u,this.mod2Gain=p,this.mod3Gain=m,this.mod4Gain=f,this.modGain1=g,this.modGain2=b,this.fade1=y,this.fade2=R,this.mix1=U,this.mix2=N,this.delay1=v,this.delay2=w,this.setDelay(o)}u.prototype.setDelay=function(e){this.modGain1.gain.setTargetAtTime(.5*e,0,.01),this.modGain2.gain.setTargetAtTime(.5*e,0,.01)},u.prototype.setPitchOffset=function(e){e>0?(this.mod1Gain.gain.value=0,this.mod2Gain.gain.value=0,this.mod3Gain.gain.value=1,this.mod4Gain.gain.value=1):(this.mod1Gain.gain.value=1,this.mod2Gain.gain.value=1,this.mod3Gain.gain.value=0,this.mod4Gain.gain.value=0),this.setDelay(o*Math.abs(e))};
},{}],"JlbS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=h(require("@babel/runtime/regenerator")),t=h(require("@babel/runtime/helpers/asyncToGenerator")),r=h(require("@babel/runtime/helpers/classCallCheck")),i=h(require("@babel/runtime/helpers/createClass")),a=h(require("@babel/runtime/helpers/possibleConstructorReturn")),n=h(require("@babel/runtime/helpers/getPrototypeOf")),s=h(require("@babel/runtime/helpers/assertThisInitialized")),o=h(require("@babel/runtime/helpers/inherits")),l=h(require("@babel/runtime/helpers/defineProperty")),u=f(require("react")),c=h(require("vmsg")),d=require("react-i18next");function p(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return p=function(){return e},e}function f(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=p();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var n=i?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(r,a,n):r[a]=e[a]}return r.default=e,t&&t.set(e,r),r}function h(e){return e&&e.__esModule?e:{default:e}}var m=new c.default.Recorder({wasmURL:window.lhcChat.staticJS.chunk_js+"/vmsg.8c4a15f2.wasm",shimURL:"https://unpkg.com/wasm-polyfill.js@0.2.0/wasm-polyfill.js"}),g=function(c){function d(e){var t;return(0,r.default)(this,d),t=(0,a.default)(this,(0,n.default)(d).call(this,e)),(0,l.default)((0,s.default)(t),"state",{isLoading:!1,isRecording:!1,isPlaying:!1,recording:null,audioDuration:0,currentTime:0}),t.startRecording=t.startRecording.bind((0,s.default)(t)),t.stopRecording=t.stopRecording.bind((0,s.default)(t)),t.playRecord=t.playRecord.bind((0,s.default)(t)),t.stopPlayRecord=t.stopPlayRecord.bind((0,s.default)(t)),t.sendRecord=t.sendRecord.bind((0,s.default)(t)),t.durationInterval=null,t.playInterval=null,t}return(0,o.default)(d,c),(0,i.default)(d,[{key:"startRecording",value:function(){var r=(0,t.default)(e.default.mark(function t(){var r=this;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopPlayRecord(),this.setState({isLoading:!0,audioDuration:0,recording:null,isPlaying:!1,currentTime:0}),e.prev=2,e.next=5,m.initAudio();case 5:return e.next=7,m.initWorker();case 7:m.startRecording(),this.setState({isLoading:!1,isRecording:!0}),this.durationInterval=setInterval(function(){r.setState({audioDuration:r.state.audioDuration+1}),r.state.audioDuration>=r.props.maxSeconds&&r.stopRecording()},1e3),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),alert(e.t0),this.setState({isLoading:!1});case 16:case"end":return e.stop()}},t,this,[[2,12]])}));return function(){return r.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var r=(0,t.default)(e.default.mark(function t(){var r;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.stopRecording();case 2:r=e.sent,this.audio=new Audio,this.audio.src=URL.createObjectURL(r),this.setState({isLoading:!1,isRecording:!1,recording:r}),clearInterval(this.durationInterval);case 7:case"end":return e.stop()}},t,this)}));return function(){return r.apply(this,arguments)}}()},{key:"playRecord",value:function(){var e=this;this.audio.currentTime=0,this.audio.play(),this.setState({isPlaying:!0}),this.playInterval=setInterval(function(){e.setState({currentTime:Math.round(e.audio.currentTime)}),(e.audio.ended||e.audio.paused)&&e.stopPlayRecord()},1e3)}},{key:"stopPlayRecord",value:function(){this.state.isPlaying&&(clearInterval(this.playInterval),this.audio.currentTime=0,this.audio.pause(),this.setState({isPlaying:!1,currentTime:0}))}},{key:"sendRecord",value:function(){var e=this,t=this.props.t;this.props.progress(t("file.uploading"));var r=new XMLHttpRequest,i=new FormData;i.append("files",this.state.recording,"record.mp3"),r.open("POST",this.props.base_url+"/file/uploadfile/"+this.props.chat_id+"/"+this.props.hash),r.upload.addEventListener("load",function(t){e.props.progress("100%"),e.props.onCompletion(),e.props.cancel()}),r.send(i)}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){this.stopPlayRecord(),this.state.isRecording&&m.stopRecording()}},{key:"pad",value:function(e){return e<10?"0"+e:e}},{key:"render",value:function(){var e=this,t=this.state,r=(t.isLoading,t.isRecording),i=t.recording,a=t.isPlaying,n=this.props.t;return u.default.createElement("div",{className:"text-nowrap"},u.default.createElement("i",{className:"material-icons pointer text-danger fs25",title:n("voice.cancel_voice_message"),onClick:function(){return e.props.cancel()}},"close"),!r&&u.default.createElement("i",{className:"material-icons fs25 pointer text-danger mr-0",title:n("voice.record_voice_message"),onClick:this.startRecording},"fiber_manual_record"),r&&u.default.createElement("i",{className:"material-icons fs25 pointer text-danger mr-0",title:n("voice.stop_recording"),onClick:this.stopRecording},"stop"),i&&!1===a&&u.default.createElement("i",{className:"material-icons pointer text-success mr-0 fs25",title:n("voice.play_recorded"),onClick:this.playRecord},"play_arrow"),i&&!0===a&&u.default.createElement("i",{className:"material-icons pointer text-success mr-0 fs25",title:n("voice.stop_playing_recorded"),onClick:this.stopPlayRecord},"stop"),u.default.createElement("span",{className:"fs12 pl-1 pr-1"},r?"":a?this.pad(this.state.currentTime)+":":"",r||!i?this.props.maxSeconds-this.state.audioDuration+" s.":this.pad(this.state.audioDuration)+(a?"":"s.")),i&&u.default.createElement("i",{className:"material-icons pointer text-success mr-0 fs25",title:n("voice.send"),onClick:this.sendRecord},"send"))}}]),d}(u.PureComponent),v=(0,d.withTranslation)()(g);exports.default=v;
},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","@babel/runtime/helpers/assertThisInitialized":"E7HD","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/defineProperty":"IxO8","react":"n8MK","vmsg":"vTl5","react-i18next":"LuhD"}]},{},[], null)