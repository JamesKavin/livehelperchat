"use strict";(self.webpackChunkLHCReactAPP=self.webpackChunkLHCReactAPP||[]).push([[261],{261:(e,t,a)=>{a.r(t),a.d(t,{nodeJSChat:()=>g});var n=a(8926),r=a.n(n),s=a(4575),i=a.n(s),c=a(3913),h=a.n(c),u=a(7003),o=a.n(u),d=a(7757),p=a.n(d),l=a(2137),v=a(6512),g=new(function(){function e(){var t=this;i()(this,e),this.socket=null,l.a.eventEmitter.addListener("endedChat",(function(){null!==t.socket&&t.socket.disconnect()}))}return h()(e,[{key:"bootstrap",value:function(e,t,n){console.log("connect");var s=n(),i=s.chatwidget.getIn(["chatData","id"]),c=(s.chatwidget.getIn(["chatData","hash"]),s.chatwidget.getIn(["chat_ui","sync_interval"])),h={hostname:e.hostname,path:e.path,autoReconnectOptions:{initialDelay:5e3,randomness:5e3}};""!=e.port&&(h.port=parseInt(e.port)),1==e.secure&&(h.secure=!0),e.instance_id>0&&e.instance_id;var u=a(2984),d=this.socket=u.create(h),g=null;function _(){var t=n(),a=t.chatwidget.getIn(["chatData","id"]);window.lhcAxios.post(window.lhcChat.base_url+"nodejshelper/tokenvisitor/"+a+"/"+t.chatwidget.getIn(["chatData","hash"]),null,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){var t=r()(p().mark((function t(n){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([d.invoke("login",{hash:n.data,chanelName:e.instance_id>0?"chat_"+e.instance_id+"_"+a:"chat_"+a}),d.listener("authenticate").once()]);case 2:w();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}function m(t){console.log("typing listener"),1==t.status?e.instance_id>0?d.transmitPublish("chat_"+e.instance_id+"_"+i,{op:"vt",msg:t.msg}):d.transmitPublish("chat_"+i,{op:"vt",msg:t.msg}):e.instance_id>0?d.transmitPublish("chat_"+e.instance_id+"_"+i,{op:"vts"}):d.transmitPublish("chat_"+i,{op:"vts"})}function f(t){e.instance_id>0?d.transmitPublish("chat_"+e.instance_id+"_"+i,{op:"vt",msg:"✉️ "+t.msg}):d.transmitPublish("chat_"+i,{op:"vt",msg:"✉️ "+t.msg})}function x(t){e.instance_id>0?d.transmitPublish("chat_"+e.instance_id+"_"+i,{op:"vt",msg:"📕️ error happened while sending visitor message, please inform your administrator!"}):d.transmitPublish("chat_"+i,{op:"vt",msg:"📕️ error happened while sending visitor message, please inform your administrator!"})}function b(){if(null!==g)try{g.unsubscribe()}catch(e){}l.a.eventEmitter.removeListener("visitorTyping",m),l.a.eventEmitter.removeListener("messageSend",f),l.a.eventEmitter.removeListener("messageSendError",x),t({type:"CHAT_UI_UPDATE",data:{sync_interval:c}}),t({type:"CHAT_REMOVE_OVERRIDE",data:"typing"})}function w(){return k.apply(this,arguments)}function k(){return(k=r()(p().mark((function a(){var r,s,c,h,u,_,b,w,k,D,y,I,E,P,C,A;return p().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r=null==g,g=e.instance_id>0?d.subscribe("chat_"+e.instance_id+"_"+i):d.subscribe("chat_"+i),l.a.eventEmitter.addListener("visitorTyping",m),l.a.eventEmitter.addListener("messageSend",f),l.a.eventEmitter.addListener("messageSendError",x),t({type:"CHAT_UI_UPDATE",data:{sync_interval:1e4}}),t({type:"CHAT_ADD_OVERRIDE",data:"typing"}),1!=r){a.next=64;break}s=!1,c=!1,a.prev=10,u=o()(g.listener("subscribe"));case 12:return a.next=14,u.next();case 14:if(!(s=!(_=a.sent).done)){a.next=20;break}_.value,d.transmitPublish(e.instance_id>0?"chat_"+e.instance_id+"_"+i:"chat_"+i,{op:"vi_online",status:!0});case 17:s=!1,a.next=12;break;case 20:a.next=26;break;case 22:a.prev=22,a.t0=a.catch(10),c=!0,h=a.t0;case 26:if(a.prev=26,a.prev=27,!s||null==u.return){a.next=31;break}return a.next=31,u.return();case 31:if(a.prev=31,!c){a.next=34;break}throw h;case 34:return a.finish(31);case 35:return a.finish(26);case 36:b=!1,w=!1,a.prev=38,D=o()(g);case 40:return a.next=42,D.next();case 42:if(!(b=!(y=a.sent).done)){a.next=48;break}"ot"==(I=y.value).op?1==I.data.status?t({type:"chat_status_changed",data:{text:I.data.ttx}}):t({type:"chat_status_changed",data:{text:""}}):"cmsg"==I.op||"schange"==I.op?(E=n()).chatwidget.hasIn(["chatData","id"])&&t((0,v.W4)({chat_id:E.chatwidget.getIn(["chatData","id"]),hash:E.chatwidget.getIn(["chatData","hash"]),lmgsid:E.chatwidget.getIn(["chatLiveData","lmsgid"]),theme:E.chatwidget.get("theme")})):"umsg"==I.op?(P=n()).chatwidget.hasIn(["chatData","id"])&&(0,v.o6)({msg_id:I.msid,id:P.chatwidget.getIn(["chatData","id"]),hash:P.chatwidget.getIn(["chatData","hash"])})(t,n):"schange"==I.op||"cclose"==I.op?(C=n()).chatwidget.hasIn(["chatData","id"])&&t((0,v.kW)({chat_id:C.chatwidget.getIn(["chatData","id"]),hash:C.chatwidget.getIn(["chatData","hash"]),mode:C.chatwidget.get("mode"),theme:C.chatwidget.get("theme")})):"vo"==I.op&&(A=n()).chatwidget.hasIn(["chatData","id"])&&d.transmitPublish(e.instance_id>0?"chat_"+e.instance_id+"_"+A.chatwidget.getIn(["chatData","id"]):"chat_"+A.chatwidget.getIn(["chatData","id"]),{op:"vi_online",status:!0});case 45:b=!1,a.next=40;break;case 48:a.next=54;break;case 50:a.prev=50,a.t1=a.catch(38),w=!0,k=a.t1;case 54:if(a.prev=54,a.prev=55,!b||null==D.return){a.next=59;break}return a.next=59,D.return();case 59:if(a.prev=59,!w){a.next=62;break}throw k;case 62:return a.finish(59);case 63:return a.finish(54);case 64:case"end":return a.stop()}}),a,null,[[10,22,26,36],[27,,31,35],[38,50,54,64],[55,,59,63]])})))).apply(this,arguments)}r()(p().mark((function e(){var t,a,n,r,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,a=!1,e.prev=2,r=o()(d.listener("connect"));case 4:return e.next=6,r.next();case 6:if(!(t=!(s=e.sent).done)){e.next=12;break}s.value.isAuthenticated?w():_();case 9:t=!1,e.next=4;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),a=!0,n=e.t0;case 18:if(e.prev=18,e.prev=19,!t||null==r.return){e.next=23;break}return e.next=23,r.return();case 23:if(e.prev=23,!a){e.next=26;break}throw n;case 26:return e.finish(23);case 27:return e.finish(18);case 28:case"end":return e.stop()}}),e,null,[[2,14,18,28],[19,,23,27]])})))(),r()(p().mark((function e(){var t,a,n,r,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,a=!1,e.prev=2,r=o()(d.listener("disconnect"));case 4:return e.next=6,r.next();case 6:if(!(t=!(s=e.sent).done)){e.next=12;break}s.value,b();case 9:t=!1,e.next=4;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),a=!0,n=e.t0;case 18:if(e.prev=18,e.prev=19,!t||null==r.return){e.next=23;break}return e.next=23,r.return();case 23:if(e.prev=23,!a){e.next=26;break}throw n;case 26:return e.finish(23);case 27:return e.finish(18);case 28:case"end":return e.stop()}}),e,null,[[2,14,18,28],[19,,23,27]])})))(),r()(p().mark((function e(){var t,a,n,r,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,a=!1,e.prev=2,r=o()(d.listener("deauthenticate"));case 4:return e.next=6,r.next();case 6:if(!(t=!(s=e.sent).done)){e.next=12;break}s.value,_();case 9:t=!1,e.next=4;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),a=!0,n=e.t0;case 18:if(e.prev=18,e.prev=19,!t||null==r.return){e.next=23;break}return e.next=23,r.return();case 23:if(e.prev=23,!a){e.next=26;break}throw n;case 26:return e.finish(23);case 27:return e.finish(18);case 28:case"end":return e.stop()}}),e,null,[[2,14,18,28],[19,,23,27]])})))()}}]),e}())}}]);
//# sourceMappingURL=261.4f5bdc85b87b22dcf23b.js.map