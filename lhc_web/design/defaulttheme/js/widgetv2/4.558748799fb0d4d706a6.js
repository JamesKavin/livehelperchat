(window.webpackJsonpLHCReactAPP=window.webpackJsonpLHCReactAPP||[]).push([[4],{106:function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(78),_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2__),_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10),_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__),_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(11),_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__),_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(3),_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__),_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(12),_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_6__),react__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_7__),html_react_parser__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(77),html_react_parser__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(html_react_parser__WEBPACK_IMPORTED_MODULE_8__),react_redux__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(13),_actions_chatActions__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(5),react_i18next__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(18),ChatMessage=function(_PureComponent){function ChatMessage(t){var e;return _babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1___default()(this,ChatMessage),(e=_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3___default()(this,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4___default()(ChatMessage).call(this,t))).abstractClick=e.abstractClick.bind(_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5___default()(e)),e.imageLoaded=e.imageLoaded.bind(_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5___default()(e)),e.updateTriggerClicked=e.updateTriggerClicked.bind(_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5___default()(e)),e.processBotAction=e.processBotAction.bind(_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5___default()(e)),e.disableEditor=!1,e.delayData=[],e}return _babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_6___default()(ChatMessage,_PureComponent),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2___default()(ChatMessage,[{key:"addLoader",value:function(t,e){t["data-no-change"]||"button"!=t.type||(e.setAttribute("disabled","disabled"),e.innerHTML='<i class="material-icons lhc-spin">loop</i>'+e.innerHTML)}},{key:"abstractClick",value:function(t,e){var a=this,s=this.props.t;if(this.addLoader(t,e.target),-1!==t.onclick.indexOf("lhinst.updateTriggerClicked"))this.updateTriggerClicked({type:"/(type)/triggerclicked"},t,e.target);else if(-1!==t.onclick.indexOf("notificationsLHC.sendNotification"))this.props.dispatch(Object(_actions_chatActions__WEBPACK_IMPORTED_MODULE_10__.p)()),e.target.innerHTML=s("notifications.subscribing"),setTimeout((function(){a.removeMetaMessage(t["data-id"])}),500);else if(-1!==t.onclick.indexOf("lhinst.buttonClicked"))this.updateTriggerClicked({type:""},t,e.target);else if(-1!==t.onclick.indexOf("lhinst.updateChatClicked"))this.updateTriggerClicked({type:"",mainType:"updatebuttonclicked"},t,e.target);else if(-1!==t.onclick.indexOf("lhinst.editGenericStep"))this.updateTriggerClicked({type:"/(type)/editgenericstep"},t,e.target);else if(-1!==t.onclick.indexOf("lhinst.dropdownClicked")){var i=document.getElementById("id_generic_list-"+t["data-id"]);i&&"0"!=i.value&&""!=i.value?(t["data-payload"]=i.value,this.updateTriggerClicked({type:"/(type)/valueclicked"},t,e.target)):alert(s("bot.please_choose"))}else helperFunctions.emitEvent("MessageClick",[t,this.props.dispatch]),console.log("Unknown click event: "+t.onclick);e.preventDefault(),this.props.focusMessage()}},{key:"removeMetaMessage",value:function(t){setTimeout((function(){var e=document.getElementById("msg-"+t);if(e){var a,s=e.getElementsByClassName("meta-message-"+t);for(a=0;a<s.length;a++)s[a].parentNode.removeChild(s[a])}}),500)}},{key:"updateTriggerClicked",value:function(t,e,a){var s=this;this.props.dispatch(Object(_actions_chatActions__WEBPACK_IMPORTED_MODULE_10__.r)(t,{payload:e["data-payload"],id:e["data-id"],processed:void 0===e["data-keep"]})).then((function(){e["data-keep"]||s.removeMetaMessage(e["data-id"]),s.props.updateMessages(),s.props.updateStatus()}))}},{key:"imageLoaded",value:function(t){this.props.scrollBottom&&this.props.scrollBottom()}},{key:"componentDidMount",value:function(){var t=this;this.props.setMetaUpdateState(-1!==this.props.msg.msg.indexOf("meta-auto-hide")),1==this.disableEditor?this.props.setEditorEnabled(!1):this.props.setEditorEnabled(!0),this.delayData.length>0&&this.delayData.forEach((function(e){t.props.sendDelay(e)}))}},{key:"processBotAction",value:function processBotAction(domNode){var attr=domNode.attribs;"lhinst.disableVisitorEditor"==attr["data-bot-action"]?this.disableEditor=!0:"lhinst.setDelay"==attr["data-bot-action"]?this.delayData.push(JSON.parse(attr["data-bot-args"])):"execute-js"==attr["data-bot-action"]&&eval(domNode.children[0].data)}},{key:"render",value:function(){var t=this,e=!1;return html_react_parser__WEBPACK_IMPORTED_MODULE_8___default()(this.props.msg.msg,{replace:function(a){if(a.attribs){var s=Object.assign({},a.attribs);if(a.attribs.class&&(a.attribs.className=a.attribs.class,-1!==a.attribs.className.indexOf("message-row")&&t.props.id>0&&(a.attribs.className+=" fade-in-fast",t.props.msg.msop>0&&t.props.msg.msop!=t.props.msg.lmsop&&0==e&&(a.attribs.className+=" operator-changes",e=!0)),delete a.attribs.class),a.attribs.onclick&&delete a.attribs.onclick,a.name&&"img"===a.name)return react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("img",_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},a.attribs,{onLoad:t.imageLoaded,onClick:function(e){return t.abstractClick(s,e)}}));if(a.name&&"button"===a.name){if(s.onclick)return react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("button",_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},a.attribs,{onClick:function(e){return t.abstractClick(s,e)}}),Object(html_react_parser__WEBPACK_IMPORTED_MODULE_8__.domToReact)(a.children))}else if(a.name&&"a"===a.name){if(s.onclick)return react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("a",_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},a.attribs,{onClick:function(e){return t.abstractClick(s,e)}}),Object(html_react_parser__WEBPACK_IMPORTED_MODULE_8__.domToReact)(a.children))}else a.name&&"script"===a.name&&a.attribs["data-bot-action"]&&t.processBotAction(a)}}})}}]),ChatMessage}(react__WEBPACK_IMPORTED_MODULE_7__.PureComponent);__webpack_exports__.a=Object(react_i18next__WEBPACK_IMPORTED_MODULE_11__.b)()(Object(react_redux__WEBPACK_IMPORTED_MODULE_9__.b)()(ChatMessage))},107:function(t,e,a){var s=function(t){"use strict";var e=Object.prototype,a=e.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",r=s.asyncIterator||"@@asyncIterator",n=s.toStringTag||"@@toStringTag";function o(t,e,a,s){var i=e&&e.prototype instanceof h?e:h,r=Object.create(i.prototype),n=new E(s||[]);return r._invoke=function(t,e,a){var s="suspendedStart";return function(i,r){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===i)throw r;return C()}for(a.method=i,a.arg=r;;){var n=a.delegate;if(n){var o=b(n,a);if(o){if(o===l)continue;return o}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";var h=c(t,e,a);if("normal"===h.type){if(s=a.done?"completed":"suspendedYield",h.arg===l)continue;return{value:h.arg,done:a.done}}"throw"===h.type&&(s="completed",a.method="throw",a.arg=h.arg)}}}(t,a,n),r}function c(t,e,a){try{return{type:"normal",arg:t.call(e,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=o;var l={};function h(){}function d(){}function u(){}var p={};p[i]=function(){return this};var _=Object.getPrototypeOf,g=_&&_(_(D([])));g&&g!==e&&a.call(g,i)&&(p=g);var m=u.prototype=h.prototype=Object.create(p);function f(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function v(t,e){var s;this._invoke=function(i,r){function n(){return new e((function(s,n){!function s(i,r,n,o){var l=c(t[i],t,r);if("throw"!==l.type){var h=l.arg,d=h.value;return d&&"object"==typeof d&&a.call(d,"__await")?e.resolve(d.__await).then((function(t){s("next",t,n,o)}),(function(t){s("throw",t,n,o)})):e.resolve(d).then((function(t){h.value=t,n(h)}),(function(t){return s("throw",t,n,o)}))}o(l.arg)}(i,r,s,n)}))}return s=s?s.then(n,n):n()}}function b(t,e){var a=t.iterator[e.method];if(void 0===a){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var s=c(a,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,l;var i=s.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function D(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,r=function e(){for(;++s<t.length;)if(a.call(t,s))return e.value=t[s],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:C}}function C(){return{value:void 0,done:!0}}return d.prototype=m.constructor=u,u.constructor=d,u[n]=d.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,n in t||(t[n]="GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},f(v.prototype),v.prototype[r]=function(){return this},t.AsyncIterator=v,t.async=function(e,a,s,i,r){void 0===r&&(r=Promise);var n=new v(o(e,a,s,i),r);return t.isGeneratorFunction(a)?n:n.next().then((function(t){return t.done?t.value:n.next()}))},f(m),m[n]="Generator",m[i]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var a in t)e.push(a);return e.reverse(),function a(){for(;e.length;){var s=e.pop();if(s in t)return a.value=s,a.done=!1,a}return a.done=!0,a}},t.values=D,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function s(a,s){return n.type="throw",n.arg=t,e.next=a,s&&(e.method="next",e.arg=void 0),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],n=r.completion;if("root"===r.tryLoc)return s("end");if(r.tryLoc<=this.prev){var o=a.call(r,"catchLoc"),c=a.call(r,"finallyLoc");if(o&&c){if(this.prev<r.catchLoc)return s(r.catchLoc,!0);if(this.prev<r.finallyLoc)return s(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return s(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return s(r.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var n=r?r.completion:{};return n.type=t,n.arg=e,r?(this.method="next",this.next=r.finallyLoc,l):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),w(a),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc===t){var s=a.completion;if("throw"===s.type){var i=s.arg;w(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,a){return this.delegate={iterator:D(t),resultName:e,nextLoc:a},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=s}catch(t){Function("r","regeneratorRuntime = r")(s)}},131:function(t,e,a){"use strict";a.r(e);var s=a(6),i=a.n(s),r=a(7),n=a.n(r),o=a(10),c=a.n(o),l=a(11),h=a.n(l),d=a(3),u=a.n(d),p=a(12),_=a.n(p),g=a(4),m=a.n(g),f=a(0),v=a.n(f),b=a(13),y=a(77),w=a.n(y),E=a(5),D=a(8),C=a(106),k=a(80),M=a(87),I=a.n(M),O=a(88),L=a.n(O),P=a(18);function T(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function S(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?T(Object(a),!0).forEach((function(e){m()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var x,B,A=function(t){function e(t){var a;return i()(this,e),a=c()(this,h()(e).call(this,t)),m()(u()(a),"state",{hightlight:!1,files:[],uploading:!1,uploadProgress:{},successfullUploaded:!1}),a.fileInputRef=v.a.createRef(),a.openFileDialog=a.openFileDialog.bind(u()(a)),a.onFilesAddedUI=a.onFilesAddedUI.bind(u()(a)),a.onDragOver=a.onDragOver.bind(u()(a)),a.onDragLeave=a.onDragLeave.bind(u()(a)),a.onDrop=a.onDrop.bind(u()(a)),a.onPaste=a.onPaste.bind(u()(a)),a.onFilesAdded=a.onFilesAdded.bind(u()(a)),a.uploadFiles=a.uploadFiles.bind(u()(a)),a.sendRequest=a.sendRequest.bind(u()(a)),a}var a;return _()(e,t),n()(e,[{key:"onFilesAdded",value:function(t){var e=this,a=this.props.t,s=new RegExp("(.|/)("+this.props.fileOptions.get("ft_us")+")$","i"),i=[];t.forEach((function(t){s.test(t.type)||s.test(t.name)||i.push(t.name+": "+a("file.incorrect_type")),t.size>e.props.fileOptions.get("fs")&&i.push(t.name+": "+a("file.to_big_file"))})),i.length>0?alert(i.join("\n")):this.setState({files:t})}},{key:"componentDidUpdate",value:function(t,e){this.state.files.length>0&&0==this.state.uploading&&this.uploadFiles()}},{key:"uploadFiles",value:(a=L()(I.a.mark((function t(){var e,a=this;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({uploadProgress:{},uploading:!0}),e=[],this.state.files.forEach((function(t){e.push(a.sendRequest(t))})),t.prev=3,t.next=6,Promise.all(e);case 6:this.setState({successfullUploaded:!0,uploading:!1,files:[]}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),this.setState({successfullUploaded:!0,uploading:!1,files:[]});case 12:case"end":return t.stop()}}),t,this,[[3,9]])}))),function(){return a.apply(this,arguments)})},{key:"sendRequest",value:function(t){var e=this,a=this.props.t;return new Promise((function(s,i){var r=new XMLHttpRequest;r.upload.addEventListener("progress",(function(s){s.lengthComputable&&(S({},e.state.uploadProgress)[t.name]={state:"pending",percentage:s.loaded/s.total*100},e.props.progress(a("file.uploading")+Math.round(s.loaded/s.total*100)+"%"))})),r.upload.addEventListener("load",(function(a){S({},e.state.uploadProgress)[t.name]={state:"done",percentage:100},e.props.progress("100%"),e.props.onCompletion(),s(r.response)})),r.upload.addEventListener("error",(function(a){var s=S({},e.state.uploadProgress);s[t.name]={state:"error",percentage:0},e.setState({uploadProgress:s}),i(r.response)}));var n=new FormData;n.append("files",t,t.name),r.open("POST",e.props.base_url+"/file/uploadfile/"+e.props.chat_id+"/"+e.props.hash),r.send(n)}))}},{key:"openFileDialog",value:function(){this.state.uploading||this.fileInputRef.current.click()}},{key:"onFilesAddedUI",value:function(t){var e=t.target.files,a=this.fileListToArray(e);this.onFilesAdded(a)}},{key:"onDragOver",value:function(t){t.preventDefault(),this.state.uploading||this.props.onDrag&&this.props.onDrag(!0)}},{key:"componentDidMount",value:function(){var t=this;setTimeout((function(){t.props.dropArea.current&&(t.props.dropArea.current.ondragover=t.onDragOver,t.props.dropArea.current.ondragleave=t.onDragLeave,t.props.dropArea.current.ondrop=t.onDrop,document.addEventListener("paste",t.onPaste))}),1e3)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("paste",this.onPaste)}},{key:"onPaste",value:function(t){var e=t&&t.clipboardData&&t.clipboardData.items;if(e&&e.length){for(var a=[],s=0;s<e.length;s++){var i=e[s].getAsFile&&e[s].getAsFile();i&&a.push(i)}a.length>0&&this.onFilesAdded(a)}}},{key:"onDragLeave",value:function(t){this.props.onDrag&&this.props.onDrag(!1)}},{key:"onDrop",value:function(t){if(t.preventDefault(),!this.state.uploading){var e=t.dataTransfer.files,a=this.fileListToArray(e);this.onFilesAdded(a),this.props.onDrag&&this.props.onDrag(!1)}}},{key:"fileListToArray",value:function(t){for(var e=[],a=0;a<t.length;a++)e.push(t.item(a));return e}},{key:"render",value:function(){if(this.props.link)return v.a.createElement(v.a.Fragment,null,v.a.createElement("input",{onChange:this.onFilesAddedUI,ref:this.fileInputRef,id:"fileupload",type:"file",name:"files[]",multiple:!0,className:"d-none"}),v.a.createElement("a",{className:"file-uploader",onClick:this.openFileDialog},v.a.createElement("i",{className:"material-icons chat-setting-item text-muted"},"attach_file")))}}]),e}(f.PureComponent),R=Object(P.b)()(A),U=function(t){function e(t){var a;return i()(this,e),a=c()(this,h()(e).call(this,t)),m()(u()(a),"state",{intervalId:null,intervalCheckStatusId:null}),a.syncChat=a.syncChat.bind(u()(a)),a.checkStatusChat=a.checkStatusChat.bind(u()(a)),a}return _()(e,t),n()(e,[{key:"syncChat",value:function(t){this.state.intervalId&&clearTimeout(this.state.intervalId),this.props.updateMessages(),this.setState({intervalId:setTimeout(this.syncChat,this.props.syncInterval)})}},{key:"checkStatusChat",value:function(){this.state.intervalCheckStatusId&&clearTimeout(this.state.intervalCheckStatusId),this.props.updateStatus(),this.setState({intervalCheckStatusId:setTimeout(this.checkStatusChat,this.props.syncInterval)})}},{key:"componentDidMount",value:function(){this.syncChat(),this.checkStatusChat()}},{key:"componentDidUpdate",value:function(t,e){this.props.status!=D.c&&this.props.status_sub!=D.e&&this.props.status_sub!=D.f&&this.props.status_sub!=D.d||!this.state.intervalId?this.state.intervalId||this.syncChat():clearTimeout(this.state.intervalId),this.props.status_sub==t.status_sub&&this.props.status==t.status&&this.props.initClose==t.initClose||this.checkStatusChat(),this.props.status!=D.c&&this.props.status!=D.b&&this.props.status!=D.a&&this.props.status_sub!=D.e||!this.state.intervalCheckStatusId||clearTimeout(this.state.intervalCheckStatusId)}},{key:"componentWillUnmount",value:function(){this.state.intervalId&&clearTimeout(this.state.intervalId),this.state.intervalCheckStatusId&&clearTimeout(this.state.intervalCheckStatusId)}},{key:"render",value:function(){return null}}]),e}(f.PureComponent),N=function(t){function e(t){var a;return i()(this,e),a=c()(this,h()(e).call(this,t)),m()(u()(a),"state",{dropdown:null}),a}return _()(e,t),n()(e,[{key:"componentDidMount",value:function(){if(document.getElementById(this.props.elementId)){var t=a(39);this.setState({dropdown:new t.Dropdown(document.getElementById(this.props.elementId))})}}},{key:"componentWillUnmount",value:function(){this.state.dropdown&&delete this.state.dropdown}},{key:"render",value:function(){return this.props.children}}]),e}(f.PureComponent),K=a(78),W=a.n(K),j=a(1),F=a(2),q=a.n(F),H=Object(b.b)((function(t){return{chat:t.chatwidget.get("chatData"),chat_ui:t.chatwidget.get("chat_ui")}}))(x=function(t){function e(t){var a;return i()(this,e),(a=c()(this,h()(e).call(this,t))).abstractClick=a.abstractClick.bind(u()(a)),a.checkSwitchButtom=a.checkSwitchButtom.bind(u()(a)),a}return _()(e,t),n()(e,[{key:"abstractClick",value:function(t){var e=this;t.onclick&&("lhinst.voteAction($(this))"==t.onclick?Object(E.t)({id:this.props.chat.get("id"),hash:this.props.chat.get("hash"),type:t["data-id"]}).then((function(t){e.props.updateStatus()})):"notificationsLHC.sendNotification()"==t.onclick?j.a.sendMessageParent("subscribeEvent",[{pk:this.props.chat_ui.get("notifications_pk")}]):-1!==t.onclick.indexOf("lhinst.transferToHuman")?Object(E.q)({id:this.props.chat.get("id"),hash:this.props.chat.get("hash")}).then((function(t){e.props.updateStatus()})):j.a.emitEvent("StatusClick",[t,this.props.dispatch]))}},{key:"checkSwitchButtom",value:function(){this.props.chat_ui.has("switch_to_human")&&this.props.vtm&&this.props.vtm>=this.props.chat_ui.get("switch_to_human")&&q.a.get(window.lhcChat.base_url+"restapi/isonlinechat/"+this.props.chat.get("id")+"?exclude_bot=true").then((function(t){if(t.data.isonline){var e=document.getElementById("transfer-to-human-btn");null!==e&&e.classList.remove("hide")}}))}},{key:"componentDidMount",value:function(){this.checkSwitchButtom()}},{key:"componentDidUpdate",value:function(t,e,a){this.checkSwitchButtom()}},{key:"render",value:function(){var t=this;return w()(this.props.status,{replace:function(e){if(e.attribs&&e.attribs.onclick&&e.name&&("i"==e.name||"a"==e.name)){var a=Object.assign({},e.attribs);return e.attribs.class&&(e.attribs.className=e.attribs.class,delete e.attribs.class),e.attribs.onclick&&delete e.attribs.onclick,v.a.createElement("i",W()({},e.attribs,{onClick:function(e){return t.abstractClick(a)}}),Object(y.domToReact)(e.children))}}})}}]),e}(f.PureComponent))||x,z=v.a.lazy((function(){return a.e(7).then(a.bind(null,132))})),G=Object(b.b)((function(t){return{chatwidget:t.chatwidget}}))(B=function(t){function e(t){var a;return i()(this,e),a=c()(this,h()(e).call(this,t)),m()(u()(a),"state",{value:"",showBBCode:null,dragging:!1,enabledEditor:!0,showMessages:!1,preloadSurvey:!1,gotToSurvey:!1,voiceMode:!1}),m()(u()(a),"insertText",(function(t){var e=a.textMessageRef.current.selectionStart;a.setState({value:a.state.value.substring(0,e)+t+a.state.value.substring(e)})})),a.props.dispatch(Object(E.g)({id:a.props.chatwidget.getIn(["chatData","id"]),hash:a.props.chatwidget.getIn(["chatData","hash"]),theme:a.props.chatwidget.get("theme")})),a.updateMessages(),a.updateStatus(),a.enterKeyDown=a.enterKeyDown.bind(u()(a)),a.handleChange=a.handleChange.bind(u()(a)),a.sendMessage=a.sendMessage.bind(u()(a)),a.endChat=a.endChat.bind(u()(a)),a.toggleModal=a.toggleModal.bind(u()(a)),a.setStatusText=a.setStatusText.bind(u()(a)),a.dragging=a.dragging.bind(u()(a)),a.scrollBottom=a.scrollBottom.bind(u()(a)),a.focusMessage=a.focusMessage.bind(u()(a)),a.setEditorEnabled=a.setEditorEnabled.bind(u()(a)),a.sendDelay=a.sendDelay.bind(u()(a)),a.unhideDelayed=a.unhideDelayed.bind(u()(a)),a.toggleSound=a.toggleSound.bind(u()(a)),a.goToSurvey=a.goToSurvey.bind(u()(a)),a.startVoiceRecording=a.startVoiceRecording.bind(u()(a)),a.cancelVoiceRecording=a.cancelVoiceRecording.bind(u()(a)),a.messagesAreaRef=v.a.createRef(),a.textMessageRef=v.a.createRef(),a.updateMessages=a.updateMessages.bind(u()(a)),a.updateStatus=a.updateStatus.bind(u()(a)),a.updateMetaAutoHide=a.updateMetaAutoHide.bind(u()(a)),a.setMetaUpdateState=a.setMetaUpdateState.bind(u()(a)),a.keyUp=a.keyUp.bind(u()(a)),a.delayed=!1,a.delayQueue=[],a.intervalPending=null,a.pendingMetaUpdate=!1,a.isTyping=!1,a.typingStopped=null,a.typingStoppedAction=a.typingStoppedAction.bind(u()(a)),a.currentMessageTyping="",a}return _()(e,t),n()(e,[{key:"dragging",value:function(t){this.setState({dragging:t})}},{key:"goToSurvey",value:function(){this.props.dispatch({type:"UI_STATE",data:{attr:"show_survey",val:1}}),this.setState({gotToSurvey:!0})}},{key:"setStatusText",value:function(t){this.props.dispatch({type:"chat_status_changed",data:{text:t}})}},{key:"startVoiceRecording",value:function(){this.setState({voiceMode:!0})}},{key:"cancelVoiceRecording",value:function(){this.setState({voiceMode:!1})}},{key:"handleChange",value:function(t){if(this.setState({value:t.target.value}),sessionStorage)try{sessionStorage.setItem("lhc_ttxt",t.target.value)}catch(t){}}},{key:"componentDidMount",value:function(){sessionStorage&&null!==sessionStorage.getItem("lhc_ttxt")&&this.setState({value:sessionStorage.getItem("lhc_ttxt")})}},{key:"focusMessage",value:function(){this.textMessageRef.current&&(this.textMessageRef.current.focus(),this.state.value.length>0&&(this.textMessageRef.current.selectionStart=this.state.value.length,this.textMessageRef.current.selectionEnd=this.state.value.length))}},{key:"setEditorEnabled",value:function(t){this.setState({enabledEditor:t})}},{key:"hasClass",value:function(t,e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(t.className)}},{key:"addClass",value:function(t,e){this.hasClass(t,e)||(t.className+=(t.className?" ":"")+e)}},{key:"removeClass",value:function(t,e){this.hasClass(t,e)&&(t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").replace(/^\s+|\s+$/g,""))}},{key:"setMetaUpdateState",value:function(t){!1===t&&!0===this.pendingMetaUpdate&&(this.pendingMetaUpdate=!1,this.updateMetaAutoHide(),this.scrollBottom()),!0===t&&(this.pendingMetaUpdate=!0,this.updateMetaAutoHide(),this.scrollBottom())}},{key:"updateMetaAutoHide",value:function(){var t=document.getElementById("messages-scroll"),e=t.getElementsByClassName("meta-auto-hide");if(e.length>0){for(a=0;a<e.length-1;a++)e[a].style.display="none";var a,s=t.lastChild;if(s)for(e=s.getElementsByClassName("meta-auto-hide"),a=0;a<e.length;a++)e[a].style.display=""}}},{key:"nextUntil",value:function(t,e){for(var a=[],s=!0;t=t.nextElementSibling;)s&&t&&!t.matches(e)?a.push(t):s=!1;return a}},{key:"sendDelay",value:function(t){var e=this,a=t.id,s=t.duration,i=t.delay,r=t.untill_message,n=document.getElementById("msg-"+a);n&&(i>0&&this.addClass(n,"hide"),1==r&&this.nextUntil(n,".message-admin").length>0||setTimeout((function(){if(0==e.delayed)if(1==r)clearInterval(e.intervalPending),e.intervalPending=setInterval((function(){if(e.nextUntil(n,".message-admin").length>0)e.unhideDelayed(a),clearInterval(e.intervalPending);else if(!e.hasClass(n,"meta-hider")){e.addClass(n,"meta-hider"),e.addClass(n,"message-row-typing"),e.removeClass(n,"hide"),e.removeClass(n,"fade-in-fast");var t=n.getElementsByClassName("msg-body"),s=!0,i=!1,r=void 0;try{for(var o,c=t[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var l=o.value;e.removeClass(l,"hide")}}catch(t){i=!0,r=t}finally{try{s||null==c.return||c.return()}finally{if(i)throw r}}e.scrollBottom()}}),500);else{e.delayed=!0,e.addClass(n,"meta-hider"),e.addClass(n,"message-row-typing"),e.nextUntil(n,".meta-hider").forEach((function(t){e.addClass(t,"hide")})),setTimeout((function(){e.unhideDelayed(a)}),1e3*s),e.removeClass(n,"hide"),e.removeClass(n,"fade-in-fast");var t=n.getElementsByClassName("msg-body"),o=!0,c=!1,l=void 0;try{for(var h,d=t[Symbol.iterator]();!(o=(h=d.next()).done);o=!0){var u=h.value;e.removeClass(u,"hide")}}catch(t){c=!0,l=t}finally{try{o||null==d.return||d.return()}finally{if(c)throw l}}i>0&&(e.updateMetaAutoHide(),e.scrollBottom())}else e.addClass(n,"message-row-typing"),e.addClass(n,"meta-hider"),e.delayQueue.push({id:a,delay:s})}),1e3*i))}},{key:"unhideDelayed",value:function(t){var e=this,a=document.getElementById("msg-"+t);if(a)if(this.nextUntil(a,".meta-hider").forEach((function(t){e.removeClass(t,"hide")})),a.parentNode.removeChild(a),this.updateMetaAutoHide(),this.scrollBottom(),this.delayQueue.length>0){var s=this.delayQueue.pop();setTimeout((function(){e.unhideDelayed(s.id)}),1e3*s.delay);var i=document.getElementById("msg-"+s.id);this.removeClass(i,"hide"),this.removeClass(i,"fade-in-fast");var r=i.getElementsByClassName("msg-body"),n=!0,o=!1,c=void 0;try{for(var l,h=r[Symbol.iterator]();!(n=(l=h.next()).done);n=!0){var d=l.value;this.removeClass(d,"hide")}}catch(t){o=!0,c=t}finally{try{n||null==h.return||h.return()}finally{if(o)throw c}}}else this.delayed=!1}},{key:"componentWillUnmount",value:function(){clearInterval(this.intervalPending),clearInterval(this.typingStopped)}},{key:"getSnapshotBeforeUpdate",value:function(t,e){if(t.chatwidget.getIn(["chatLiveData","messages"]).size!=this.props.chatwidget.getIn(["chatLiveData","messages"]).size){if(0!=t.chatwidget.getIn(["chatLiveData","messages"]).size&&!1===this.props.chatwidget.getIn(["chatLiveData","uw"])&&j.a.emitEvent("play_sound",[{type:"new_message",sound_on:!0===this.props.chatwidget.getIn(["usersettings","soundOn"]),widget_open:this.props.chatwidget.get("shown")&&"widget"==this.props.chatwidget.get("mode")||document.hasFocus()}]),this.messagesAreaRef.current){var a=this.messagesAreaRef.current.scrollHeight-this.messagesAreaRef.current.scrollTop;return a-this.messagesAreaRef.current.offsetHeight<70&&(a=0),a}}else if(!1===t.chatwidget.get("shown")&&!0===this.props.chatwidget.get("shown"))return 0;return null}},{key:"componentDidUpdate",value:function(t,e,a){!1!==this.state.showMessages&&t.chatwidget.getIn(["chatLiveData","status"])==this.props.chatwidget.getIn(["chatLiveData","status"])||this.scrollBottom(),(!1===e.enabledEditor&&e.enabledEditor!=this.state.enabledEditor||this.props.chatwidget.get("msgLoaded")!==t.chatwidget.get("msgLoaded"))&&(this.scrollBottom(),(!0!==this.props.chatwidget.getIn(["chat_ui","auto_start"])||"embed"!=this.props.chatwidget.get("mode")||!1===e.enabledEditor&&e.enabledEditor!=this.state.enabledEditor)&&this.focusMessage()),null!==a&&this.messagesAreaRef.current&&(this.messagesAreaRef.current.scrollTop=this.messagesAreaRef.current.scrollHeight-a),1==this.props.chatwidget.getIn(["chat_ui_state","confirm_close"])&&!1===this.state.preloadSurvey&&this.setState({preloadSurvey:!0}),!1===t.chatwidget.get("shown")&&!0===this.props.chatwidget.get("shown")&&"widget"==this.props.chatwidget.get("mode")&&this.textMessageRef.current&&this.textMessageRef.current.focus()}},{key:"scrollBottom",value:function(){var t=this;this.messagesAreaRef.current&&(this.messagesAreaRef.current.scrollTop=this.messagesAreaRef.current.scrollHeight+1e3,setTimeout((function(){t.messagesAreaRef.current&&(t.messagesAreaRef.current.scrollTop=t.messagesAreaRef.current.scrollHeight+1e3),!1===t.state.showMessages&&t.setState({showMessages:!0})}),450))}},{key:"updateMessages",value:function(){this.props.dispatch(Object(E.d)({chat_id:this.props.chatwidget.getIn(["chatData","id"]),hash:this.props.chatwidget.getIn(["chatData","hash"]),lmgsid:this.props.chatwidget.getIn(["chatLiveData","lmsgid"]),theme:this.props.chatwidget.get("theme"),new_chat:this.props.chatwidget.get("newChat")}))}},{key:"updateStatus",value:function(){this.props.dispatch(Object(E.b)({chat_id:this.props.chatwidget.getIn(["chatData","id"]),hash:this.props.chatwidget.getIn(["chatData","hash"]),theme:this.props.chatwidget.get("theme"),mode:this.props.chatwidget.get("mode")}))}},{key:"sendMessage",value:function(){sessionStorage&&null!==sessionStorage.getItem("lhc_ttxt")&&sessionStorage.setItem("lhc_ttxt",""),this.props.dispatch(Object(E.a)({id:this.props.chatwidget.getIn(["chatData","id"]),hash:this.props.chatwidget.getIn(["chatData","hash"]),msg:this.state.value,theme:this.props.chatwidget.get("theme"),lmgsid:this.props.chatwidget.getIn(["chatLiveData","lmsgid"])})),this.setState({value:""}),this.currentMessageTyping="",this.focusMessage()}},{key:"enterKeyDown",value:function(t){"Enter"!==t.key||t.shiftKey||(this.sendMessage(),t.preventDefault())}},{key:"keyUp",value:function(t){"Enter"===t.key||t.shiftKey||(!1===this.isTyping?(this.isTyping=!0,this.props.dispatch(Object(E.s)("true",this.state.value))):(clearTimeout(this.typingStopped),this.typingStopped=setTimeout(this.typingStoppedAction,3e3),this.currentMessageTyping!=this.state.value&&(Math.abs(this.currentMessageTyping.length-this.state.value.length)>6||this.props.chatwidget.get("overrides").contains("typing"))&&(this.currentMessageTyping=this.state.value,this.props.dispatch(Object(E.s)("true",this.state.value)))))}},{key:"typingStoppedAction",value:function(){1==this.isTyping&&(this.isTyping=!1,this.props.dispatch(Object(E.s)("false")))}},{key:"endChat",value:function(){this.props.endChat()}},{key:"toggleModal",value:function(){this.setState({showBBCode:!this.state.showBBCode}),this.state.showBBCode&&this.focusMessage()}},{key:"toggleSound",value:function(){this.props.dispatch({type:"toggleSound",data:!this.props.chatwidget.getIn(["usersettings","soundOn"])}),j.a.sendMessageParent("toggleSound",[{sender:"toolbarButton"}])}},{key:"render",value:function(){var t=this;if(!1===this.props.chatwidget.get("initLoaded")||!1===this.props.chatwidget.get("msgLoaded"))return v.a.createElement(v.a.Fragment,null,null!==this.props.profileBefore&&v.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.profileBefore}}),null!==this.props.messagesBefore&&v.a.createElement("div",{className:"flex-grow-1 overflow-scroll position-relative",id:"messagesBlock",dangerouslySetInnerHTML:{__html:this.props.messagesBefore}}),v.a.createElement("div",{className:"d-flex flex-row border-top position-relative message-send-area"},v.a.createElement("div",{className:"mx-auto pb-1 w-100"},v.a.createElement("textarea",{"aria-label":"Type your message here...",rows:"1",className:"pl-0 no-outline form-control rounded-0 form-control border-left-0 border-right-0 border-0"}))));var e=this.props.t;if(this.props.chatwidget.hasIn(["chatLiveData","ru"])&&this.props.chatwidget.getIn(["chatLiveData","ru"]))return h=this.props.chatwidget.get("base_url")+this.props.chatwidget.getIn(["chatLiveData","ru"]),v.a.createElement(v.a.Fragment,null,v.a.createElement("iframe",{allowtransparency:"true",src:h,frameBorder:"0",className:"flex-grow-1 position-relative iframe-modal"}));if(this.props.chatwidget.get("chatLiveData").has("messages"))var a=this.props.chatwidget.getIn(["chatLiveData","messages"]).map((function(e,a){return v.a.createElement(C.a,{setMetaUpdateState:t.setMetaUpdateState,sendDelay:t.sendDelay,setEditorEnabled:t.setEditorEnabled,updateStatus:t.updateStatus,focusMessage:t.focusMessage,updateMessages:t.updateMessages,scrollBottom:t.scrollBottom,id:a,key:"msg_"+a,msg:e})}));else a="";var s="";s=!0===this.state.dragging?e("chat.drop_files"):this.props.chatwidget.getIn(["chatLiveData","closed"])?e("chat.chat_closed"):this.props.chatwidget.hasIn(["chat_ui","placeholder_message"])?this.props.chatwidget.getIn(["chat_ui","placeholder_message"]):e("chat.type_here");var i="flex-grow-1 overflow-scroll position-relative",r="bottom-message px-1";this.props.chatwidget.hasIn(["chat_ui","msg_expand"])&&(i="overflow-scroll position-relative",r+=" position-relative");var n="mx-auto pb-1 w-100";1==this.props.chatwidget.getIn(["chatLiveData","closed"])&&(n+=" pt-1"+("embed"==this.props.chatwidget.get("mode")?" pr-2":" pr-1"));var o=!0,c=!1,l=!1,h="",d="flex-grow-1 position-relative iframe-modal content-loader",u=this.props.chatwidget.hasIn(["chatLiveData","status_sub"])&&(this.props.chatwidget.getIn(["chatLiveData","status_sub"])==D.e||this.props.chatwidget.getIn(["chatLiveData","status_sub"])==D.f&&(this.props.chatwidget.getIn(["chatLiveData","uid"])>0||this.props.chatwidget.getIn(["chatLiveData","status"])===D.b||this.props.chatwidget.getIn(["chatLiveData","status"])==D.c))||this.props.chatwidget.getIn(["chatLiveData","status"])==D.c&&this.props.chatwidget.getIn(["chatLiveData","uid"])>0||!0===this.state.gotToSurvey;return(this.props.chatwidget.hasIn(["chatLiveData","status_sub"])&&this.props.chatwidget.getIn(["chatLiveData","status_sub"])==D.e||this.props.chatwidget.getIn(["chatLiveData","status"])==D.c&&this.props.chatwidget.getIn(["chatLiveData","status_sub"])!=D.f)&&(l=!0),(!0===this.state.preloadSurvey||u)&&this.props.chatwidget.hasIn(["chat_ui","survey_id"])&&(h=this.props.chatwidget.get("base_url")+"survey/fillwidget/(chatid)/"+this.props.chatwidget.getIn(["chatData","id"])+"/(hash)/"+this.props.chatwidget.getIn(["chatData","hash"]),this.props.chatwidget.get("theme")&&(h=h+"/(theme)/"+this.props.chatwidget.get("theme")),h=h+"/(survey)/"+this.props.chatwidget.getIn(["chat_ui","survey_id"])+(!0===l?"/(force)/true":""),this.props.chatwidget.hasIn(["chat_ui","survey_url"])&&(h=this.props.chatwidget.getIn(["chat_ui","survey_url"])+(!0===l?"?force=true":"")),c=!0,o=!1,(!1===u||this.props.chatwidget.hasIn(["chat_ui","survey_button"])&&0===this.props.chatwidget.getIn(["chat_ui_state","show_survey"])&&this.props.chatwidget.getIn(["chatLiveData","status"])==D.c&&this.props.chatwidget.getIn(["chatLiveData","status_sub"])!=D.e&&this.props.chatwidget.getIn(["chatLiveData","status_sub"])!=D.f||1==this.props.chatwidget.getIn(["chat_ui_state","confirm_close"]))&&(o=!0,d=" d-none")),v.a.createElement(v.a.Fragment,null,c&&v.a.createElement("iframe",{allowtransparency:"true",src:h,frameBorder:"0",className:d}),o&&v.a.createElement(v.a.Fragment,null,v.a.createElement(U,{syncInterval:this.props.chatwidget.getIn(["chat_ui","sync_interval"]),updateStatus:this.updateStatus,updateMessages:this.updateMessages,initClose:this.props.chatwidget.get("initClose"),dispatch:this.props.dispatch,status_sub:this.props.chatwidget.getIn(["chatLiveData","status_sub"]),status:this.props.chatwidget.getIn(["chatLiveData","status"]),theme:this.props.chatwidget.get("theme"),lmgsid:this.props.chatwidget.getIn(["chatLiveData","lmsgid"]),hash:this.props.chatwidget.getIn(["chatData","hash"]),chat_id:this.props.chatwidget.getIn(["chatData","id"])}),1==this.props.chatwidget.getIn(["chat_ui_state","confirm_close"])&&v.a.createElement(k.a,{confirmClose:this.props.endChat,cancelClose:this.props.cancelClose,toggle:this.props.cancelClose,dataUrl:"/chat/confirmleave/"+this.props.chatwidget.getIn(["chatData","id"])+"/"+this.props.chatwidget.getIn(["chatData","hash"])}),this.state.showBBCode&&v.a.createElement(k.a,{showModal:this.state.showBBCode,insertText:this.insertText,toggle:this.toggleModal,dataUrl:"/chat/bbcodeinsert?react=1"}),this.props.chatwidget.hasIn(["chatStatusData","result"])&&!this.props.chatwidget.hasIn(["chat_ui","hide_status"])&&this.props.chatwidget.getIn(["chatStatusData","result"])&&v.a.createElement("div",{className:"p-2 border-bottom"},v.a.createElement(H,{updateStatus:this.updateStatus,vtm:this.props.chatwidget.hasIn(["chat_ui","switch_to_human"])&&this.props.chatwidget.getIn(["chatLiveData","status"])==D.b?this.props.chatwidget.getIn(["chatLiveData","vtm"]):0,status:this.props.chatwidget.getIn(["chatStatusData","result"])})),v.a.createElement("div",{className:i,id:"messagesBlock"},v.a.createElement("div",{className:r,id:"messages-scroll",ref:this.messagesAreaRef},a)),v.a.createElement("div",{className:(!1===this.props.chatwidget.get("msgLoaded")||!1===this.state.enabledEditor?"d-none ":"d-flex ")+"flex-row border-top position-relative message-send-area"},(this.props.chatwidget.getIn(["chatLiveData","ott"])||this.props.chatwidget.getIn(["chatLiveData","error"]))&&v.a.createElement("div",{id:"id-operator-typing",className:"bg-white pl-1"},this.props.chatwidget.getIn(["chatLiveData","error"])||this.props.chatwidget.getIn(["chatLiveData","ott"])),v.a.createElement(N,{elementId:"chat-dropdown-options"},v.a.createElement("div",{className:"btn-group dropup disable-select pl-2 pt-2"},v.a.createElement("i",{className:"material-icons settings text-muted",id:"chat-dropdown-options","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"settings"),v.a.createElement("div",{className:"dropdown-menu shadow bg-white rounded lhc-dropdown-menu ml-1"},v.a.createElement("div",{className:"d-flex flex-row pl-1"},v.a.createElement("a",{onClick:this.toggleSound,title:e("chat.option_sound")},v.a.createElement("i",{className:"material-icons chat-setting-item text-muted"},!0===this.props.chatwidget.getIn(["usersettings","soundOn"])?"volume_up":"volume_off")),this.props.chatwidget.hasIn(["chat_ui","print"])&&v.a.createElement("a",{target:"_blank",href:this.props.chatwidget.get("base_url")+"chat/printchat/"+this.props.chatwidget.getIn(["chatData","id"])+"/"+this.props.chatwidget.getIn(["chatData","hash"]),title:e("button.print")},v.a.createElement("i",{className:"material-icons chat-setting-item text-muted"},"print")),!this.props.chatwidget.getIn(["chatLiveData","closed"])&&this.props.chatwidget.hasIn(["chat_ui","file"])&&v.a.createElement(R,{fileOptions:this.props.chatwidget.getIn(["chat_ui","file_options"]),onDrag:this.dragging,dropArea:this.textMessageRef,onCompletion:this.updateMessages,progress:this.setStatusText,base_url:this.props.chatwidget.get("base_url"),chat_id:this.props.chatwidget.getIn(["chatData","id"]),hash:this.props.chatwidget.getIn(["chatData","hash"]),link:!0}),!this.props.chatwidget.getIn(["chatLiveData","closed"])&&v.a.createElement("a",{onClick:this.toggleModal,title:e("button.bb_code")},v.a.createElement("i",{className:"material-icons chat-setting-item text-muted"},"face")),this.props.chatwidget.hasIn(["chat_ui","close_btn"])&&v.a.createElement("a",{onClick:this.endChat,title:e("button.end_chat")},v.a.createElement("i",{className:"material-icons chat-setting-item text-muted"},"close")))))),v.a.createElement("div",{className:n},this.props.chatwidget.getIn(["chatLiveData","closed"])&&this.props.chatwidget.hasIn(["chat_ui","survey_id"])&&v.a.createElement("button",{onClick:this.goToSurvey,className:"w-100 btn btn-success"},e("online_chat.go_to_survey")),(!this.props.chatwidget.getIn(["chatLiveData","closed"])||!this.props.chatwidget.hasIn(["chat_ui","survey_id"]))&&v.a.createElement("textarea",{maxLength:this.props.chatwidget.getIn(["chat_ui","max_length"]),style:{height:!0===this.props.chatwidget.get("shown")&&this.textMessageRef.current&&(/\r|\n/.exec(this.state.value)||this.state.value.length>this.textMessageRef.current.offsetWidth/8.6)?"60px":"auto"},onFocus:this.scrollBottom,onTouchStart:this.scrollBottom,autoFocus:"widget"==this.props.chatwidget.get("mode"),"aria-label":"Type your message here...",onKeyUp:this.keyUp,readOnly:this.props.chatwidget.getIn(["chatLiveData","closed"]),id:"CSChatMessage",placeholder:s,onKeyDown:this.enterKeyDown,value:this.state.value,onChange:this.handleChange,ref:this.textMessageRef,rows:"1",className:"pl-0 no-outline form-control rounded-0 form-control border-left-0 border-right-0 border-0"})),!this.props.chatwidget.getIn(["chatLiveData","closed"])&&v.a.createElement("div",{className:"disable-select"},v.a.createElement("div",{className:"user-chatwidget-buttons pt-1 pr-1",id:"ChatSendButtonContainer"},!0===this.state.voiceMode&&v.a.createElement(f.Suspense,{fallback:"..."},v.a.createElement(z,{onCompletion:this.updateMessages,progress:this.setStatusText,base_url:this.props.chatwidget.get("base_url"),chat_id:this.props.chatwidget.getIn(["chatData","id"]),hash:this.props.chatwidget.getIn(["chatData","hash"]),maxSeconds:"30",cancel:this.cancelVoiceRecording})),this.props.chatwidget.hasIn(["chat_ui","voice_message"])&&0==this.state.value.length&&!1===this.state.voiceMode&&v.a.createElement("a",{onClick:this.startVoiceRecording,title:e("button.record_voice")},v.a.createElement("i",{className:"material-icons text-muted settings mr-0"},"mic_none")),(!this.props.chatwidget.hasIn(["chat_ui","voice_message"])||this.state.value.length>0&&!1===this.state.voiceMode)&&v.a.createElement("a",{onClick:this.sendMessage,title:e("button.send")},v.a.createElement("i",{className:"material-icons text-muted settings mr-0"},"send")))))))}}]),e}(f.Component))||B;e.default=Object(P.b)()(G)},80:function(t,e,a){"use strict";var s=a(78),i=a.n(s),r=a(6),n=a.n(r),o=a(7),c=a.n(o),l=a(10),h=a.n(l),d=a(11),u=a.n(d),p=a(3),_=a.n(p),g=a(12),m=a.n(g),f=a(4),v=a.n(f),b=a(0),y=a.n(b),w=a(2),E=a.n(w),D=a(77),C=a.n(D),k=a(18),M=a(86),I=a.n(M),O=function(t){function e(t){var a;return n()(this,e),a=h()(this,u()(e).call(this,t)),v()(_()(a),"state",{body:null}),v()(_()(a),"dismissModal",(function(){a.props.toggle()})),v()(_()(a),"generalOnClick",(function(t){var e=a.props.t,s=t["data-bb-code"];if(t["data-promt"]&&"img"==t["data-promt"])(i=prompt(e("bbcode.img_link")))&&(s="["+s+"]"+i+"[/"+s+"]");else if(t["data-promt"]&&"url"==t["data-promt"]){var i;(i=prompt(e("bbcode.link")))&&(s="[url="+i+"]"+e("bbcode.link_here")+"[/url]")}a.props.insertText(s)})),v()(_()(a),"generalDataActionClick",(function(t){t["data-action"]&&a.props[t["data-action"]]&&a.props[t["data-action"]]()})),a}return m()(e,t),c()(e,[{key:"componentDidMount",value:function(){var t=this;E.a.get(window.lhcChat.base_url+this.props.dataUrl).then((function(e){t.setState({body:e.data});var s=document.getElementById("dialog-content"),i=a(39),r=s.querySelectorAll('[data-toggle="tab"]');if(r.length>0){var n=0;Array.prototype.forEach.call(r,(function(t){new i.Tab(t)}));var o=new I.a(".tab-content");o.onSwipeLeft((function(){n=n<r.length-1?n+1:0,r[n].Tab.show()})),o.onSwipeRight((function(){n=n>0?n-1:r.length-1,r[n].Tab.show()}))}})).catch((function(t){console.log(t)}))}},{key:"render",value:function(){var t=this;return y.a.createElement(y.a.Fragment,null,null!==this.state.body&&y.a.createElement("div",{className:"fade modal-backdrop show"}),null!==this.state.body&&y.a.createElement("div",{role:"dialog",id:"dialog-content","aria-modal":"true",className:"fade modal show d-block",tabIndex:"-1"},C()(this.state.body,{replace:function(e){if(e.attribs&&"react-close-modal"===e.attribs.id)return y.a.createElement("button",{type:"button",className:"close float-right","data-dismiss":"modal",onClick:t.dismissModal,"aria-label":"Close"},y.a.createElement("span",{"aria-hidden":"true"},"×"));if(e.attribs&&e.attribs.bbitem)return e.attribs.class&&(e.attribs.className=e.attribs.class,delete e.attribs.class),y.a.createElement("a",i()({},e.attribs,{onClick:function(a){return t.generalOnClick(e.attribs)}}),Object(D.domToReact)(e.children));if(e.type&&"tag"===e.type&&e.name&&"input"==e.name&&e.attribs&&e.attribs.type&&"button"==e.attribs.type)return e.attribs.class&&(e.attribs.className=e.attribs.class,delete e.attribs.class),y.a.createElement("input",i()({},e.attribs,{onClick:function(a){return t.generalDataActionClick(e.attribs)}}));if(e.type&&"script"===e.type){if(e.children.length>0)setTimeout((function(){var t=document.createElement("script");t.appendChild(document.createTextNode(e.children[0].data)),document.getElementsByTagName("head").item(0).appendChild(t)}),500);else if(e.attribs&&e.attribs.src){var a=document.createElement("script");a.src=e.attribs.src,a.type="text/javascript",document.getElementsByTagName("head").item(0).appendChild(a)}return y.a.createElement(y.a.Fragment,null)}}})))}}]),e}(b.PureComponent);e.a=Object(k.b)()(O)},87:function(t,e,a){t.exports=a(107)},88:function(t,e){function a(t,e,a,s,i,r,n){try{var o=t[r](n),c=o.value}catch(t){return void a(t)}o.done?e(c):Promise.resolve(c).then(s,i)}t.exports=function(t){return function(){var e=this,s=arguments;return new Promise((function(i,r){var n=t.apply(e,s);function o(t){a(n,i,r,o,c,"next",t)}function c(t){a(n,i,r,o,c,"throw",t)}o(void 0)}))}}}}]);