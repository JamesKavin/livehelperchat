{"version":3,"file":"4e487e22ee026703301e.js","mappings":"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","sources":["webpack://LiveHelperChat/./src/lib/widgets/needhelpWidget.js"],"sourcesContent":["import {settings} from '../settings.js';\nimport {UIConstructorIframe} from '../UIConstructorIframe';\nimport {helperFunctions} from '../helperFunctions';\n\nexport class needhelpWidget{\n    constructor(prefix) {\n\n        this.attributes = {};\n        this.hidden = false;\n        this.widgetOpen = false;\n        this.invitationOpen = false;\n        this.nhOpen = false;\n\n        this.cont = new UIConstructorIframe((prefix || 'lhc')+'_needhelp_widget_v2', helperFunctions.getAbstractStyle({\n            zindex: \"2147483639\",\n            width: \"320px\",\n            height: \"135px\",\n            position: \"fixed\",\n            display: \"none\",\n        }), null, \"iframe\");\n\n        this.loadStatus = {main : false, theme: false, status: false};\n    }\n    \n    checkLoadStatus() {\n        if (this.loadStatus['theme'] == true && this.loadStatus['main'] == true && this.loadStatus['status'] == true) {\n            this.cont.elmDomDoc.body.style.display = \"\";\n        }\n    }\n    \n    init(attributes, settings) {\n\n        this.attributes = attributes;\n\n        var placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom) +\"px\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n\n        var leftPosition = false;\n\n        if (attributes.position_placement == 'bottom_left' || attributes.position_placement == 'full_height_left') {\n            placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom) +\"px\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (attributes.position_placement == 'middle_left') {\n            placement = {bottom: \"calc(50% + 35px)\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (attributes.position_placement == 'middle_right') {\n            placement = {bottom: \"calc(50% + 35px)\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n        }\n\n        this.cont.massRestyle(placement);\n\n        this.attributes = attributes;\n\n        this.cont.tmpl = settings['html'].replace('{dev_type}',(this.attributes.isMobile === true ? 'lhc-mobile' : 'lhc-desktop'));\n        this.cont.bodyId = 'need-help';\n        \n        if (this.cont.constructUIIframe('', this.attributes.staticJS['dir']) === null){\n            return null;\n        }\n        \n        // Content invisible untill media loads\n        this.cont.elmDomDoc.body.style.display = \"none\";\n        \n        this.cont.elmDom.className += this.attributes.isMobile === true ? ' lhc-mobile' : ' lhc-desktop';\n\n        this.cont.attachUserEventListener(\"click\", function (e) {\n            attributes.eventEmitter.emitEvent('nhClicked', [{'event': e, 'sender' : 'closeButton'}]);\n            attributes.eventEmitter.emitEvent('showWidget', [{'event': e}]);\n        }, \"start-chat-btn\",'nhstrt');\n\n        var _that = this;\n\n        this.cont.attachUserEventListener(\"click\", function (a) {\n            attributes.eventEmitter.emitEvent('nhClosed', [{'sender' : 'closeButton'}]);\n            a.stopPropagation();\n            _that.hide(true);\n        }, \"close-need-help-btn\",'nhcls');\n\n        if (settings.dimensions) {\n            if (leftPosition == true && settings.dimensions['right']) {\n                settings.dimensions['left'] = settings.dimensions['right'];\n                delete settings.dimensions['right'];\n            }\n            this.cont.massRestyle(settings.dimensions);\n        }\n\n        this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['main'] = true; this.checkLoadStatus()},crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_css']}, true);\n\n        if (this.attributes.isMobile == true) {\n            this.cont.insertCssRemoteFile({crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_mobile_css']});\n        }\n\n        if (this.attributes.theme) {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-needhelp\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/themeneedhelp/' + this.attributes.theme + '?v=' + this.attributes.theme_v}, true);\n        } else {\n            this.loadStatus['theme'] = true;\n            this.checkLoadStatus();\n        }\n\n        // Show need help only if status widget is loaded\n        attributes.sload.subscribe((data) => {if(data){this.loadStatus['status'] = true; this.checkLoadStatus()}});\n\n        if (!settings['ap']) {\n            attributes.eventEmitter.addListener('showInvitation', () => {\n                this.invitationOpen = true;\n                this.hide();\n            });\n\n            attributes.eventEmitter.addListener('chatStarted', () => {\n                this.hide(true);\n            });\n\n            attributes.eventEmitter.addListener('hideInvitation', () => {\n                this.invitationOpen = false;\n                this.show();\n            });\n\n            attributes.eventEmitter.addListener('cancelInvitation', () => {\n                this.invitationOpen = false;\n                this.show();\n            });\n\n            attributes.msgsnippet_status.subscribe((data) => {\n                data == true && this.hide(true);\n            });\n\n            attributes.shidden.subscribe((data) => {\n                data ? this.hide(false) : this.show();\n            });\n        }\n\n        setTimeout(() => {\n\n            attributes.widgetStatus.subscribe((data) => {\n                data == true ? (this.widgetOpen = true,this.hide()) : (this.widgetOpen = false,this.show());\n            });\n\n            attributes.onlineStatus.subscribe((data) => {\n                if (data == false) {\n                    let needHide = this.hidden;\n                    this.hide();\n                    // Show next time only if it was not hidden already\n                    if (needHide === false) {\n                        this.hidden = false;\n                    }\n                } else {\n                    this.show();\n                }\n            });\n\n\n\n        }, settings.delay);\n\n        attributes.eventEmitter.addListener('reloadWidget',() => {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-needhelp\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/themeneedhelp/' + this.attributes.theme + '?v=' + Date.now()}, true);\n        });\n\n    }\n\n    hide (persistent) {\n\n        if (typeof persistent !== 'undefined' && persistent === true) {\n            this.attributes.userSession.hnh = Math.round(Date.now() / 1000);\n            this.attributes.storageHandler.storeSessionInformation(this.attributes.userSession.getSessionAttributes());\n            this.hidden = true;\n        }\n\n        this.cont.hide();\n\n        if (this.nhOpen == true) {\n            this.attributes.eventEmitter.emitEvent('nhHide', []);\n        }\n\n        this.nhOpen = false;\n    }\n\n    show () {\n\n        if (this.hidden == true || this.widgetOpen == true ||  this.invitationOpen == true || this.attributes.onlineStatus.value == false) {\n            return;\n        }\n\n        if (this.attributes.hideOffline === false) {\n            this.cont.show();\n            if (this.nhOpen == false) {\n                this.attributes.eventEmitter.emitEvent('nhShow', []);\n            }\n            this.nhOpen = true;\n        } else {\n            this.cont.hide();\n            if (this.nhOpen == true) {\n                this.attributes.eventEmitter.emitEvent('nhHide', []);\n            }\n            this.nhOpen = false;\n        }\n    }\n}"],"names":["needhelpWidget","prefix","this","attributes","hidden","widgetOpen","invitationOpen","nhOpen","cont","UIConstructorIframe","helperFunctions","zindex","width","height","position","display","loadStatus","main","theme","status","elmDomDoc","body","style","settings","placement","bottom","widgetDimesions","value","wbottom","right","wright","leftPosition","position_placement","left","massRestyle","tmpl","replace","isMobile","bodyId","constructUIIframe","staticJS","elmDom","className","attachUserEventListener","e","eventEmitter","emitEvent","_that","a","stopPropagation","hide","dimensions","insertCssRemoteFile","onload","checkLoadStatus","crossOrigin","href","id","LHC_API","args","lhc_base_url","theme_v","sload","subscribe","data","addListener","show","msgsnippet_status","shidden","setTimeout","widgetStatus","onlineStatus","needHide","delay","Date","now","persistent","userSession","hnh","Math","round","storageHandler","storeSessionInformation","getSessionAttributes","hideOffline"],"sourceRoot":""}