$.fn.makeDropdown=function(){var t=this.find(".btn-block-department-filter > input");this.click((function(){setTimeout((function(){t.focus()}),50)})),this.on("click","[data-stopPropagation]",(function(t){t.stopPropagation()}));var e=this.attr("data-limit")?parseInt(this.attr("data-limit")):0;this.each((function(){var t=$(this).find(".selected-items-filter");$(this).find(".btn-department-dropdown").attr("data-text",$(this).find(".btn-department-dropdown").text());var n=t.find(".delete-item").length;if(n>0){var i=1==n?t.find(".delete-item").first().parent().text().trim().replace("delete",""):"";$(this).find(".btn-department-dropdown").text((1==n?i:"["+n+"] ")+(1!=n?$(this).find(".btn-department-dropdown").attr("data-text"):""))}var a=$(this).find("li input:checked");1==a.length&&$(this).find(".btn-department-dropdown").text(a.first().parent().text());var d=$(this);d.on("change","li input:checkbox",(function(){var n,i;$(this).is(":checked")?(0==t.find('.delete-item[data-value="'+$(this).val()+'"]').length&&t.prepend('<div class="fs12"><a data-stoppropagation="true" class="delete-item" data-value="'+$(this).val()+'"><input type="hidden" value="'+$(this).val()+'" name="'+d.find(".btn-block-department-filter > input").attr("data-scope")+(0==e||e>1?"[]":"")+'" /><i class="material-icons chat-unread">delete</i>'+$(this).parent().text().trim()+"</a></div>"),e>0&&t.find(".delete-item:gt("+(e-1)+")").each((function(){$(this).parent().remove(),$(".search-option-item > label > input[value="+$(this).attr("data-value")+"]").prop("checked",!1)}))):t.find('.delete-item[data-value="'+$(this).val()+'"]').remove(),i=1==(n=t.find(".delete-item").length)?t.find(".delete-item").first().parent().text().trim().replace("delete",""):"",n>0?d.find(".btn-department-dropdown").text((1==n?i:"["+n+"] ")+(1!=n?d.find(".btn-department-dropdown").attr("data-text"):"")):d.find(".btn-department-dropdown").text(d.find(".btn-department-dropdown").attr("data-text"))})),d.on("change","li input:radio",(function(){$(this).is(":checked")&&d.find(".btn-department-dropdown").text($(this).parent().text())})),$(this).on("click",".delete-item",(function(){d.find("input[value="+$(this).attr("data-value")+"]").prop("checked",!1),$(this).parent().remove();var t=d.find("li input:checked").length;t>0?d.find(".btn-department-dropdown").text("["+t+"] "+d.find(".btn-department-dropdown").attr("data-text")):d.find(".btn-department-dropdown").text(d.find(".btn-department-dropdown").attr("data-text"))}))}));t.keyup((function(){if($(this).attr("ajax-provider")){var t=$(this).parent().parent(),e=$(this).parent();$.getJSON(WWW_DIR_JAVASCRIPT+"chat/searchprovider/"+$(this).attr("ajax-provider")+"/?q="+encodeURIComponent($(this).val()),(function(n){var i="";n.items.forEach((function(t){var a=1==e.find('.delete-item[data-value="'+t.id+'"]').length;i+='<li class="search-option-item" data-stoppropagation="true"><label><input type="checkbox" '+(a?' checked="checked" ':"")+' name="selector-'+n.props.list_id+'[]" value="'+t.id+'"> '+t.name+"</label></li>"})),t.find(".search-option-item").remove(),t.append(i)}))}else{var n=$(this).val();$(this).parent().parent().children("li").each((function(t){t>0&&($(this).text().toLowerCase().includes(n)||""==n?$(this).show():$(this).hide())}))}}))};