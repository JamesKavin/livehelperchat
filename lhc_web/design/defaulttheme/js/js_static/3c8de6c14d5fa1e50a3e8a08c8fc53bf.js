try{services.factory("LiveHelperChatViewsFactory",["$http","$q",function(e,t){return this.updateViewsList=function(i){var n=t.defer();return e.get(WWW_DIR_JAVASCRIPT+"views/updateviews").then((function(e){void 0!==e.error_url?document.location=e.data.error_url:n.resolve(e.data)}),(function(e){n.reject(void 0!==e.status?"["+e.status+"]":"[0]")})),n.promise},this.loadInitialData=function(i){var n=t.defer();return e.get(WWW_DIR_JAVASCRIPT+"views/loadinitialdata"+i).then((function(e){void 0!==e.error_url?document.location=e.data.error_url:n.resolve(e.data)}),(function(e){n.reject(void 0!==e.status?"["+e.status+"]":"[0]")})),n.promise},this.loadView=function(i,n){var r=t.defer(),o=void 0!==n?n:"";return e.get(WWW_DIR_JAVASCRIPT+"views/loadview/"+i+o).then((function(e){r.resolve(e.data)}),(function(e){r.reject(void 0!==e.status?"["+e.status+"]":"[0]")})),r.promise},this.deleteView=function(i){var n=t.defer();return e.post(WWW_DIR_JAVASCRIPT+"views/deleteview/"+i).then((function(e){n.resolve(e.data)}),(function(e){n.reject(void 0!==e.status?"["+e.status+"]":"[0]")})),n.promise},this.loadViewPage=function(i){var n=t.defer();return e.get(i+"/(mode)/list").then((function(e){n.resolve(e.data)}),(function(e){n.reject(void 0!==e.status?"["+e.status+"]":"[0]")})),n.promise},this.truncate=function(e,t,i){return isNaN(t)&&(t=10),void 0===i&&(i="..."),e.length<=t||e.length-i.length<=t?e:String(e).substring(0,t-i.length)+i},this}]),lhcAppControllers.controller("LiveHelperChatViewsCtrl",["$scope","$http","$location","$rootScope","$log","$interval","LiveHelperChatViewsFactory",function(e,t,i,n,r,o,s){e.current_user_id=confLH.user_id,this.views=[],this.currentView=null,this.updateTimeout=null,this.updateViewsTimeout=null;var a=this;this.initLHCData=function(){s.loadInitialData("").then((function(e){a.views=e.views,a.views.length>0&&a.loadView(a.views[0]),a.setUpdateLive(),a.setUpdateLiveViews()})),$("#view-content").on("click",".page-link",(function(e){if(e.stopPropagation(),e.preventDefault(),"#"!=$(e.target).attr("href")){var t=$(e.target).attr("href"),i=t.match(/\(page\)\/(\d+)/),n=1;null!=i&&(n=i[1]),a.currentView.page=n,a.updateViewList(t)}}))},this.updateViewList=function(e){s.loadViewPage(e).then((function(e){document.getElementById("view-content-list").innerHTML=e.body,null!=a.currentView&&a.currentView.id==e.view_id&&(a.currentView.total_records=e.total_records),a.protectCSFR()}))},this.setUpdateLiveViews=function(){clearTimeout(this.updateViewsTimeout),this.updateViewsTimeout=setTimeout((function(){s.updateViewsList().then((function(e){a.views=e.views})),a.setUpdateLiveViews()}),5e3)},this.setUpdateLive=function(){clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout((function(){null!=a.currentView&&a.updateViewList(WWW_DIR_JAVASCRIPT+"views/loadview/"+a.currentView.id+"/(page)/"+a.currentView.page),a.setUpdateLive()}),2e4)},this.fetchViews=function(){s.loadInitialData("").then((function(e){a.views=e.views}))},this.deleteView=function(e){confirm("Are you sure?")&&s.deleteView(e.id).then((function(){a.views.splice(a.views.indexOf(e),1),null!==a.currentView&&a.currentView.id==e.id&&(a.currentView=null),a.views.length>0&&a.loadView(a.views[0])}))},this.cleanupTabs=function(){var e=[];$.each(lhinst.chatsSynchronising,(function(t,i){e.push(i)})),$.each(e,(function(e,t){lhinst.removeSynchroChat(t)}))},this.loadView=function(e){this.cleanupTabs(),a.currentView=e,a.currentView.page=1,s.loadView(e.id).then((function(e){null!==a.currentView&&a.currentView.id==e.view_id&&(document.getElementById("view-content").innerHTML=e.body,a.currentView.total_records=e.total_records,a.protectCSFR())}))},this.protectCSFR=function(){$("#view-content a.csfr-required").click((function(){var e=$(this);e.attr("data-secured")||(e.attr("href",e.attr("href")+"/(csfr)/"+confLH.csrf_token),e.attr("data-secured",1))}))},this.initLHCData()}])}catch(e){if(!lhcError)throw Error("lhc : "+e.message);lhcError.log(e.message,"angular.lhc-views.js",e.lineNumber||e.line,e.stack)}
//# sourceMappingURL=3c8de6c14d5fa1e50a3e8a08c8fc53bf.js.map
