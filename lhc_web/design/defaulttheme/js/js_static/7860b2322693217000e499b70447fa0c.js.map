{"version":3,"sources":["7860b2322693217000e499b70447fa0c.js"],"names":["services","factory","e","n","this","loadOnlineUsers","i","t","defer","get","WWW_DIR_JAVASCRIPT","timeout","department","max_rows","country","time_on_site","encodeURIComponent","then","resolve","data","promise","deleteOnlineUser","post","user_id","confLH","csrf_token","error_url","document","location","lhcAppControllers","controller","o","s","r","a","onlineusers","onlineusersPreviousID","onlineusersGrouped","updateTimeout","userTimeout","maxRows","predicate","reverse","wasInitiated","forbiddenVisitors","soundEnabled","notificationEnabled","lastSyncSkipped","u","forEach","getElementById","MutationObserver","classList","contains","updateList","observe","attributes","attributeFilter","childList","characterData","groupByField","groupBy","sort","length","label","id","ou","push","lhinst","disableSync","ee","emitEvent","angular","indexOf","Modernizr","audio","Audio","src","ogg","WWW_DIR_JAVASCRIPT_FILES","mp3","load","setTimeout","play","window","webkitNotifications","Notification","checkPermission","createNotification","WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION","ip","user_country_name","page_title","referrer","onclick","cancel","show","permission","icon","body","close","$watch","changeUserSettingsIndifferent","showOnlineUserInfo","lhc","revealModal","url","previewChat","chat_id","can_view_chat","sendMessage","deleteUser","confirm","splice","disableNewUserBNotif","changeUserSettings","disableNewUserSound","$on"],"mappings":"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","file":"7860b2322693217000e499b70447fa0c.js","sourcesContent":["services.factory(\"OnlineUsersFactory\",[\"$http\",\"$q\",function(e,n){return this.loadOnlineUsers=function(i){var t=n.defer();return e.get(WWW_DIR_JAVASCRIPT+\"chat/onlineusers/(method)/ajax/(timeout)/\"+i.timeout+(i.department>0?\"/(department)/\"+i.department:\"\")+(i.max_rows>0?\"/(maxrows)/\"+i.max_rows:\"\")+(\"\"!=i.country?\"/(country)/\"+i.country:\"\")+(\"\"!=i.time_on_site?\"/(timeonsite)/\"+encodeURIComponent(i.time_on_site):\"\")).then((function(e){t.resolve(e.data)})),t.promise},this.deleteOnlineUser=function(i){var t=n.defer();return e.post(WWW_DIR_JAVASCRIPT+\"chat/onlineusers/(deletevisitor)/\"+i.user_id+\"/(csfr)/\"+confLH.csrf_token).then((function(e){void 0!==e.error_url?document.location=e.data.error_url:t.resolve(e.data)})),t.promise},this}]),lhcAppControllers.controller(\"OnlineCtrl\",[\"$scope\",\"$http\",\"$location\",\"$rootScope\",\"$log\",\"$interval\",\"OnlineUsersFactory\",function(e,n,i,t,o,s,r){var a;this.onlineusers=[],this.onlineusersPreviousID=[],e.onlineusersGrouped=[],this.updateTimeout=\"10\",this.userTimeout=\"3600\",this.maxRows=\"50\",this.department=\"0\",this.country=\"none\",this.predicate=\"last_visit\",this.time_on_site=\"\",this.reverse=!0,this.wasInitiated=!1,this.forbiddenVisitors=!1,this.soundEnabled=!1,this.notificationEnabled=!1,this.lastSyncSkipped=!1;var u=this;!0!==u.forbiddenVisitors&&[\"onlineusers\",\"widget-onvisitors\",\"map\",\"dashboard\"].forEach((function(e){var n=document.getElementById(e);null!==n&&new MutationObserver((function(e){n.classList.contains(\"active\")&&1==u.lastSyncSkipped&&u.updateList()})).observe(n,{attributes:!0,attributeFilter:[\"class\"],childList:!1,characterData:!1})})),e.groupByField=\"none\",e.groupBy=function(n){var i,t;e.onlineusersGrouped=[],i=u.onlineusers,t=n,i.sort((function(e,n){return e[t]<=n[t]?-1:1}));for(var o=\"_INVALID_GROUP_VALUE_\",s=0;s<u.onlineusers.length;s++){var r=u.onlineusers[s];if(r[n]!==o){var a={label:r[n],id:s,ou:[]};o=a.label,e.onlineusersGrouped.push(a)}a.ou.push(r)}},this.updateList=function(){if(1!=lhinst.disableSync&&1!=u.forbiddenVisitors){var n=!1,i=document.getElementById(\"onlineusers\");if(null!==i&&(n=i.classList.contains(\"active\")),0==n){var t=document.getElementById(\"map\");null!==t&&(n=t.classList.contains(\"active\"))}if(0==n)if(null!==document.getElementById(\"widget-onvisitors-body\")){var o=document.getElementById(\"dashboard\");null!==o&&o.classList.contains(\"active\")&&(n=!0)}!1!==n?(u.lastSyncSkipped=!1,r.loadOnlineUsers({timeout:u.userTimeout,time_on_site:u.time_on_site,department:u.department,country:u.country,max_rows:u.maxRows}).then((function(n){if(u.onlineusers=n,\"none\"!=e.groupByField?e.groupBy(e.groupByField):(e.onlineusersGrouped=[],e.onlineusersGrouped.push({label:\"\",id:0,ou:u.onlineusers})),ee.emitEvent(\"chatAdminSyncOnlineVisitors\",[n]),u.notificationEnabled||u.soundEnabled){var i=!1,t=[];if(angular.forEach(u.onlineusers,(function(e,n){var o=!0;-1==u.onlineusersPreviousID.indexOf(e.id)&&(o=!1,u.onlineusersPreviousID.push(e.id)),1==u.wasInitiated&&0==o&&(i=!0,t.push(e))})),1==i){if(u.soundEnabled&&Modernizr.audio){var o=new Audio;o.src=Modernizr.audio.ogg?WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.ogg\":Modernizr.audio.mp3?WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.mp3\":WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.wav\",o.load(),setTimeout((function(){o.play()}),500)}u.notificationEnabled&&(window.webkitNotifications||window.Notification)&&angular.forEach(t,(function(e,n){if(window.webkitNotifications)0==window.webkitNotifications.checkPermission()&&((i=window.webkitNotifications.createNotification(WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+\"/notification.png\",e.ip+(\"\"!=e.user_country_name?\", \"+e.user_country_name:\"\"),(\"\"!=e.page_title?e.page_title+\"\\n-----\\n\":\"\")+(\"\"!=e.referrer?e.referrer+\"\\n-----\\n\":\"\"))).onclick=function(){i.cancel()},i.show(),setTimeout((function(){i.cancel()}),15e3));else if(window.Notification){var i;if(\"granted\"==window.Notification.permission)(i=new Notification(e.ip+(\"\"!=e.user_country_name?\", \"+e.user_country_name:\"\"),{icon:WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+\"/notification.png\",body:(\"\"!=e.page_title?e.page_title+\"\\n-----\\n\":\"\")+(\"\"!=e.referrer?e.referrer+\"\\n-----\\n\":\"\")})).onclick=function(){i.close()},setTimeout((function(){i.close()}),15e3)}}))}u.wasInitiated=!0,u.onlineusersPreviousID.length>100&&(u.wasInitiated=!1,u.onlineusersPreviousID=[])}}))):u.lastSyncSkipped=!0}},a=s((function(){0==u.forbiddenVisitors?u.updateList():s.cancel(a)}),1e3*this.updateTimeout),e.$watch(\"online.updateTimeout\",(function(e,n){e!=n&&(s.cancel(a),a=s((function(){u.updateList()}),1e3*e),lhinst.changeUserSettingsIndifferent(\"oupdate_timeout\",e))})),e.$watch(\"online.userTimeout\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ouser_timeout\",e)})),e.$watch(\"online.country\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ocountry\",e)})),e.$watch(\"online.time_on_site\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"otime_on_site\",\"\"==e?\"none\":e)})),e.$watch(\"online.maxRows\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"omax_rows\",e)})),e.$watch(\"online.department\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"o_department\",e)})),e.$watch(\"groupByField\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ogroup_by\",e)})),e.$watch(\"online.userTimeout + online.department + online.maxRows + groupByField + online.country + online.time_on_site\",(function(e,n){setTimeout((function(){u.updateList()}),500)})),this.showOnlineUserInfo=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/getonlineuserinfo/\"+e})},this.previewChat=function(e){e.chat_id>0&&1==e.can_view_chat&&lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/previewchat/\"+e.chat_id})},this.sendMessage=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/sendnotice/\"+e})},this.deleteUser=function(e,n){confirm(n)&&r.deleteOnlineUser({user_id:e.id}).then((function(n){u.onlineusers.splice(u.onlineusers.indexOf(e),1)}))},this.disableNewUserBNotif=function(){u.notificationEnabled=!u.notificationEnabled,lhinst.changeUserSettings(\"new_user_bn\",1==u.notificationEnabled?1:0)},this.disableNewUserSound=function(){u.soundEnabled=!u.soundEnabled,lhinst.changeUserSettings(\"new_user_sound\",1==u.soundEnabled?1:0)},e.$on(\"$destroy\",(function(){s.cancel(a)}))}]);\n"]}