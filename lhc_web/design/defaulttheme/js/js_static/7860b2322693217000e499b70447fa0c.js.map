{"version":3,"sources":["7860b2322693217000e499b70447fa0c.js"],"names":["services","factory","e","n","this","loadOnlineUsers","i","t","defer","get","WWW_DIR_JAVASCRIPT","timeout","department","max_rows","country","time_on_site","encodeURIComponent","then","resolve","data","promise","deleteOnlineUser","post","user_id","confLH","csrf_token","error_url","document","location","lhcAppControllers","controller","o","s","r","a","onlineusers","onlineusersPreviousID","onlineusersGrouped","updateTimeout","userTimeout","maxRows","predicate","reverse","wasInitiated","forbiddenVisitors","soundEnabled","notificationEnabled","groupByField","u","groupBy","sort","length","label","id","ou","push","updateList","lhinst","disableSync","ee","emitEvent","angular","forEach","indexOf","Modernizr","audio","Audio","src","ogg","WWW_DIR_JAVASCRIPT_FILES","mp3","load","setTimeout","play","window","webkitNotifications","Notification","checkPermission","createNotification","WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION","ip","user_country_name","page_title","referrer","onclick","cancel","show","permission","icon","body","close","$watch","changeUserSettingsIndifferent","showOnlineUserInfo","lhc","revealModal","url","previewChat","chat_id","can_view_chat","sendMessage","deleteUser","confirm","splice","disableNewUserBNotif","changeUserSettings","disableNewUserSound","$on"],"mappings":"AAAAA,SAASC,QAAQ,qBAAqB,CAAC,QAAQ,KAAK,SAASC,EAAEC,GAAG,OAAOC,KAAKC,gBAAgB,SAASC,GAAG,IAAIC,EAAEJ,EAAEK,QAAQ,OAAON,EAAEO,IAAIC,mBAAmB,4CAA4CJ,EAAEK,SAASL,EAAEM,WAAW,EAAE,iBAAiBN,EAAEM,WAAW,KAAKN,EAAEO,SAAS,EAAE,cAAcP,EAAEO,SAAS,KAAK,IAAIP,EAAEQ,QAAQ,cAAcR,EAAEQ,QAAQ,KAAK,IAAIR,EAAES,aAAa,iBAAiBC,mBAAmBV,EAAES,cAAc,KAAKE,MAAK,SAAUf,GAAGK,EAAEW,QAAQhB,EAAEiB,SAASZ,EAAEa,SAAShB,KAAKiB,iBAAiB,SAASf,GAAG,IAAIC,EAAEJ,EAAEK,QAAQ,OAAON,EAAEoB,KAAKZ,mBAAmB,oCAAoCJ,EAAEiB,QAAQ,WAAWC,OAAOC,YAAYR,MAAK,SAAUf,QAAG,IAASA,EAAEwB,UAAUC,SAASC,SAAS1B,EAAEiB,KAAKO,UAAUnB,EAAEW,QAAQhB,EAAEiB,SAASZ,EAAEa,SAAShB,QAAQyB,kBAAkBC,WAAW,aAAa,CAAC,SAAS,QAAQ,YAAY,aAAa,OAAO,YAAY,qBAAqB,SAAS5B,EAAEC,EAAEG,EAAEC,EAAEwB,EAAEC,EAAEC,GAAG,IAAIC,EAAE9B,KAAK+B,YAAY,GAAG/B,KAAKgC,sBAAsB,GAAGlC,EAAEmC,mBAAmB,GAAGjC,KAAKkC,cAAc,KAAKlC,KAAKmC,YAAY,OAAOnC,KAAKoC,QAAQ,KAAKpC,KAAKQ,WAAW,IAAIR,KAAKU,QAAQ,OAAOV,KAAKqC,UAAU,aAAarC,KAAKW,aAAa,GAAGX,KAAKsC,SAAQ,EAAGtC,KAAKuC,cAAa,EAAGvC,KAAKwC,mBAAkB,EAAGxC,KAAKyC,cAAa,EAAGzC,KAAK0C,qBAAoB,EAAG5C,EAAE6C,aAAa,OAAO,IAAIC,EAAE5C,KAAKF,EAAE+C,QAAQ,SAAS9C,GAAG,IAAIG,EAAEC,EAAEL,EAAEmC,mBAAmB,GAAG/B,EAAE0C,EAAEb,YAAY5B,EAAEJ,EAAEG,EAAE4C,MAAK,SAAUhD,EAAEC,GAAG,OAAOD,EAAEK,IAAIJ,EAAEI,IAAI,EAAE,KAAK,IAAI,IAAIwB,EAAE,wBAAwBC,EAAE,EAAEA,EAAEgB,EAAEb,YAAYgB,OAAOnB,IAAI,CAAC,IAAIC,EAAEe,EAAEb,YAAYH,GAAG,GAAGC,EAAE9B,KAAK4B,EAAE,CAAC,IAAIG,EAAE,CAACkB,MAAMnB,EAAE9B,GAAGkD,GAAGrB,EAAEsB,GAAG,IAAIvB,EAAEG,EAAEkB,MAAMlD,EAAEmC,mBAAmBkB,KAAKrB,GAAGA,EAAEoB,GAAGC,KAAKtB,KAAK7B,KAAKoD,WAAW,WAAW,GAAGC,OAAOC,aAAa,GAAGV,EAAEJ,mBAAmBX,EAAE5B,gBAAgB,CAACM,QAAQqC,EAAET,YAAYxB,aAAaiC,EAAEjC,aAAaH,WAAWoC,EAAEpC,WAAWE,QAAQkC,EAAElC,QAAQD,SAASmC,EAAER,UAAUvB,MAAK,SAAUd,GAAG,GAAG6C,EAAEb,YAAYhC,EAAE,QAAQD,EAAE6C,aAAa7C,EAAE+C,QAAQ/C,EAAE6C,eAAe7C,EAAEmC,mBAAmB,GAAGnC,EAAEmC,mBAAmBkB,KAAK,CAACH,MAAM,GAAGC,GAAG,EAAEC,GAAGN,EAAEb,eAAewB,GAAGC,UAAU,8BAA8B,CAACzD,IAAI6C,EAAEF,qBAAqBE,EAAEH,aAAa,CAAC,IAAIvC,GAAE,EAAGC,EAAE,GAAG,GAAGsD,QAAQC,QAAQd,EAAEb,aAAY,SAAUjC,EAAEC,GAAG,IAAI4B,GAAE,GAAI,GAAGiB,EAAEZ,sBAAsB2B,QAAQ7D,EAAEmD,MAAMtB,GAAE,EAAGiB,EAAEZ,sBAAsBmB,KAAKrD,EAAEmD,KAAK,GAAGL,EAAEL,cAAc,GAAGZ,IAAIzB,GAAE,EAAGC,EAAEgD,KAAKrD,OAAO,GAAGI,EAAE,CAAC,GAAG0C,EAAEH,cAAcmB,UAAUC,MAAM,CAAC,IAAIlC,EAAE,IAAImC,MAAMnC,EAAEoC,IAAIH,UAAUC,MAAMG,IAAIC,yBAAyB,mBAAmBL,UAAUC,MAAMK,IAAID,yBAAyB,mBAAmBA,yBAAyB,mBAAmBtC,EAAEwC,OAAOC,YAAW,WAAYzC,EAAE0C,SAAS,KAAKzB,EAAEF,sBAAsB4B,OAAOC,qBAAqBD,OAAOE,eAAef,QAAQC,QAAQvD,GAAE,SAAUL,EAAEC,GAAG,GAAGuE,OAAOC,oBAAoB,GAAGD,OAAOC,oBAAoBE,qBAAqBvE,EAAEoE,OAAOC,oBAAoBG,mBAAmBC,sCAAsC,oBAAoB7E,EAAE8E,IAAI,IAAI9E,EAAE+E,kBAAkB,KAAK/E,EAAE+E,kBAAkB,KAAK,IAAI/E,EAAEgF,WAAWhF,EAAEgF,WAAW,YAAY,KAAK,IAAIhF,EAAEiF,SAASjF,EAAEiF,SAAS,YAAY,MAAMC,QAAQ,WAAW9E,EAAE+E,UAAU/E,EAAEgF,OAAOd,YAAW,WAAYlE,EAAE+E,WAAW,YAAY,GAAGX,OAAOE,aAAa,CAAC,IAAItE,EAAK,WAAWoE,OAAOE,aAAaW,cAAYjF,EAAE,IAAIsE,aAAa1E,EAAE8E,IAAI,IAAI9E,EAAE+E,kBAAkB,KAAK/E,EAAE+E,kBAAkB,IAAI,CAACO,KAAKT,sCAAsC,oBAAoBU,MAAM,IAAIvF,EAAEgF,WAAWhF,EAAEgF,WAAW,YAAY,KAAK,IAAIhF,EAAEiF,SAASjF,EAAEiF,SAAS,YAAY,OAAOC,QAAQ,WAAW9E,EAAEoF,SAASlB,YAAW,WAAYlE,EAAEoF,UAAU,WAAU1C,EAAEL,cAAa,EAAGK,EAAEZ,sBAAsBe,OAAO,MAAMH,EAAEL,cAAa,EAAGK,EAAEZ,sBAAsB,SAASF,EAAEF,GAAE,WAAY,GAAGgB,EAAEJ,kBAAkBI,EAAEQ,aAAaxB,EAAEqD,OAAOnD,KAAK,IAAI9B,KAAKkC,eAAepC,EAAEyF,OAAO,wBAAuB,SAAUzF,EAAEC,GAAGD,GAAGC,IAAI6B,EAAEqD,OAAOnD,GAAGA,EAAEF,GAAE,WAAYgB,EAAEQ,eAAe,IAAItD,GAAGuD,OAAOmC,8BAA8B,kBAAkB1F,OAAOA,EAAEyF,OAAO,sBAAqB,SAAUzF,EAAEC,GAAGD,GAAGC,GAAGsD,OAAOmC,8BAA8B,gBAAgB1F,MAAMA,EAAEyF,OAAO,kBAAiB,SAAUzF,EAAEC,GAAGD,GAAGC,GAAGsD,OAAOmC,8BAA8B,WAAW1F,MAAMA,EAAEyF,OAAO,uBAAsB,SAAUzF,EAAEC,GAAGD,GAAGC,GAAGsD,OAAOmC,8BAA8B,gBAAgB,IAAI1F,EAAE,OAAOA,MAAMA,EAAEyF,OAAO,kBAAiB,SAAUzF,EAAEC,GAAGD,GAAGC,GAAGsD,OAAOmC,8BAA8B,YAAY1F,MAAMA,EAAEyF,OAAO,qBAAoB,SAAUzF,EAAEC,GAAGD,GAAGC,GAAGsD,OAAOmC,8BAA8B,eAAe1F,MAAMA,EAAEyF,OAAO,gBAAe,SAAUzF,EAAEC,GAAGD,GAAGC,GAAGsD,OAAOmC,8BAA8B,YAAY1F,MAAMA,EAAEyF,OAAO,iHAAgH,SAAUzF,EAAEC,GAAGqE,YAAW,WAAYxB,EAAEQ,eAAe,QAAQpD,KAAKyF,mBAAmB,SAAS3F,GAAG4F,IAAIC,YAAY,CAACC,IAAItF,mBAAmB,0BAA0BR,KAAKE,KAAK6F,YAAY,SAAS/F,GAAGA,EAAEgG,QAAQ,GAAG,GAAGhG,EAAEiG,eAAeL,IAAIC,YAAY,CAACC,IAAItF,mBAAmB,oBAAoBR,EAAEgG,WAAW9F,KAAKgG,YAAY,SAASlG,GAAG4F,IAAIC,YAAY,CAACC,IAAItF,mBAAmB,mBAAmBR,KAAKE,KAAKiG,WAAW,SAASnG,EAAEC,GAAGmG,QAAQnG,IAAI8B,EAAEZ,iBAAiB,CAACE,QAAQrB,EAAEmD,KAAKpC,MAAK,SAAUd,GAAG6C,EAAEb,YAAYoE,OAAOvD,EAAEb,YAAY4B,QAAQ7D,GAAG,OAAOE,KAAKoG,qBAAqB,WAAWxD,EAAEF,qBAAqBE,EAAEF,oBAAoBW,OAAOgD,mBAAmB,cAAc,GAAGzD,EAAEF,oBAAoB,EAAE,IAAI1C,KAAKsG,oBAAoB,WAAW1D,EAAEH,cAAcG,EAAEH,aAAaY,OAAOgD,mBAAmB,iBAAiB,GAAGzD,EAAEH,aAAa,EAAE,IAAI3C,EAAEyG,IAAI,YAAW,WAAY3E,EAAEqD,OAAOnD","file":"7860b2322693217000e499b70447fa0c.js","sourcesContent":["services.factory(\"OnlineUsersFactory\",[\"$http\",\"$q\",function(e,n){return this.loadOnlineUsers=function(i){var t=n.defer();return e.get(WWW_DIR_JAVASCRIPT+\"chat/onlineusers/(method)/ajax/(timeout)/\"+i.timeout+(i.department>0?\"/(department)/\"+i.department:\"\")+(i.max_rows>0?\"/(maxrows)/\"+i.max_rows:\"\")+(\"\"!=i.country?\"/(country)/\"+i.country:\"\")+(\"\"!=i.time_on_site?\"/(timeonsite)/\"+encodeURIComponent(i.time_on_site):\"\")).then((function(e){t.resolve(e.data)})),t.promise},this.deleteOnlineUser=function(i){var t=n.defer();return e.post(WWW_DIR_JAVASCRIPT+\"chat/onlineusers/(deletevisitor)/\"+i.user_id+\"/(csfr)/\"+confLH.csrf_token).then((function(e){void 0!==e.error_url?document.location=e.data.error_url:t.resolve(e.data)})),t.promise},this}]),lhcAppControllers.controller(\"OnlineCtrl\",[\"$scope\",\"$http\",\"$location\",\"$rootScope\",\"$log\",\"$interval\",\"OnlineUsersFactory\",function(e,n,i,t,o,s,r){var a;this.onlineusers=[],this.onlineusersPreviousID=[],e.onlineusersGrouped=[],this.updateTimeout=\"10\",this.userTimeout=\"3600\",this.maxRows=\"50\",this.department=\"0\",this.country=\"none\",this.predicate=\"last_visit\",this.time_on_site=\"\",this.reverse=!0,this.wasInitiated=!1,this.forbiddenVisitors=!1,this.soundEnabled=!1,this.notificationEnabled=!1,e.groupByField=\"none\";var u=this;e.groupBy=function(n){var i,t;e.onlineusersGrouped=[],i=u.onlineusers,t=n,i.sort((function(e,n){return e[t]<=n[t]?-1:1}));for(var o=\"_INVALID_GROUP_VALUE_\",s=0;s<u.onlineusers.length;s++){var r=u.onlineusers[s];if(r[n]!==o){var a={label:r[n],id:s,ou:[]};o=a.label,e.onlineusersGrouped.push(a)}a.ou.push(r)}},this.updateList=function(){1!=lhinst.disableSync&&1!=u.forbiddenVisitors&&r.loadOnlineUsers({timeout:u.userTimeout,time_on_site:u.time_on_site,department:u.department,country:u.country,max_rows:u.maxRows}).then((function(n){if(u.onlineusers=n,\"none\"!=e.groupByField?e.groupBy(e.groupByField):(e.onlineusersGrouped=[],e.onlineusersGrouped.push({label:\"\",id:0,ou:u.onlineusers})),ee.emitEvent(\"chatAdminSyncOnlineVisitors\",[n]),u.notificationEnabled||u.soundEnabled){var i=!1,t=[];if(angular.forEach(u.onlineusers,(function(e,n){var o=!0;-1==u.onlineusersPreviousID.indexOf(e.id)&&(o=!1,u.onlineusersPreviousID.push(e.id)),1==u.wasInitiated&&0==o&&(i=!0,t.push(e))})),1==i){if(u.soundEnabled&&Modernizr.audio){var o=new Audio;o.src=Modernizr.audio.ogg?WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.ogg\":Modernizr.audio.mp3?WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.mp3\":WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.wav\",o.load(),setTimeout((function(){o.play()}),500)}u.notificationEnabled&&(window.webkitNotifications||window.Notification)&&angular.forEach(t,(function(e,n){if(window.webkitNotifications)0==window.webkitNotifications.checkPermission()&&((i=window.webkitNotifications.createNotification(WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+\"/notification.png\",e.ip+(\"\"!=e.user_country_name?\", \"+e.user_country_name:\"\"),(\"\"!=e.page_title?e.page_title+\"\\n-----\\n\":\"\")+(\"\"!=e.referrer?e.referrer+\"\\n-----\\n\":\"\"))).onclick=function(){i.cancel()},i.show(),setTimeout((function(){i.cancel()}),15e3));else if(window.Notification){var i;if(\"granted\"==window.Notification.permission)(i=new Notification(e.ip+(\"\"!=e.user_country_name?\", \"+e.user_country_name:\"\"),{icon:WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+\"/notification.png\",body:(\"\"!=e.page_title?e.page_title+\"\\n-----\\n\":\"\")+(\"\"!=e.referrer?e.referrer+\"\\n-----\\n\":\"\")})).onclick=function(){i.close()},setTimeout((function(){i.close()}),15e3)}}))}u.wasInitiated=!0,u.onlineusersPreviousID.length>100&&(u.wasInitiated=!1,u.onlineusersPreviousID=[])}}))},a=s((function(){0==u.forbiddenVisitors?u.updateList():s.cancel(a)}),1e3*this.updateTimeout),e.$watch(\"online.updateTimeout\",(function(e,n){e!=n&&(s.cancel(a),a=s((function(){u.updateList()}),1e3*e),lhinst.changeUserSettingsIndifferent(\"oupdate_timeout\",e))})),e.$watch(\"online.userTimeout\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ouser_timeout\",e)})),e.$watch(\"online.country\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ocountry\",e)})),e.$watch(\"online.time_on_site\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"otime_on_site\",\"\"==e?\"none\":e)})),e.$watch(\"online.maxRows\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"omax_rows\",e)})),e.$watch(\"online.department\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"o_department\",e)})),e.$watch(\"groupByField\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ogroup_by\",e)})),e.$watch(\"online.userTimeout + online.department + online.maxRows + groupByField + online.country + online.time_on_site\",(function(e,n){setTimeout((function(){u.updateList()}),500)})),this.showOnlineUserInfo=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/getonlineuserinfo/\"+e})},this.previewChat=function(e){e.chat_id>0&&1==e.can_view_chat&&lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/previewchat/\"+e.chat_id})},this.sendMessage=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/sendnotice/\"+e})},this.deleteUser=function(e,n){confirm(n)&&r.deleteOnlineUser({user_id:e.id}).then((function(n){u.onlineusers.splice(u.onlineusers.indexOf(e),1)}))},this.disableNewUserBNotif=function(){u.notificationEnabled=!u.notificationEnabled,lhinst.changeUserSettings(\"new_user_bn\",1==u.notificationEnabled?1:0)},this.disableNewUserSound=function(){u.soundEnabled=!u.soundEnabled,lhinst.changeUserSettings(\"new_user_sound\",1==u.soundEnabled?1:0)},e.$on(\"$destroy\",(function(){s.cancel(a)}))}]);\n"]}