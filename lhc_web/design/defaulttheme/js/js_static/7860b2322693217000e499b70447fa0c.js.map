{"version":3,"sources":["7860b2322693217000e499b70447fa0c.js"],"names":["services","factory","e","n","this","loadOnlineUsers","i","t","defer","get","WWW_DIR_JAVASCRIPT","timeout","department","max_rows","country","time_on_site","encodeURIComponent","then","resolve","data","promise","deleteOnlineUser","post","user_id","confLH","csrf_token","error_url","document","location","lhcAppControllers","controller","o","s","r","a","onlineusers","onlineusersPreviousID","onlineusersGrouped","updateTimeout","userTimeout","maxRows","predicate","reverse","wasInitiated","online_connected","forbiddenVisitors","soundEnabled","notificationEnabled","lastSyncSkipped","c","forEach","getElementById","MutationObserver","classList","contains","updateList","observe","attributes","attributeFilter","childList","characterData","groupByField","groupBy","sort","length","label","id","ou","push","lhinst","disableSync","ee","emitEvent","angular","indexOf","Modernizr","audio","Audio","src","ogg","WWW_DIR_JAVASCRIPT_FILES","mp3","load","setTimeout","play","window","webkitNotifications","Notification","checkPermission","createNotification","WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION","ip","user_country_name","page_title","referrer","onclick","cancel","show","permission","icon","body","close","$watch","changeUserSettingsIndifferent","showOnlineUserInfo","lhc","revealModal","url","previewChat","chat_id","can_view_chat","sendMessage","deleteUser","confirm","splice","disableNewUserBNotif","changeUserSettings","showConnected","disableNewUserSound","$on"],"mappings":"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","file":"7860b2322693217000e499b70447fa0c.js","sourcesContent":["services.factory(\"OnlineUsersFactory\",[\"$http\",\"$q\",function(e,n){return this.loadOnlineUsers=function(i){var t=n.defer();return e.get(WWW_DIR_JAVASCRIPT+\"chat/onlineusers/(method)/ajax/(timeout)/\"+i.timeout+(i.department>0?\"/(department)/\"+i.department:\"\")+(i.max_rows>0?\"/(maxrows)/\"+i.max_rows:\"\")+(\"\"!=i.country?\"/(country)/\"+i.country:\"\")+(\"\"!=i.time_on_site?\"/(timeonsite)/\"+encodeURIComponent(i.time_on_site):\"\")).then((function(e){t.resolve(e.data)})),t.promise},this.deleteOnlineUser=function(i){var t=n.defer();return e.post(WWW_DIR_JAVASCRIPT+\"chat/onlineusers/(deletevisitor)/\"+i.user_id+\"/(csfr)/\"+confLH.csrf_token).then((function(e){void 0!==e.error_url?document.location=e.data.error_url:t.resolve(e.data)})),t.promise},this}]),lhcAppControllers.controller(\"OnlineCtrl\",[\"$scope\",\"$http\",\"$location\",\"$rootScope\",\"$log\",\"$interval\",\"OnlineUsersFactory\",function(e,n,i,t,o,s,r){var a;this.onlineusers=[],this.onlineusersPreviousID=[],e.onlineusersGrouped=[],this.updateTimeout=\"10\",this.userTimeout=\"3600\",this.maxRows=\"50\",this.department=\"0\",this.country=\"none\",this.predicate=\"last_visit\",this.time_on_site=\"\",this.reverse=!0,this.wasInitiated=!1,this.online_connected=!1,this.forbiddenVisitors=!1,this.soundEnabled=!1,this.notificationEnabled=!1,this.lastSyncSkipped=!1;var c=this;!0!==c.forbiddenVisitors&&[\"onlineusers\",\"widget-onvisitors\",\"map\",\"dashboard\"].forEach((function(e){var n=document.getElementById(e);null!==n&&new MutationObserver((function(e){n.classList.contains(\"active\")&&1==c.lastSyncSkipped&&c.updateList()})).observe(n,{attributes:!0,attributeFilter:[\"class\"],childList:!1,characterData:!1})})),e.groupByField=\"none\",e.groupBy=function(n){var i,t;e.onlineusersGrouped=[],i=c.onlineusers,t=n,i.sort((function(e,n){return e[t]<=n[t]?-1:1}));for(var o=\"_INVALID_GROUP_VALUE_\",s=0;s<c.onlineusers.length;s++){var r=c.onlineusers[s];if(r[n]!==o){var a={label:r[n],id:s,ou:[]};o=a.label,e.onlineusersGrouped.push(a)}a.ou.push(r)}},this.updateList=function(){if(1!=lhinst.disableSync&&1!=c.forbiddenVisitors){var n=!1,i=document.getElementById(\"onlineusers\");if(null!==i&&(n=i.classList.contains(\"active\")),0==n){var t=document.getElementById(\"map\");null!==t&&(n=t.classList.contains(\"active\"))}if(0==n)if(null!==document.getElementById(\"widget-onvisitors-body\")){var o=document.getElementById(\"dashboard\");null!==o&&o.classList.contains(\"active\")&&(n=!0)}!1!==n?(c.lastSyncSkipped=!1,r.loadOnlineUsers({timeout:c.userTimeout,time_on_site:c.time_on_site,department:c.department,country:c.country,max_rows:c.maxRows}).then((function(n){if(c.onlineusers=n,\"none\"!=e.groupByField?e.groupBy(e.groupByField):(e.onlineusersGrouped=[],e.onlineusersGrouped.push({label:\"\",id:0,ou:c.onlineusers})),ee.emitEvent(\"chatAdminSyncOnlineVisitors\",[n]),c.notificationEnabled||c.soundEnabled){var i=!1,t=[];if(angular.forEach(c.onlineusers,(function(e,n){var o=!0;-1==c.onlineusersPreviousID.indexOf(e.id)&&(o=!1,c.onlineusersPreviousID.push(e.id)),1==c.wasInitiated&&0==o&&(i=!0,t.push(e))})),1==i){if(c.soundEnabled&&Modernizr.audio){var o=new Audio;o.src=Modernizr.audio.ogg?WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.ogg\":Modernizr.audio.mp3?WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.mp3\":WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.wav\",o.load(),setTimeout((function(){o.play()}),500)}c.notificationEnabled&&(window.webkitNotifications||window.Notification)&&angular.forEach(t,(function(e,n){if(window.webkitNotifications)0==window.webkitNotifications.checkPermission()&&((i=window.webkitNotifications.createNotification(WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+\"/notification.png\",e.ip+(\"\"!=e.user_country_name?\", \"+e.user_country_name:\"\"),(\"\"!=e.page_title?e.page_title+\"\\n-----\\n\":\"\")+(\"\"!=e.referrer?e.referrer+\"\\n-----\\n\":\"\"))).onclick=function(){i.cancel()},i.show(),setTimeout((function(){i.cancel()}),15e3));else if(window.Notification){var i;if(\"granted\"==window.Notification.permission)(i=new Notification(e.ip+(\"\"!=e.user_country_name?\", \"+e.user_country_name:\"\"),{icon:WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+\"/notification.png\",body:(\"\"!=e.page_title?e.page_title+\"\\n-----\\n\":\"\")+(\"\"!=e.referrer?e.referrer+\"\\n-----\\n\":\"\")})).onclick=function(){i.close()},setTimeout((function(){i.close()}),15e3)}}))}c.wasInitiated=!0,c.onlineusersPreviousID.length>100&&(c.wasInitiated=!1,c.onlineusersPreviousID=[])}}))):c.lastSyncSkipped=!0}},a=s((function(){0==c.forbiddenVisitors?c.updateList():s.cancel(a)}),1e3*this.updateTimeout),e.$watch(\"online.updateTimeout\",(function(e,n){e!=n&&(s.cancel(a),a=s((function(){c.updateList()}),1e3*e),lhinst.changeUserSettingsIndifferent(\"oupdate_timeout\",e))})),e.$watch(\"online.userTimeout\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ouser_timeout\",e)})),e.$watch(\"online.country\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ocountry\",e)})),e.$watch(\"online.time_on_site\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"otime_on_site\",\"\"==e?\"none\":e)})),e.$watch(\"online.maxRows\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"omax_rows\",e)})),e.$watch(\"online.department\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"o_department\",e)})),e.$watch(\"groupByField\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ogroup_by\",e)})),e.$watch(\"online.userTimeout + online.department + online.maxRows + groupByField + online.country + online.time_on_site\",(function(e,n){setTimeout((function(){c.updateList()}),500)})),this.showOnlineUserInfo=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/getonlineuserinfo/\"+e})},this.previewChat=function(e){e.chat_id>0&&1==e.can_view_chat&&lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/previewchat/\"+e.chat_id})},this.sendMessage=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/sendnotice/\"+e})},this.deleteUser=function(e,n){confirm(n)&&r.deleteOnlineUser({user_id:e.id}).then((function(n){c.onlineusers.splice(c.onlineusers.indexOf(e),1)}))},this.disableNewUserBNotif=function(){c.notificationEnabled=!c.notificationEnabled,lhinst.changeUserSettings(\"new_user_bn\",1==c.notificationEnabled?1:0)},this.showConnected=function(){c.online_connected=!c.online_connected,lhinst.changeUserSettings(\"online_connected\",1==c.online_connected?1:0)},this.disableNewUserSound=function(){c.soundEnabled=!c.soundEnabled,lhinst.changeUserSettings(\"new_user_sound\",1==c.soundEnabled?1:0)},e.$on(\"$destroy\",(function(){s.cancel(a)}))}]);\n"]}