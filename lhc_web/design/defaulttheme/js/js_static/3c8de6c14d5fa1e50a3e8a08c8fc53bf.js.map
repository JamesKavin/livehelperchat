{"version":3,"sources":["3c8de6c14d5fa1e50a3e8a08c8fc53bf.js"],"names":["services","factory","$http","$q","this","updateViewsList","appendURL","deferred","defer","get","WWW_DIR_JAVASCRIPT","then","data","error_url","document","location","resolve","internalError","reject","status","promise","loadInitialData","loadView","id","mode","params","deleteView","post","loadViewPage","href","truncate","text","length","end","isNaN","undefined","String","substring","lhcAppControllers","controller","$scope","$location","$rootScope","$log","$interval","LiveHelperChatViewsFactory","current_user_id","confLH","user_id","views","currentView","updateTimeout","updateViewsTimeout","_that","initLHCData","setUpdateLive","setUpdateLiveViews","$","on","e","stopPropagation","preventDefault","target","attr","link","matches","match","page","updateViewList","getElementById","innerHTML","body","view_id","total_records","protectCSFR","clearTimeout","setTimeout","fetchViews","view","confirm","splice","indexOf","cleanupTabs","chatsToRemove","each","lhinst","chatsSynchronising","index","chat_id","push","removeSynchroChat","click","inst","csrf_token","lhcError","Error","message","log","lineNumber","line","stack"],"mappings":"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","file":"3c8de6c14d5fa1e50a3e8a08c8fc53bf.js","sourcesContent":["try {\nservices.factory('LiveHelperChatViewsFactory', ['$http','$q',function ($http, $q) {\nthis.updateViewsList = function(appendURL) {\nvar deferred = $q.defer();\n$http.get(WWW_DIR_JAVASCRIPT + 'views/updateviews').then(function(data) {\nif (typeof data.error_url !== 'undefined') {\ndocument.location = data.data.error_url;\n} else {\ndeferred.resolve(data.data);\n}\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadInitialData = function(appendURL) {\nvar deferred = $q.defer();\n$http.get(WWW_DIR_JAVASCRIPT + 'views/loadinitialdata' + appendURL).then(function(data) {\nif (typeof data.error_url !== 'undefined') {\ndocument.location = data.data.error_url;\n} else {\ndeferred.resolve(data.data);\n}\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadView = function(id, mode) {\nvar deferred = $q.defer();\nvar params = typeof mode !== 'undefined' ? mode : '';\n$http.get(WWW_DIR_JAVASCRIPT + 'views/loadview/' + id + params).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.deleteView = function(id) {\nvar deferred = $q.defer();\n$http.post(WWW_DIR_JAVASCRIPT + 'views/deleteview/' + id).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadViewPage = function(href) {\nvar deferred = $q.defer();\n$http.get(href + '/(mode)/list').then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.truncate = function (text, length, end) {\nif (isNaN(length))\nlength = 10;\nif (end === undefined)\nend = \"...\";\nif (text.length <= length || text.length - end.length <= length) {\nreturn text;\n}\nelse {\nreturn String(text).substring(0, length-end.length) + end;\n}\n};\nreturn this;\n}]);\nlhcAppControllers.controller('LiveHelperChatViewsCtrl',['$scope','$http','$location','$rootScope', '$log','$interval','LiveHelperChatViewsFactory', function($scope, $http, $location, $rootScope, $log, $interval,LiveHelperChatViewsFactory) {\n$scope.current_user_id = confLH.user_id;\nthis.views = [];\nthis.currentView = null;\nthis.updateTimeout = null;\nthis.updateViewsTimeout = null;\nvar _that = this;\nthis.initLHCData = function() {\nvar appendURL = '';\nLiveHelperChatViewsFactory.loadInitialData(appendURL).then(function(data) {\n_that.views = data.views;\n_that.views.length > 0 && _that.loadView(_that.views[0]);\n_that.setUpdateLive();\n_that.setUpdateLiveViews();\n});\n$('#view-content').on(\"click\", \".page-link\", function(e) {\ne.stopPropagation();\ne.preventDefault();\nif ($(e.target).attr('href') != '#') {\nvar link = $(e.target).attr('href');\nvar matches = link.match(/\\(page\\)\\/(\\d+)/);\nvar page = 1;\nif (matches != null) {\npage = matches[1];\n}\n_that.currentView.page = page;\n_that.updateViewList(link);\n}\n})\n}\nthis.updateViewList = function(href) {\nLiveHelperChatViewsFactory.loadViewPage(href).then(function(data) {\ndocument.getElementById('view-content-list').innerHTML = data.body;\nif (_that.currentView != null && _that.currentView.id == data.view_id) {\n_that.currentView.total_records = data.total_records;\n}\n_that.protectCSFR();\n})\n}\nthis.setUpdateLiveViews = function () {\nclearTimeout(this.updateViewsTimeout);\nthis.updateViewsTimeout = setTimeout(function () {\nLiveHelperChatViewsFactory.updateViewsList().then(function(data){\n_that.views = data.views;\n});\n_that.setUpdateLiveViews();\n},5000);\n}\nthis.setUpdateLive = function () {\nclearTimeout(this.updateTimeout);\nthis.updateTimeout = setTimeout(function () {\nif (_that.currentView != null) {\n_that.updateViewList(WWW_DIR_JAVASCRIPT + 'views/loadview/' + _that.currentView.id + '/(page)/' + _that.currentView.page);\n}\n_that.setUpdateLive();\n},20000);\n}\nthis.fetchViews = function () {\nvar appendURL = '';\nLiveHelperChatViewsFactory.loadInitialData(appendURL).then(function(data) {\n_that.views = data.views;\n});\n}\nthis.deleteView = function (view) {\nif (confirm('Are you sure?')) {\nLiveHelperChatViewsFactory.deleteView(view.id).then(function() {\n_that.views.splice(_that.views.indexOf(view),1);\nif (_that.currentView !== null && _that.currentView.id == view.id) {\n_that.currentView = null;\n}\nif (_that.views.length > 0) {\n_that.loadView(_that.views[0]);\n}\n})\n}\n}\nthis.cleanupTabs = function() {\nvar chatsToRemove = [];\n$.each(lhinst.chatsSynchronising, function( index, chat_id ) {\nchatsToRemove.push(chat_id);\n});\n$.each(chatsToRemove, function( index, chat_id ) {\nlhinst.removeSynchroChat(chat_id);\n});\n}\nthis.loadView = function(view) {\nthis.cleanupTabs();\n_that.currentView = view;\n_that.currentView.page = 1;\nLiveHelperChatViewsFactory.loadView(view.id).then(function(data) {\nif (_that.currentView !== null && _that.currentView.id == data.view_id) {\ndocument.getElementById('view-content').innerHTML = data.body;\n_that.currentView.total_records = data.total_records;\n_that.protectCSFR();\n}\n})\n}\nthis.protectCSFR = function () {\n$('#view-content a.csfr-required').click(function() {\nvar inst = $(this);\nif (!inst.attr('data-secured')) {\ninst.attr('href',inst.attr('href')+'/(csfr)/'+confLH.csrf_token);\ninst.attr('data-secured',1);\n}\n});\n}\nthis.initLHCData();\n}]);\n} catch (e) {\nif (lhcError) lhcError.log(e.message, \"angular.lhc-views.js\", e.lineNumber || e.line, e.stack); else throw Error(\"lhc : \" + e.message);\n}\n\n"]}