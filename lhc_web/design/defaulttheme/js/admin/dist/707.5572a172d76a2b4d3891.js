"use strict";(self.webpackChunkLHCReactAPPAdmin=self.webpackChunkLHCReactAPPAdmin||[]).push([[707],{4707:(t,e,a)=>{a.r(e),a.d(e,{default:()=>f});var n=a(8152),c=a(4942),i=a(7294),s=a(9669),r=a.n(s),o=a(4478),u=a(9778);function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){(0,c.Z)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function m(t,e){switch(e.type){case"attr":return-1===(c=t.chats.findIndex((function(t){return t.id==e.id})))?t:(t.chats[c]=d(d({},t.chats[c]),e.value),t=d({},t));case"attr_remove":return-1===(c=t.chats.findIndex((function(t){return t[e.attr]==e.id})))?t:(t.chats[c]=d(d({},t.chats[c]),e.value),t=d({},t));case"update":return d(d({},t),e.value);case"add":if(-1===(c=t.chats.findIndex((function(t){return t.id==e.value.id}))))if(!0===e.static_order){var a=t.chats.findIndex((function(t){return t.id>e.value.id}));-1===a?t.chats.push(e.value):t.chats.splice(a,0,e.value)}else t.chats.unshift(e.value);else t.chats[c].active=!0,t.chats[c].mn=0,t.chats[c].support_chat=!1;return d({},t);case"remove":return-1===(c=t.chats.findIndex((function(t){return t.id==e.id})))?t:(t.chats.splice(c,1),d({},t));case"update_chat":return-1===(c=t.chats.findIndex((function(t){return t.id==e.id})))?t:(t.chats[c]=d(d({},t.chats[c]),e.value),d({},t));case"msg_received":if(-1===(c=t.chats.findIndex((function(t){return t.id==e.id}))))return t;t.chats[c].msg=e.value.msg;var n=document.getElementById("chat-tab-link-"+e.id);return null!==n&&n.classList.contains("active")?t.chats[c].active=!0:t.chats[c].active=!1,t.chats[c].mn=0==t.chats[c].active?t.chats[c].mn?t.chats[c].mn+e.value.mn:e.value.mn:0,!1===e.static_order&&t.chats.splice(0,0,t.chats.splice(c,1)[0]),d({},t);case"refocus":var c;if(-1!==(c=t.chats.findIndex((function(t){return 1==t.active})))){if(e.id==t.chats[c].id)return t;t.chats[c].active=!1}return-1!==(c=t.chats.findIndex((function(t){return t.id==e.id})))&&(t.chats[c].active=!0,t.chats[c].mn=0,t.chats[c].support_chat=!1),d({},t);case"group_offline":return t.group_offline=e.value,d({},t);default:throw new Error("Unknown action!")}}const f=function(t){var e=(0,i.useReducer)(m,{chats:[],group_offline:!1}),a=(0,n.Z)(e,2),c=a[0],s=a[1],l=(0,i.useRef)(c);(0,i.useEffect)((function(){l.current=c}),[c]);var d=function(){var t=[];return c.chats.map((function(e,a){return t.push(e.id)})),t},f=function(t){r().get(WWW_DIR_JAVASCRIPT+"front/tabs/(id)/"+(void 0!==t?t.join("/"):d().join("/"))).then((function(t){t.data.map((function(t,e){var a=document.getElementById("node-js-indicator-"+t.id);null!==a&&(t.live_status="wifi"==a.textContent),s({type:"update_chat",id:t.id,value:t})}))}))};document.getElementById("tabs")||(0,u.Z)((function(){c.chats&&0!=c.chats.length&&r().get(WWW_DIR_JAVASCRIPT+"front/tabs/(id)/"+d().join("/")).then((function(t){t.data.map((function(t,e){var a=document.getElementById("node-js-indicator-"+t.id);if(null!==a&&(t.live_status="wifi"==a.textContent),c.chats&&0!=c.chats.length){var n=c.chats.findIndex((function(e){return e.id==t.id}));-1!==n&&(c.chats[n].lmsg_id!==t.lmsg_id?t.mn=1:t.mn=c.chats[n].mn)}s({type:"update_chat",id:t.id,value:t})}))}))}),1e3),(0,i.useEffect)((function(){function e(e,a){a.focus&&s({type:"attr_remove",id:!0,attr:"active",value:{active:!1}}),s({type:"add",static_order:t.static_order,value:{id:e,active:a.focus}}),f([e])}function a(e,a){s({type:"add",value:{id:e,static_order:t.static_order,active:!1,mn:1}}),f([e])}function n(t){s({type:"remove",id:t})}function c(t){s({type:"refocus",id:t})}function i(e){s({type:"group_offline",value:lhinst.hidenicknamesstatus}),Object.keys(e.result_status).map((function(t){s({type:"update_chat",id:e.result_status[t].chat_id,value:e.result_status[t]})})),"false"!==e.result&&Object.keys(e.result).map((function(a){s({type:"msg_received",id:e.result[a].chat_id,value:{msg:e.result[a].msg,mn:e.result[a].mn},order_chats:t.static_order})}))}function r(t){s({type:"update_chat",id:t.id,value:{tp:"true",tx:t.txt}})}function o(t){s({type:"update_chat",id:t.id,value:{tp:"false"}})}function u(t){s({type:"update_chat",id:t.id,value:{live_status:t.status}})}function d(t,e){var a=l.current.chats.findIndex((function(t){return 1==t.active}));-1!==a&&(l.current.chats.length-1>a&&0==e?h(l.current.chats[a+1]):a>0&&1==e&&h(l.current.chats[a-1]))}if(ee.addListener("chatStartTab",e),ee.addListener("chatTabPreload",(function(t,a){l.current.chats&&0!=l.current.chats.length&&-1!==l.current.chats.findIndex((function(e){return e.id==t}))||e(t,a)})),ee.addListener("chatStartBackground",a),ee.addListener("removeSynchroChat",n),ee.addListener("chatTabClicked",c),ee.addListener("chatTabFocused",c),ee.addListener("chatAdminSync",i),ee.addListener("supportUnreadChat",(function(t){t.id&&1==t.unread&&s({type:"update_chat",id:t.id,value:{support_chat:!0}})})),ee.addListener("nodeJsTypingVisitor",r),ee.addListener("nodeJsTypingVisitorStopped",o),ee.addListener("nodeJsVisitorStatus",u),ee.addListener("activateNextTab",d),localStorage){var m=localStorage.getItem("achat_id");if(null!==m&&""!==m){var p=m.split(",").map(Number);1==t.static_order&&p.sort((function(t,e){return t-e}));var v=[];p.forEach((function(t){var e=document.getElementById("chat-tab-link-"+t);parseInt(t)>0&&v.push({id:parseInt(t),active:null!==e&&e.classList.contains("active")})})),s({type:"update",value:{chats:v}}),p.length>0&&f(p),setTimeout((function(){p.forEach((function(t){var e=document.getElementById("chat-tab-link-"+t);null!==e&&e.classList.contains("active")&&c(parseInt(t))}))}),1e3)}}return function(){ee.removeListener("chatStartTab",e),ee.removeListener("chatStartBackground",a),ee.removeListener("removeSynchroChat",n),ee.removeListener("chatTabClicked",c),ee.removeListener("chatTabFocused",c),ee.removeListener("chatAdminSync",i),ee.removeListener("supportUnreadChat",i),ee.removeListener("nodeJsTypingVisitor",r),ee.removeListener("nodeJsTypingVisitorStopped",o),ee.removeListener("nodeJsVisitorStatus",u),ee.removeListener("activateNextTab",d)}}),[]);var h=function(t){null!==document.getElementById("chat-tab-link-"+t.id)?$("#chat-tab-link-"+t.id).click():document.location=WWW_DIR_JAVASCRIPT+"front/default/(cid)/"+t.id+"/#!#chat-id-"+t.id},p=(0,o.$)("chat_tabs"),v=p.t;return p.i18n,i.createElement(i.Fragment,null,(!c.chats||0==c.chats.length)&&i.createElement("div",{className:"text-center text-muted p-2"},i.createElement("span",{className:"material-icons"},"chat"),v("chat_tabs.open_chats")),c.chats.map((function(t,e){return i.createElement("div",{title:t.id,onClick:function(){return h(t)},className:"p-1 action-image chat-tabs-row"+(t.active?" chat-tab-active":"")+(t.vwa?" long-response-chat":"")},i.createElement("div",{className:"fs12"},i.createElement("span",{className:"material-icons"+(1==t.pnd_rsp?" text-danger":" text-success")},1==t.pnd_rsp?"call_received":"call_made"),t.adicons&&t.adicons.map((function(e,a){return i.createElement("span",{onClick:function(a){return function(t,e,a){t.preventDefault(),t.stopPropagation(),e.has_popup&&lhc.revealModal({url:WWW_DIR_JAVASCRIPT+"chat/icondetailed/"+a.id+"/"+e.icon_id})}(a,e,t)},style:{color:e.color},className:"material-icons",title:e.title},e.icon)})),t.vwa&&i.createElement("span",{title:t.vwa,className:"material-icons text-danger"},"timer"),t.support_chat&&i.createElement("span",{className:"whatshot blink-ani text-warning material-icons"},"whatshot"),i.createElement("i",{className:"material-icons "+("boolean"==typeof t.live_status?!0===t.live_status?"icon-user-online":"icon-user-offline":2==t.us?"icon-user-away":0==t.us?"icon-user-online":"icon-user-offline")},"boolean"==typeof t.live_status?!0===t.live_status?"wifi":"wifi_off":2==t.us?"wifi_1_bar":0==t.us?"wifi":"wifi_off"),i.createElement("i",{className:"material-icons icon-user-online "+(1==t.um?"icon-user-offline":"icon-user-online")},"send"),t.cc&&i.createElement("img",{title:t.cn,src:t.cc,alt:""})," ",(0==c.group_offline||!(0!=t.us))&&i.createElement("span",{className:(t.mn>0||0==t.cs?"font-weight-bold ":"")+(0==t.cs?"text-danger":"")},t.nick||t.id),t.mn>0&&i.createElement("span",{className:"msg-nm pl-1"},"(",t.mn,")"),t.lmsg&&i.createElement("span",{className:"text-muted"}," ",t.lmsg),i.createElement("button",{type:"button",onClick:function(e){return function(t,e){t.preventDefault(),t.stopPropagation(),lhinst.removeDialogTab(e.id,$("#tabs"),!0)}(e,t)},className:"float-right btn-link m-0 ml-1 p-0 btn btn-xs"},i.createElement("i",{className:"material-icons mr-0"},"close")),t.dep&&i.createElement("span",{className:"float-right text-muted text-truncate mw-80px"},0==t.cs&&i.createElement("span",{title:v("chat_tabs.pending_status"),className:"material-icons chat-pending"},"chat"),1==t.cs&&i.createElement("span",{title:v("chat_tabs.active_status"),className:"material-icons chat-active"},"chat"),5==t.cs&&i.createElement("span",{title:v("chat_tabs.bot_status"),className:"material-icons chat-active"},"android"),2==t.cs&&i.createElement("span",{title:v("chat_tabs.closed_status"),className:"material-icons chat-closed"},"chat"),i.createElement("span",{className:"material-icons",title:t.dep},"home"),t.dep),t.co==confLH.user_id&&i.createElement("span",{className:"float-right text-muted"},i.createElement("span",{title:v("chat_tabs.chat_owner"),className:"material-icons"},"account_box"))),(t.msg||"true"==t.tp&&t.tx)&&i.createElement("div",{className:"fs13 text-muted pt-1"},i.createElement("span",{title:"true"==t.tp&&t.tx?t.tx:t.msg,className:"d-inline-block text-truncate mw-100 "+(t.mn>0?"font-weight-bold":"")+("true"==t.tp&&t.tx?" font-italic":"")},"true"==t.tp&&t.tx?t.tx:t.msg)))})))}},9778:(t,e,a)=>{a.d(e,{Z:()=>c});var n=a(7294);const c=function(t,e){var a=(0,n.useRef)();(0,n.useEffect)((function(){a.current=t}),[t]),(0,n.useEffect)((function(){if(null!==e){var t=setInterval((function(){a.current()}),e);return function(){return clearInterval(t)}}}),[e])}}}]);
//# sourceMappingURL=707.5572a172d76a2b4d3891.js.map