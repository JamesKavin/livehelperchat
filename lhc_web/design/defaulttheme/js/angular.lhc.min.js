var phonecatApp=angular.module("lhcApp",["lhcAppServices","lhcAppControllers"]),services=angular.module("lhcAppServices",[]),lhcAppControllers=angular.module("lhcAppControllers",[]);angular.element(document).ready(function(){var t=angular.element(document.querySelector("form"));t.triggerHandler("$destroy")}),services.factory("LiveHelperChatFactory",["$http","$q",function(t,e){return this.loadChatList=function(){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/syncadmininterface").success(function(t){i.resolve(t)}).error(function(){i.reject("error")}),i.promise},this.truncate=function(t,e,i){return isNaN(e)&&(e=10),void 0===i&&(i="..."),t.length<=e||t.length-i.length<=e?t:String(t).substring(0,e-i.length)+i},this}]),lhcAppControllers.controller("LiveHelperChatCtrl",["$scope","$http","$location","$rootScope","$log","$interval","LiveHelperChatFactory",function(t,e,i,a,n,r,s){t.predicate="last_visit",t.pending_chats={},t.active_chats={},t.closed_chats={},t.unread_chats={},t.transfer_dep_chats={},t.transfer_chats={},t.timeoutControl=null,t.setTimeoutEnabled=!0,t.loadChatList=function(){clearTimeout(t.timeoutControl),s.loadChatList().then(function(e){var i=!1,a=0;angular.forEach(e.result,function(e,n){t[n]=e,e.last_id_identifier&&(void 0==lhinst.trackLastIDS[e.last_id_identifier]?lhinst.trackLastIDS[e.last_id_identifier]=parseInt(e.last_id):lhinst.trackLastIDS[e.last_id_identifier]<parseInt(e.last_id)?(lhinst.trackLastIDS[e.last_id_identifier]=parseInt(e.last_id),a!=lhinst.trackLastIDS[e.last_id_identifier]&&(a=lhinst.trackLastIDS[e.last_id_identifier],lhinst.playSoundNewAction(e.last_id_identifier,parseInt(e.last_id),e.nick?e.nick:"Live Help",e.msg?e.msg:confLH.transLation.new_chat))):lhinst.trackLastIDS[e.last_id_identifier]>parseInt(e.last_id)&&(lhinst.trackLastIDS[e.last_id_identifier]=parseInt(e.last_id)),0==e.last_id&&(lhinst.trackLastIDS[e.last_id_identifier]=0),parseInt(e.last_id)>0&&(i=!0))}),0==i&&lhinst.hideNotifications(),0==t.pending_chats.length&&clearTimeout(lhinst.soundIsPlaying),setTimeout(function(){$(document).foundation("section","resize")},500),1==t.setTimeoutEnabled&&(t.timeoutControl=setTimeout(function(){t.loadChatList()},confLH.back_office_sinterval))},function(){t.timeoutControl=setTimeout(function(){t.loadChatList()},confLH.back_office_sinterval)})},this.previewChat=function(t){0==$("#myModal").size()&&$("body").prepend('<div id="myModal" class="reveal-modal medium"><a class="close-reveal-modal">&#215;</a></div>'),$("#myModal").foundation("reveal","open",{url:WWW_DIR_JAVASCRIPT+"chat/previewchat/"+t})},this.redirectContact=function(t,e){return lhinst.redirectContact(t,e)},this.startChatNewWindow=function(t,e){return lhinst.startChatNewWindow(t,e)},this.startChat=function(t,e){return lhinst.startChat(t,$("#tabs"),s.truncate(e,10))},this.startChatNewWindowTransfer=function(t,e,i){return lhinst.startChatNewWindowTransfer(t,e,i)},this.startChatTransfer=function(t,e,i){return lhinst.startChatTransfer(t,$("#tabs"),e,i)},this.startChatOperator=function(t){window.open(WWW_DIR_JAVASCRIPT+"chat/startchatwithoperator/"+t,"operatorchatwindow-"+t,"menubar=1,resizable=1,width=780,height=450")},t.loadChatList()}]);